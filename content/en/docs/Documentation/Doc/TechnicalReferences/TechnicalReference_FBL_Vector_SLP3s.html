---
title: TechnicalReference_FBL_Vector_SLP3s
linkTitle: TechnicalReference_FBL_Vector_SLP3s
weight: 34
---

<!DOCTYPE html><html>
<head>
<title></title>
<style type="text/css">
<!--
.xflip {
    -moz-transform: scaleX(-1);
    -webkit-transform: scaleX(-1);
    -o-transform: scaleX(-1);
    transform: scaleX(-1);
    filter: fliph;
}
.yflip {
    -moz-transform: scaleY(-1);
    -webkit-transform: scaleY(-1);
    -o-transform: scaleY(-1);
    transform: scaleY(-1);
    filter: flipv;
}
.xyflip {
    -moz-transform: scaleX(-1) scaleY(-1);
    -webkit-transform: scaleX(-1) scaleY(-1);
    -o-transform: scaleX(-1) scaleY(-1);
    transform: scaleX(-1) scaleY(-1);
    filter: fliph + flipv;
}
-->
</style>
</head>
<body>
<a name=1></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-1_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
&#160;<br/>
&#160;<br/>&#160;<br/>
&#160;<br/>
&#160;<br/>&#160;<br/>&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>&#160;<br/>
<b>Flash Bootloader OEM&#160;<br/></b>Technical Reference&#160;<br/>&#160;<br/>Vector UDS (SLP3)&#160;-&#160;CAN configuration&#160;<br/>Version&#160;3.1&#160;<br/>&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
Authors&#160;<br/>
Achim&#160;Strobelt,&#160;Marco&#160;Riedl&#160;<br/>
Status&#160;<br/>
Released&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
1&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=2></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-2_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>Document&#160;Information&#160;</b><br/>
<b>History&#160;</b><br/>
<b>Author&#160;</b><br/>
<b>Date&#160;</b><br/>
<b>Version&#160;&#160;Remarks&#160;</b><br/>
Achim&#160;Strobelt&#160;&#160;2017-08-14&#160;&#160;3.0&#160;<br/>
Rework&#160;based&#160;on&#160;Version&#160;2.8&#160;<br/>
Achim&#160;Strobelt&#160;&#160;2017-10-28&#160;&#160;3.1&#160;<br/>
Corrected&#160;Request&#160;Download service description,&#160;<br/>added new&#160;Cfg configuration&#160;options&#160;<br/>
&#160;<br/>&#160;<br/>
&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
2&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=3></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-3_1.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-3_2.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>Reference&#160;Documents&#160;</b><br/>
<b>No.&#160;</b><br/>
<b>Source&#160;&#160;Title&#160;</b><br/>
<b>Version&#160;</b><br/>
[1]&#160;&#160;&#160;<br/>
ISO&#160;<br/>
14229&#160;Road Vehicles&#160;–&#160;Unified&#160;diagnostic&#160;services (UDS)&#160;<br/>
2005&#160;<br/>
Part&#160;1:&#160;Specification and&#160;Requirements&#160;<br/>
[2]&#160;&#160;&#160;<br/>
ISO&#160;<br/>
15765&#160;Road Vehicles&#160;–&#160;Diagnostics&#160;on&#160;CAN&#160;<br/>
2004&#160;<br/>
Part&#160;3:&#160;Implementation of&#160;Unified&#160;Diagnostic&#160;Services&#160;<br/>
[3]&#160;&#160;&#160;<br/>
Vector&#160;<br/>
AN-ISC-8-1188&#160;–&#160;Custom&#160;Flash&#160;Drivers&#160;<br/>
1.0&#160;<br/>
[4]&#160;&#160;&#160;<br/>
HIS&#160;<br/>
Security&#160;Module Specification&#160;<br/>
1.0&#160;<br/>
[5]&#160;&#160;&#160;<br/>
Vector&#160;<br/>
User&#160;Manual&#160;Flash&#160;Bootloader&#160;<br/>
2.7&#160;<br/>
[6]&#160;&#160;&#160;<br/>
Vector&#160;<br/>
Technical&#160;Reference&#160;HexView&#160;<br/>
1.9.3&#160;<br/>
[7]&#160;&#160;&#160;<br/>
Vector&#160;<br/>
Manual&#160;vFlash&#160;<br/>
3.0&#160;<br/>
[8]&#160;&#160;&#160;<br/>
Vector&#160;<br/>
NV-Wrapper&#160;–&#160;Technical&#160;Reference&#160;<br/>
1.0&#160;<br/>
[9]&#160;&#160;&#160;<br/>
Vector&#160;<br/>
AN-ISC-8-1143&#160;–&#160;Bootloader&#160;Validation&#160;Strategies&#160;<br/>
1.0&#160;<br/>
[10]&#160;&#160;<br/>
Vector&#160;<br/>
Technical&#160;Reference&#160;Security&#160;Module /&#160;Security&#160;Module Basic&#160;<br/>
2.1.0&#160;<br/>
[11]&#160;&#160;<br/>
Vector&#160;<br/>
AN-ISC-8-1188&#160;–&#160;Custom&#160;Flash&#160;Drivers&#160;<br/>
1.0&#160;<br/>
[12]&#160;&#160;<br/>
Vector&#160;<br/>
Technical&#160;Reference&#160;Communication&#160;Wrapper&#160;PDU&#160;Router&#160;<br/>
1.3&#160;<br/>
[13]&#160;&#160;<br/>
Vector&#160;<br/>
LIN&#160;Driver&#160;–&#160;Technical&#160;Reference&#160;<br/>
2.xx.xx&#160;<br/>
&#160;<br/>&#160;<br/>&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>Caution&#160;<br/></b>We&#160;have configured&#160;the&#160;programs&#160;in&#160;accordance&#160;with your&#160;specifications&#160;in the&#160;<br/>
<b>&#160;</b><br/>
questionnaire.&#160;Whereas&#160;the&#160;programs&#160;do&#160;support&#160;other&#160;configurations&#160;than&#160;the&#160;one&#160;<br/>specified&#160;in your&#160;questionnaire,&#160;Vector´s&#160;release&#160;of&#160;the&#160;programs&#160;delivered to&#160;your&#160;<br/>company&#160;is&#160;expressly&#160;restricted&#160;to&#160;the&#160;configuration&#160;you&#160;have specified&#160;in&#160;the&#160;<br/>questionnaire.&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
3&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=4></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-4_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>Contents&#160;</b><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#8"><b>1</b>&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#8"><b>Introduction...................................................................................................................&#160;8</b>&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#9"><b>2</b>&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#9"><b>Download&#160;concept&#160;........................................................................................................&#160;9</b>&#160;<br/>2.1&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#9">Overview&#160;............................................................................................................&#160;9&#160;<br/>2.1.1&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#9">Pre-Programming&#160;Step&#160;......................................................................&#160;9&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#10">2.1.2&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#10">Programming&#160;Step&#160;...........................................................................&#160;10&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#11">2.1.3&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#11">Post-Programming&#160;Step&#160;...................................................................&#160;11&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#12">2.2&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#12">Detailed&#160;Description&#160;of&#160;Diagnostic&#160;Services&#160;.....................................................&#160;12&#160;<br/>2.2.1&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#12">Diagnostic&#160;Session&#160;Control&#160;..............................................................&#160;12&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#12">2.2.2&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#12">ECU&#160;Reset&#160;.......................................................................................&#160;12&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#13">2.2.3&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#13">Read Data By&#160;Identifier&#160;....................................................................&#160;13&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#13">2.2.4&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#13">Security&#160;Access&#160;................................................................................&#160;13&#160;<br/></a><a href="TechnicalReference_FBL_Vector_SLP3s.html#14">2.2.4.1&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#14">Request&#160;Seed&#160;................................................................&#160;14&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#14">2.2.4.2&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#14">Send Key&#160;.......................................................................&#160;14&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#15">2.2.5&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#15">Communication&#160;Control&#160;....................................................................&#160;15&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#15">2.2.6&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#15">Write Data By&#160;Identifier&#160;....................................................................&#160;15&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#16">2.2.7&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#16">Routine&#160;Control&#160;................................................................................&#160;16&#160;<br/>2.2.7.1&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#16">Check&#160;Routine&#160;...............................................................&#160;16&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#16">2.2.7.2&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#16">Check&#160;Programming&#160;Preconditions&#160;................................&#160;16&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#17">2.2.7.3&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#17">Erase Memory&#160;...............................................................&#160;17&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#17">2.2.7.4&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#17">Check&#160;Programming&#160;Dependencies&#160;...............................&#160;17&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#18">2.2.7.5&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#18">Force Boot&#160;Mode&#160;...........................................................&#160;18&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#18">2.2.8&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#18">Request&#160;Download&#160;...........................................................................&#160;18&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#19">2.2.9&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#19">Transfer&#160;Data&#160;...................................................................................&#160;19&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#19">2.2.10&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#19">Request&#160;Transfer&#160;Exit&#160;.......................................................................&#160;19&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#19">2.2.11&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#19">Tester&#160;Present&#160;..................................................................................&#160;19&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#20">2.2.12&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#20">Control&#160;DTC&#160;Setting&#160;.........................................................................&#160;20&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#21">2.3&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#21">Negative Response&#160;Codes&#160;..............................................................................&#160;21&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#22"><b>3</b>&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#22"><b>Flash&#160;Bootloader&#160;Delivery&#160;..........................................................................................&#160;22</b>&#160;<br/>3.1&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#22">Bootloader&#160;Components&#160;..................................................................................&#160;22&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#22">3.2&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#22">Bootloader&#160;Integration&#160;......................................................................................&#160;22&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#23"><b>4</b>&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#23"><b>Bootloader&#160;Installation&#160;...............................................................................................&#160;23</b>&#160;<br/>4.1&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#23">[#oem_files]&#160;-&#160;Bootloader&#160;package&#160;structure&#160;....................................................&#160;23&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#24">4.2&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#24">Demonstration Bootloader&#160;...............................................................................&#160;24&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#25"><b>5</b>&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#25"><b>Generation&#160;Tool&#160;(GENy)&#160;.............................................................................................&#160;25</b>&#160;<br/>5.1&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#25">Project&#160;Setup&#160;...................................................................................................&#160;25&#160;</a><br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
4&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=5></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-5_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#29">5.2&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#29">CAN&#160;configuration&#160;............................................................................................&#160;29&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#30">5.3&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#30">CAN&#160;ID&#160;configuration&#160;.......................................................................................&#160;30&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#33">5.4&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#33">Bootloader&#160;Configuration&#160;.................................................................................&#160;33&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#38">5.5&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#38">Memory&#160;Configuration&#160;......................................................................................&#160;38&#160;<br/>5.5.1&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#38">Flash&#160;Block&#160;Table&#160;.............................................................................&#160;38&#160;<br/></a><a href="TechnicalReference_FBL_Vector_SLP3s.html#39">5.5.1.1&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#39">Logical&#160;Block&#160;Table&#160;........................................................&#160;39&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#39">5.5.2&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#39">Memory&#160;Device&#160;Table&#160;.......................................................................&#160;39&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#40">5.5.3&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#40">NV-Wrapper&#160;Configuration&#160;...............................................................&#160;40&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#42">5.5.4&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#42">Running&#160;the&#160;Generator&#160;.....................................................................&#160;42&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#43"><b>6</b>&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#43"><b>User&#160;callback&#160;files&#160;and&#160;hardware&#160;specific adaptions&#160;...............................................&#160;43</b>&#160;<br/>6.1&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#43">Startup&#160;code&#160;....................................................................................................&#160;43&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#44">6.2&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#44">Hardware,&#160;Input/Output&#160;and miscellaneous Callbacks&#160;.....................................&#160;44&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#52">6.3&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#52">Validation&#160;and non-volatile memory&#160;callbacks&#160;..................................................&#160;52&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#59">6.4&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#59">59&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#60">6.5&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#60">Diagnostic&#160;Service Callbacks&#160;...........................................................................&#160;60&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#61">6.6&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#61">Watchdog&#160;Callbacks&#160;........................................................................................&#160;61&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#63"><b>7</b>&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#63"><b>Build your&#160;Bootloader&#160;................................................................................................&#160;63</b>&#160;<br/>7.1&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#63">Bootloader&#160;specific&#160;linker&#160;requirements&#160;............................................................&#160;63&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#65"><b>8</b>&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#65"><b>Adapt&#160;your&#160;application&#160;...............................................................................................&#160;65</b>&#160;<br/>8.1&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#65">Memory&#160;Layout&#160;................................................................................................&#160;65&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#65">8.2&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#65">Application Start&#160;...............................................................................................&#160;65&#160;<br/>8.2.1&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#65">Controllers&#160;with a&#160;configurable interrupt&#160;base&#160;address&#160;.....................&#160;65&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#65">8.2.2&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#65">Controllers&#160;with interrupt&#160;jump&#160;tables&#160;...............................................&#160;65&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#66">8.3&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#66">Shared&#160;files between FBL&#160;and&#160;application&#160;.......................................................&#160;66&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#66">8.4&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#66">Shared&#160;memory&#160;between FBL&#160;and&#160;application&#160;.................................................&#160;66&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#67">8.5&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#67">Transition&#160;between Bootloader&#160;and&#160;Application&#160;................................................&#160;67&#160;<br/>8.5.1&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#67">[#oem_start]&#160;[#oem_trans]&#160;-&#160;Programming Session&#160;Request&#160;...........&#160;67&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#68">8.5.2&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#68">ECU&#160;Reset&#160;and&#160;Default&#160;Session&#160;Request&#160;........................................&#160;68&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#69"><b>9</b>&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#69"><b>Memory&#160;Drivers&#160;..........................................................................................................&#160;69</b>&#160;<br/>9.1&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#69">Flash&#160;Driver&#160;.....................................................................................................&#160;69&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#69">9.2&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#69">Non-volatile&#160;Memory&#160;Driver&#160;..............................................................................&#160;69&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#70">9.3&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#70">Memory&#160;driver&#160;requirements&#160;............................................................................&#160;70&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#71"><b>10</b>&#160;&#160;<b>Miscellaneous&#160;.............................................................................................................&#160;71</b>&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#71">10.1&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#71">[#oem_valid]&#160;-&#160;Application validation&#160;................................................................&#160;71&#160;<br/></a><a href="TechnicalReference_FBL_Vector_SLP3s.html#72">10.1.1&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#72">Presence Patterns&#160;...........................................................................&#160;72&#160;<br/></a><a href="TechnicalReference_FBL_Vector_SLP3s.html#73">10.1.1.1&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#73">Storage of&#160;application valid flag&#160;.....................................&#160;73&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#74">10.1.2&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#74">[#oem_time]&#160;-&#160;Validation&#160;OK&#160;–&#160;Application&#160;faulty&#160;..............................&#160;74&#160;</a><br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
5&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=6></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-6_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#74">10.1.3&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#74">Force Boot&#160;Mode&#160;.............................................................................&#160;74&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#75">10.2&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#75">[#oem_sec]&#160;Seed&#160;/&#160;Key&#160;Mechanism&#160;.................................................................&#160;75&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#76">10.3&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#76">[#oem_seccomp]&#160;-&#160;Security&#160;module&#160;.................................................................&#160;76&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#76">10.4&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#76">Data&#160;Processing&#160;Support&#160;.................................................................................&#160;76&#160;<br/></a><a href="TechnicalReference_FBL_Vector_SLP3s.html#77">10.4.1&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#77">tProcParam&#160;......................................................................................&#160;77&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#77">10.5&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#77">[#oem_multi]&#160;-&#160;Multiple ECU&#160;Support&#160;...............................................................&#160;77&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#78">10.6&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#78">Configuration without&#160;NV-Memory&#160;driver&#160;..........................................................&#160;78&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#79">10.7&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#79">Pipelined Programming&#160;and Pipelined Verification&#160;...........................................&#160;79&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#80"><b>11</b>&#160;&#160;<b>vFlash&#160;Configuration&#160;..................................................................................................&#160;80</b>&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#82"><b>12</b>&#160;&#160;<b>Glossary&#160;and&#160;Abbreviations&#160;......................................................................................&#160;82</b>&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#82">12.1&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#82">Glossary&#160;..........................................................................................................&#160;82&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#82">12.2&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#82">Abbreviations&#160;...................................................................................................&#160;82&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#83"><b>13</b>&#160;&#160;<b>Contact&#160;........................................................................................................................&#160;83</b>&#160;<br/></a>&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
6&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=7></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-7_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>Illustrations&#160;</b><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#8">Figure&#160;1-1&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#8">Manual&#160;and References&#160;for&#160;the&#160;Flash&#160;Bootloader&#160;.......................................&#160;8&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#9">Figure&#160;2-1&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#9">Basic&#160;Programming Sequence&#160;...................................................................&#160;9&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#9">Figure&#160;2-2&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#9">Pre-Programming&#160;Step&#160;...............................................................................&#160;9&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#10">Figure&#160;2-3&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#10">Programming&#160;Step&#160;....................................................................................&#160;10&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#10">Figure&#160;2-4&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#10">Software&#160;&amp;&#160;Data&#160;Download&#160;Sequence&#160;......................................................&#160;10&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#11">Figure&#160;2-5&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#11">Post-Programming&#160;Step&#160;...........................................................................&#160;11&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#23">Figure&#160;4-1&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#23">Bootloader&#160;Folder&#160;Structure&#160;......................................................................&#160;23&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#25">Figure&#160;5-1&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#25">GENy&#160;Setup&#160;Dialog...................................................................................&#160;25&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#26">Figure&#160;5-2&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#26">GENy&#160;main window&#160;after&#160;pre-configuration&#160;...............................................&#160;26&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#26">Figure&#160;5-3&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#26">GENy&#160;Channel&#160;Setup&#160;(CAN&#160;or&#160;LIN)&#160;..........................................................&#160;26&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#27">Figure&#160;5-4&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#27">GENy&#160;main window&#160;after&#160;channel&#160;setup&#160;...................................................&#160;27&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#28">Figure&#160;5-5&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#28">GENy&#160;Components&#160;...................................................................................&#160;28&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#29">Figure&#160;5-6&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#29">GENy&#160;CAN&#160;configuration&#160;..........................................................................&#160;29&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#31">Figure&#160;5-7&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#31">FblWrapperCom_Can&#160;GENy&#160;module&#160;........................................................&#160;31&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#32">Figure&#160;5-8&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#32">CAN&#160;connection&#160;table&#160;...............................................................................&#160;32&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#32">Figure&#160;5-9&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#32">GENy&#160;–&#160;CAN&#160;message&#160;table&#160;....................................................................&#160;32&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#34">Figure&#160;5-10&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#34">GENy&#160;General&#160;FBL&#160;configuration&#160;..............................................................&#160;34&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#37">Figure&#160;5-11&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#37">OEM&#160;specific&#160;UDS&#160;configuration&#160;...............................................................&#160;37&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#38">Figure&#160;5-12&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#38">Flash&#160;Block&#160;Table......................................................................................&#160;38&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#39">Figure&#160;5-13&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#39">Logical&#160;Block&#160;Table&#160;...................................................................................&#160;39&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#40">Figure&#160;5-14&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#40">Memory&#160;Device&#160;Table&#160;...............................................................................&#160;40&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#41">Figure&#160;5-15&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#41">NV-Wrapper&#160;configuration&#160;........................................................................&#160;41&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#41">Figure&#160;5-16&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#41">Meta&#160;Data&#160;configuration&#160;............................................................................&#160;41&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#72">Figure&#160;10-1&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#72">Presence&#160;Pattern&#160;......................................................................................&#160;72&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#73">Figure&#160;10-2&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#73">Presence&#160;Pattern Examples&#160;.....................................................................&#160;73&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#76">Figure&#160;10-3&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#76">Data&#160;processing&#160;sequence&#160;.......................................................................&#160;76&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#77">Figure&#160;10-4&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#77">Multiple ECU&#160;setup&#160;...................................................................................&#160;77&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#80">Figure&#160;11-1&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#80">vFlash&#160;Configuration&#160;.................................................................................&#160;80&#160;</a><br/>
<b>&#160;</b><br/>
<b>Tables&#160;<br/></b><a href="TechnicalReference_FBL_Vector_SLP3s.html#21">Table 2-1&#160;&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#21">NRC&#160;codes&#160;used&#160;by&#160;Bootloader&#160;................................................................&#160;21&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#24">Table 4-1&#160;&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#24">Bootloader&#160;Folder&#160;Structure&#160;......................................................................&#160;24&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#31">Table 5-1&#160;&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#31">FblWrapperCom_Can&#160;main page&#160;GENy&#160;options&#160;.......................................&#160;31&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#32">Table 5-2&#160;&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#32">GENy&#160;–&#160;CAN&#160;connection&#160;table&#160;..................................................................&#160;32&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#32">Table 5-3&#160;&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#32">GENy&#160;–&#160;CAN&#160;message&#160;table&#160;....................................................................&#160;32&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#37">Table 5-4&#160;&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#37">GENy&#160;General&#160;FBL&#160;Configuration&#160;.............................................................&#160;37&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#37">Table 5-5&#160;&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#37">OEM&#160;UDS&#160;Specific&#160;Configuration&#160;.............................................................&#160;37&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#38">Table 5-6&#160;&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#38">Flash&#160;Block&#160;Table Configuration&#160;................................................................&#160;38&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#39">Table 5-7&#160;&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#39">Logical&#160;Block&#160;Table Configuration&#160;.............................................................&#160;39&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#40">Table 5-8&#160;&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#40">Memory&#160;Device&#160;Table Configuration&#160;.........................................................&#160;40&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#42">Table 5-9&#160;&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#42">Generated&#160;Files&#160;........................................................................................&#160;42&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#64">Table 7-1&#160;&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#64">RAM/ROM&#160;linkage&#160;....................................................................................&#160;64&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#77">Table 10-1&#160;&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#77">Type&#160;Definition&#160;-&#160;tProcParam&#160;....................................................................&#160;77&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#81">Table 11-1&#160;&#160;</a><br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#81">vFlash&#160;Configuration&#160;.................................................................................&#160;81&#160;</a><br/>
&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
7&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=8></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-8_1.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-8_2.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-8_3.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-8_4.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-8_5.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>1&#160;&#160;Introduction&#160;</b><br/>
This&#160;&#160;document&#160;&#160;covers&#160;&#160;the&#160;&#160;OEM-specific&#160;&#160;particularities&#160;&#160;of&#160;&#160;the&#160;&#160;flash&#160;&#160;bootloader.&#160;&#160;It&#160;<br/>complements&#160;&#160;the&#160;&#160;explanations&#160;&#160;started&#160;&#160;in&#160;&#160;the&#160;&#160;user&#160;&#160;manual&#160;&#160;with&#160;&#160;OEM-specific&#160;&#160;details.&#160;All&#160;<br/>references there are&#160;resumed&#160;here in&#160;this document&#160;again&#160;and&#160;explained&#160;in&#160;detail.&#160;<br/>The&#160;connection&#160;between&#160;a&#160;reference&#160;in&#160;the&#160;user&#160;manual&#160;and&#160;its&#160;specific&#160;description&#160;in&#160;this&#160;<br/>document&#160;is&#160;the&#160;headline.&#160;Both&#160;the&#160;reference&#160;and&#160;its&#160;explanation&#160;can&#160;be&#160;found&#160;below&#160;the&#160;<br/>same&#160;headline&#160;<br/>
&#160;<br/>
&#160;<br/>
<b>User&#160;Manual</b><br/>
headline<br/>
headline<br/>
#hw_&lt;xxx&gt;<br/>
#oem_&lt;yyy&gt;<br/>
<b>Technical</b><br/>
<b>Flash&#160;Tool</b><br/>
<b>Technical</b><br/>
<b>Reference</b><br/>
<b>Documentation</b><br/>
<b>Reference</b><br/>
<b>Hardware</b><br/>
<b>OEM</b><br/>
<b>You are&#160;here</b><br/>
&#160;<br/>
Figure&#160;1-1&#160;&#160;Manual&#160;and&#160;References&#160;for&#160;the&#160;Flash&#160;Bootloader&#160;<br/>
&#160;<br/>
Additionally,&#160;&#160;this&#160;&#160;headline&#160;&#160;is&#160;&#160;marked&#160;&#160;with&#160;&#160;the&#160;&#160;ID&#160;&#160;of&#160;&#160;the&#160;&#160;reference&#160;&#160;from&#160;&#160;the&#160;&#160;User&#160;&#160;Manual.&#160;<br/>This ID looks like:&#160;[#oem_&lt;yyy&gt;].&#160;<br/>
&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
8&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=9></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-9_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>2&#160;&#160;Download&#160;concept&#160;</b><br/>
<b>2.1&#160;</b><br/>
<b>Overview&#160;</b><br/>
The&#160;flash&#160;&#160;tool&#160;&#160;(Diagnostic&#160;Tester)&#160;&#160;uses&#160;&#160;the&#160;UDS&#160;&#160;protocol&#160;&#160;to&#160;&#160;communicate&#160;&#160;with&#160;&#160;the&#160;&#160;ECU.&#160;<br/>Inside&#160;the&#160;ECU&#160;the&#160;UDS&#160;communication&#160;is&#160;handled&#160;by&#160;the&#160;flash&#160;bootloader&#160;(aka&#160;FBL).&#160;The&#160;<br/>flash&#160;bootloader&#160;supports&#160;a&#160;subset&#160;of&#160;diagnostic&#160;services&#160;which&#160;are&#160;necessary&#160;for&#160;the&#160;flash&#160;<br/>download&#160;process.&#160;<br/>The&#160;download&#160;process&#160;can&#160;be&#160;divided&#160;into&#160;three&#160;basic steps:&#160;<br/>
&#160;<br/>
Pre-Programming&#160;Step<br/>
Programming&#160;Step<br/>
Post-Programming&#160;Step<br/>
&#160;<br/>
Figure&#160;2-1&#160;&#160;Basic&#160;Programming&#160;Sequence&#160;<br/>
The&#160;following&#160;chapters document&#160;the&#160;download&#160;sequence.&#160;<br/><b>&#160;&#160;</b>Steps&#160;marked&#160;red&#160;are&#160;steps which&#160;are sent&#160;physically&#160;to&#160;the&#160;ECU&#160;which&#160;is&#160;flashed.&#160;<br/>
<b>&#160;&#160;</b>Steps&#160;marked&#160;grey&#160;are sent&#160;functionally&#160;to&#160;all&#160;ECUs in&#160;the&#160;network.&#160;<br/>
<b>2.1.1&#160;</b><br/>
<b>Pre-Programming&#160;Step&#160;</b><br/>
The&#160;&#160;Pre-Programming&#160;&#160;Step&#160;&#160;prepares&#160;&#160;the&#160;&#160;vehicle’s&#160;&#160;network&#160;&#160;for&#160;&#160;flashing.&#160;&#160;This&#160;&#160;includes&#160;<br/>disabling&#160;normal&#160;communication&#160;to&#160;increase&#160;the&#160;available&#160;bandwidth,&#160;stop&#160;logging&#160;of&#160;DTCs&#160;<br/>and&#160;a&#160;check to&#160;ensure&#160;the&#160;ECU&#160;which&#160;should&#160;be&#160;flashed&#160;is in&#160;a&#160;state&#160;which&#160;allows flashing.&#160;<br/>The&#160;&#160;step&#160;&#160;“Routine&#160;&#160;Control&#160;&#160;–&#160;&#160;Check&#160;&#160;Programming&#160;&#160;Preconditions”&#160;&#160;is&#160;&#160;optional&#160;&#160;and&#160;&#160;can&#160;&#160;be&#160;<br/>deactivated&#160;in&#160;both&#160;bootloader&#160;and&#160;vFlash.&#160;<br/>
Session&#160;Control<br/>
Extended&#160;Diagnostic&#160;Session<br/>
Routine&#160;Control<br/>
Check&#160;Programming&#160;Preconditions<br/>
Control&#160;DTC<br/>
DTC&#160;off<br/>
Communication&#160;Control<br/>
Disable&#160;non-diagnostic&#160;communication<br/>
&#160;<br/>
Figure&#160;2-2&#160;&#160;Pre-Programming&#160;Step&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
9&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=10></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-10_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>2.1.2&#160;</b><br/>
<b>Programming Step&#160;</b><br/>
The&#160;&#160;Programming&#160;&#160;Step&#160;&#160;performs&#160;&#160;the&#160;&#160;actual&#160;&#160;software&#160;&#160;download&#160;&#160;to&#160;&#160;the&#160;&#160;ECU.&#160;&#160;The&#160;&#160;other&#160;<br/>ECUs&#160;in&#160;the&#160;network&#160;have&#160;to&#160;be&#160;kept&#160;in&#160;extended&#160;session&#160;by&#160;the&#160;tester&#160;while&#160;the&#160;ECU&#160;is&#160;<br/>flashed.&#160;&#160;This&#160;&#160;is&#160;&#160;achieved&#160;&#160;by&#160;&#160;sending&#160;&#160;Tester&#160;&#160;Present&#160;&#160;messages&#160;&#160;($3E)&#160;&#160;functionally&#160;<br/>addressed&#160;to&#160;all&#160;ECUs&#160;in&#160;the&#160;network.&#160;<br/>
Session&#160;Control<br/>
Programming&#160;Session<br/>
Security&#160;Access<br/>
Request&#160;Seed /&#160;Send&#160;Key<br/>
Write&#160;Data&#160;By&#160;Identifier<br/>
Write&#160;Fingerprint<br/>
Download&#160;Flash Driver<br/>
Routine&#160;Control<br/>
Erase&#160;Memory<br/>
Download&#160;Software &amp;&#160;Data<br/>
Routine&#160;Control<br/>
Check&#160;Programming&#160;Dependencies<br/>
ECU&#160;Reset<br/>Hard Reset<br/>
&#160;<br/>
Figure&#160;2-3&#160;&#160;Programming&#160;Step&#160;<br/>
The&#160;download&#160;of&#160;flash&#160;driver,&#160;software and&#160;data&#160;use&#160;the&#160;same&#160;download&#160;sequence:&#160;<br/>
Request&#160;Download<br/>
Transfer&#160;Data<br/>
Request&#160;Transfer&#160;Exit<br/>
Routine&#160;Control<br/>
Check&#160;Routine<br/>
&#160;<br/>
Figure&#160;2-4&#160;&#160;Software&#160;&amp;&#160;Data&#160;Download&#160;Sequence&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
10&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=11></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-11_1.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-11_2.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
The&#160;flash&#160;driver&#160;normally&#160;is&#160;downloaded&#160;via&#160;CAN.&#160;It&#160;has&#160;to&#160;be&#160;downloaded&#160;before&#160;erasing&#160;<br/>the&#160;&#160;first&#160;&#160;logical&#160;&#160;block.&#160;&#160;After&#160;&#160;the&#160;&#160;first&#160;&#160;logical&#160;&#160;block,&#160;&#160;additional&#160;&#160;flash&#160;&#160;driver&#160;&#160;downloads&#160;&#160;are&#160;<br/>optional.&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>Note&#160;<br/></b>The&#160;flash&#160;driver&#160;can&#160;be optionally&#160;stored&#160;in&#160;ROM.&#160;In&#160;this&#160;case,&#160;the&#160;flash&#160;driver&#160;<br/>
&#160;&#160;download is no&#160;longer&#160;necessary.&#160;<br/>
Please note:&#160;This&#160;feature&#160;must&#160;be&#160;requested&#160;with the&#160;bootloader&#160;order.&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>Routine&#160;Control&#160;–&#160;Erase&#160;Memory&#160;and&#160;the&#160;Software&#160;&amp;&#160;Data&#160;download&#160;sequence&#160;have&#160;to&#160;be&#160;<br/>executed&#160;for each&#160;logical&#160;block.&#160;<br/>Depending&#160;on&#160;the&#160;bootloader&#160;configuration,&#160;one&#160;or&#160;more&#160;iterations&#160;of&#160;the&#160;services&#160;Request&#160;<br/>Download,&#160;Transfer Data&#160;and&#160;Request&#160;Transfer Exit are allowed&#160;for&#160;every&#160;logical block.&#160;<br/>
&#160;<br/>
<b>2.1.3&#160;</b><br/>
<b>Post-Programming Step&#160;</b><br/>
The&#160;&#160;Post-Programming&#160;&#160;Step&#160;&#160;is&#160;&#160;used&#160;&#160;to&#160;&#160;reactivate&#160;&#160;the&#160;&#160;normal&#160;&#160;network&#160;&#160;behavior&#160;&#160;after&#160;<br/>flashing&#160;one&#160;ECU.&#160;<br/>
Session&#160;Control<br/>
Extended&#160;Diagnostic&#160;Session<br/>
Communication&#160;Control<br/>
Enable&#160;non-diagnostic&#160;communication<br/>
Control&#160;DTC<br/>
DTC&#160;on<br/>
Session&#160;Control<br/>
Default&#160;Session<br/>
&#160;<br/>
Figure&#160;2-5&#160;&#160;Post-Programming&#160;Step&#160;<br/>
&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
11&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=12></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-12_1.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-12_2.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>2.2&#160;</b><br/>
<b>Detailed Description&#160;of&#160;Diagnostic&#160;Services&#160;</b><br/>
The&#160;flash&#160;bootloader&#160;supports&#160;several&#160;diagnostic&#160;services.&#160;These&#160;services&#160;are&#160;relevant&#160;for&#160;<br/>the&#160;download&#160;sequence.&#160;A&#160;list&#160;and&#160;more&#160;detailed&#160;description&#160;of&#160;the&#160;diagnostic&#160;services&#160;can&#160;<br/>be&#160;found&#160;a<a href="TechnicalReference_FBL_Vector_SLP3s.html#3">t&#160;[1].</a>&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>Note&#160;<br/></b>The&#160;service descriptions&#160;i<a href="TechnicalReference_FBL_Vector_SLP3s.html#3">n&#160;[1]&#160;</a>are&#160;generic&#160;definitions&#160;of&#160;UDS.&#160;Please&#160;note&#160;that&#160;this&#160;<br/>
&#160;&#160;bootloader&#160;package specifies&#160;the&#160;usage&#160;and interpretation&#160;of&#160;some parameters&#160;if&#160;they&#160;<br/>
are&#160;not&#160;specified&#160;in detail.&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>
<b>2.2.1&#160;</b><br/>
<b>Diagnostic&#160;Session&#160;Control&#160;</b><br/>
This service&#160;is used&#160;to&#160;select&#160;the&#160;different&#160;diagnostic sessions in&#160;the&#160;ECU&#160;<br/>
<b>Diagnostic&#160;Session&#160;Control&#160;$10&#160;–&#160;Request&#160;Message Format&#160;</b><br/>
Data&#160;Byte#&#160;&#160;Data&#160;Value&#160;&#160;Parameter&#160;Description&#160;<br/>
1&#160;<br/>
$10&#160;<br/>
Request Service&#160;ID&#160;<br/>
2&#160;<br/>
$XX&#160;<br/>
Diagnostic&#160;Session&#160;Type&#160;<br/>&#160;&#160;$01 Default&#160;Session&#160;<br/>&#160;&#160;$02&#160;Programming&#160;Session&#160;<br/>&#160;&#160;$03&#160;Extended&#160;Session&#160;<br/>
<b>Positive Response&#160;Message&#160;Format&#160;</b><br/>
Data&#160;Byte#&#160;&#160;Data&#160;Value&#160;&#160;Parameter&#160;Description&#160;<br/>
1&#160;<br/>
$50&#160;<br/>
Response&#160;Service&#160;ID&#160;<br/>
2&#160;<br/>
$XX&#160;<br/>
Diagnostic&#160;Session&#160;Type&#160;(see&#160;byte&#160;#2&#160;of&#160;request message)&#160;<br/>
3-4&#160;<br/>
$XXXX&#160;<br/>
P2CAN_Server_Max&#160;<br/>
5-6&#160;<br/>
$XXXX&#160;<br/>
P2*CAN_Server_Max&#160;<br/>
&#160;<br/>
<b>2.2.2&#160;</b><br/>
<b>ECU&#160;Reset&#160;</b><br/>
<b>ECU&#160;Reset&#160;$11&#160;–&#160;Request&#160;Message&#160;Format&#160;</b><br/>
Data&#160;Byte#&#160;&#160;Data&#160;Value&#160;&#160;Parameter&#160;Description&#160;<br/>
1&#160;<br/>
$11&#160;<br/>
Request Service&#160;ID&#160;<br/>
2&#160;<br/>
$01&#160;<br/>
Reset&#160;Type&#160;–&#160;Hard&#160;Reset&#160;<br/>
<b>Positive Response&#160;Message&#160;Format&#160;</b><br/>
Data&#160;Byte#&#160;&#160;Data&#160;Value&#160;&#160;Parameter&#160;Description&#160;<br/>
1&#160;<br/>
$51&#160;<br/>
Response&#160;Service&#160;ID&#160;<br/>
2&#160;<br/>
$01&#160;<br/>
Reset&#160;Type&#160;–&#160;Hard&#160;Reset&#160;<br/>
&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
12&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=13></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-13_1.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-13_2.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-13_3.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>2.2.3&#160;</b><br/>
<b>Read Data&#160;By&#160;Identifier&#160;</b><br/>
<b>Read Data By&#160;Identifier&#160;$22&#160;–&#160;Request&#160;Message Format&#160;</b><br/>
Data&#160;Byte#&#160;&#160;Data&#160;Value&#160;&#160;Parameter&#160;Description&#160;<br/>
1&#160;<br/>
$22&#160;<br/>
Request Service&#160;ID&#160;<br/>
2-3&#160;<br/>
$XXXX&#160;<br/>
Data&#160;Identifier #1&#160;<br/>
…&#160;<br/>
$XXXX&#160;<br/>
Data&#160;Identifier #n&#160;<br/>
<b>Positive Response&#160;Message&#160;Format&#160;</b><br/>
Data&#160;Byte#&#160;&#160;Data&#160;Value&#160;&#160;Parameter&#160;Description&#160;<br/>
1&#160;<br/>
$62&#160;<br/>
Response&#160;Service&#160;ID&#160;<br/>
2-3&#160;<br/>
$XXXX&#160;<br/>
Data&#160;Identifier #1&#160;<br/>
4…x&#160;<br/>
$XX&#160;<br/>
Requested&#160;data&#160;of&#160;DID #1&#160;<br/>
(x+1)-(x+2)&#160;<br/>
$XXXX&#160;<br/>
Data&#160;Identifier #n&#160;<br/>
(x+3)…&#160;<br/>
$XX&#160;<br/>
Requested&#160;data&#160;of&#160;DID&#160;#n&#160;<br/>
&#160;<br/>
Several DIDs can&#160;be&#160;read&#160;with&#160;one&#160;request&#160;as long&#160;as they&#160;fit&#160;into&#160;the&#160;diagnostic&#160;buffer.&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>Note&#160;<br/></b>This&#160;service is not&#160;necessary&#160;for&#160;the&#160;download sequence,&#160;but&#160;it&#160;can&#160;be&#160;used&#160;to&#160;obtain&#160;<br/>
&#160;&#160;useful&#160;information&#160;from&#160;the&#160;ECU.&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>&#160;<br/>
<b>2.2.4&#160;</b><br/>
<b>Security&#160;Access&#160;</b><br/>
This&#160;&#160;service&#160;&#160;is&#160;&#160;used&#160;&#160;to&#160;&#160;restrict&#160;&#160;access&#160;&#160;to&#160;&#160;certain&#160;&#160;services&#160;&#160;in&#160;&#160;the&#160;&#160;ECU,&#160;&#160;e.g.&#160;&#160;all&#160;&#160;services&#160;<br/>which&#160;write&#160;data&#160;to&#160;the&#160;ECU.&#160;<br/>The&#160;seed/key&#160;mechanism&#160;is described&#160;in<a href="TechnicalReference_FBL_Vector_SLP3s.html#3">&#160;[4].</a>&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>Caution&#160;<br/></b>Please note&#160;that&#160;Vector&#160;SLP3&#160;bootloaders&#160;include a&#160;demonstration&#160;seed/key&#160;algorithm.&#160;<br/>
<b>&#160;&#160;</b>This&#160;algorithm&#160;does&#160;not&#160;provide&#160;safe access&#160;restriction&#160;in production&#160;ECUs&#160;and should&#160;<br/>
be&#160;replaced by&#160;a&#160;safe&#160;algorithm.&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
13&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=14></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-14_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>2.2.4.1&#160;</b><br/>
<b>Request Seed&#160;</b><br/>
<b>Security&#160;Access;&#160;Request&#160;Seed $27&#160;$11&#160;–&#160;Request&#160;Message&#160;Format&#160;</b><br/>
Data&#160;Byte#&#160;&#160;Data&#160;Value&#160;&#160;Parameter&#160;Description&#160;<br/>
1&#160;<br/>
$27&#160;<br/>
Request Service&#160;ID&#160;<br/>
2&#160;<br/>
$RS&#160;<br/>
Security&#160;Access&#160;Type&#160;–&#160;Request&#160;Seed&#160;<br/>
<b>Positive Response&#160;Message&#160;Format&#160;</b><br/>
Data&#160;Byte#&#160;&#160;Data&#160;Value&#160;&#160;Parameter&#160;Description&#160;<br/>
1&#160;<br/>
$67&#160;<br/>
Response&#160;Service&#160;ID&#160;<br/>
2&#160;<br/>
$RS&#160;<br/>
Security&#160;Access&#160;Type&#160;–&#160;Request&#160;Seed&#160;<br/>
3..x&#160;<br/>
$XX&#160;<br/>
Seed value&#160;<br/>
&#160;<br/>
The&#160;security&#160;level&#160;(Request&#160;Seed&#160;sub-function)&#160;is&#160;configurable.&#160;It&#160;has&#160;to&#160;be&#160;configured&#160;to&#160;<br/>the&#160;same&#160;value&#160;in&#160;bootloader&#160;and&#160;vFlash.&#160;vFlash&#160;supports&#160;security&#160;levels $01&#160;-&#160;$13.&#160;<br/>
<b>2.2.4.2&#160;</b><br/>
<b>Send Key&#160;</b><br/>
<b>Security&#160;Access;&#160;Send Key&#160;$27 $12&#160;–&#160;Request&#160;Message&#160;Format&#160;</b><br/>
Data&#160;Byte#&#160;&#160;Data&#160;Value&#160;&#160;Parameter&#160;Description&#160;<br/>
1&#160;<br/>
$27&#160;<br/>
Request Service&#160;ID&#160;<br/>
2&#160;<br/>
$SK&#160;<br/>
Security&#160;Access&#160;Type&#160;–&#160;Send&#160;Key&#160;<br/>
3..x&#160;<br/>
$XX&#160;<br/>
Key&#160;calculated&#160;by&#160;tester&#160;<br/>
<b>Positive Response&#160;Message&#160;Format&#160;</b><br/>
Data&#160;Byte#&#160;&#160;Data&#160;Value&#160;&#160;Parameter&#160;Description&#160;<br/>
1&#160;<br/>
$67&#160;<br/>
Response&#160;Service&#160;ID&#160;<br/>
2&#160;<br/>
$SK&#160;<br/>
Security&#160;Access&#160;Type&#160;–&#160;Request&#160;Seed&#160;<br/>
&#160;<br/>
The&#160;&#160;Send&#160;&#160;Key&#160;&#160;sub-function&#160;&#160;is&#160;&#160;always&#160;&#160;$RS&#160;&#160;+&#160;&#160;1&#160;&#160;and&#160;&#160;depend&#160;&#160;on&#160;&#160;the&#160;&#160;Request&#160;&#160;Seed&#160;&#160;sub-<br/>function.&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
14&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=15></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-15_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>2.2.5&#160;</b><br/>
<b>Communication Control&#160;</b><br/>
Transmission&#160;&#160;and/or&#160;&#160;reception&#160;&#160;of&#160;&#160;messages&#160;&#160;can&#160;&#160;be&#160;&#160;controlled&#160;&#160;using&#160;&#160;this&#160;&#160;service.&#160;&#160;This&#160;<br/>service&#160;is mainly&#160;used&#160;by&#160;application&#160;which&#160;uses non-diagnostic&#160;messages.&#160;<br/>
<b>Communication&#160;Control&#160;$28&#160;–&#160;Request&#160;Message&#160;Format&#160;</b><br/>
Data&#160;Byte#&#160;&#160;Data&#160;Value&#160;&#160;Parameter&#160;Description&#160;<br/>
1&#160;<br/>
$28&#160;<br/>
Request Service&#160;ID&#160;<br/>
2&#160;<br/>
$XX&#160;<br/>
Control&#160;Type&#160;<br/>&#160;&#160;$00:&#160;Enable Rx&#160;and&#160;Tx&#160;<br/>&#160;&#160;$01:&#160;Enable&#160;Rx&#160;and&#160;disable&#160;Tx&#160;<br/>
3&#160;<br/>
$01&#160;<br/>
Communication&#160;Type&#160;–&#160;Normal&#160;communication&#160;<br/>
<b>Positive Response&#160;Message&#160;Format&#160;</b><br/>
Data&#160;Byte#&#160;&#160;Data&#160;Value&#160;&#160;Parameter&#160;Description&#160;<br/>
1&#160;<br/>
$68&#160;<br/>
Response&#160;Service&#160;ID&#160;<br/>
2&#160;<br/>
$XX&#160;<br/>
Control&#160;Type&#160;<br/>&#160;&#160;$00:&#160;Enable Rx&#160;and&#160;Tx&#160;<br/>&#160;&#160;Either&#160;$01:&#160;Enable Rx&#160;and&#160;disable&#160;Tx&#160;<br/>&#160;&#160;or $03:&#160;Disable Rx&#160;and&#160;Tx&#160;<br/>
&#160;<br/>
One&#160;of&#160;the&#160;two&#160;possible&#160;sub-functions&#160;$01&#160;and&#160;$03&#160;is&#160;used&#160;in&#160;pre-programming&#160;sequence.&#160;<br/>It&#160;is configurable&#160;in&#160;bootloader&#160;and&#160;vFlash.&#160;<br/>The&#160;post-programming&#160;sequence&#160;expects&#160;always sub-function&#160;$00.&#160;<br/>
<b>2.2.6&#160;</b><br/>
<b>Write&#160;Data&#160;By&#160;Identifier&#160;</b><br/>
This service&#160;can&#160;be&#160;used&#160;to&#160;write&#160;information&#160;into&#160;the&#160;ECU.&#160;<br/>
<b>Write&#160;Data&#160;By&#160;Identifier&#160;$2E&#160;–&#160;Request&#160;Message Format&#160;</b><br/>
Data&#160;Byte#&#160;&#160;Data&#160;Value&#160;&#160;Parameter&#160;Description&#160;<br/>
1&#160;<br/>
$2E&#160;<br/>
Request Service&#160;ID&#160;<br/>
2-3&#160;<br/>
$XXXX&#160;<br/>
Data&#160;Identifier&#160;<br/>
4..x&#160;<br/>
$XX&#160;<br/>
Data&#160;Record&#160;<br/>
<b>Positive Response&#160;Message&#160;Format&#160;</b><br/>
Data&#160;Byte#&#160;&#160;Data&#160;Value&#160;&#160;Parameter&#160;Description&#160;<br/>
1&#160;<br/>
$6E&#160;<br/>
Response&#160;Service&#160;ID&#160;<br/>
2-3&#160;<br/>
$XXXX&#160;<br/>
Data&#160;Identifier&#160;<br/>
&#160;<br/>
By&#160;default,&#160;the&#160;bootloader&#160;requires&#160;a&#160;write&#160;fingerprint&#160;service.&#160;The&#160;length&#160;of&#160;this&#160;service&#160;is&#160;<br/>configurable&#160;in&#160;vFlash&#160;and&#160;bootloader.&#160;If&#160;the&#160;DID&#160;should&#160;be&#160;changed&#160;from&#160;the&#160;default&#160;value&#160;<br/>of&#160;$F15A&#160;to&#160;a&#160;different&#160;value,&#160;a&#160;project&#160;specific vFlash&#160;template&#160;has&#160;to&#160;be&#160;obtained.&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
15&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=16></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-16_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>2.2.7&#160;</b><br/>
<b>Routine&#160;Control&#160;</b><br/>
This&#160;service&#160;is&#160;used&#160;to&#160;start&#160;a&#160;routine,&#160;stop&#160;a&#160;routine&#160;or&#160;request&#160;routine&#160;results.&#160;Only&#160;the&#160;<br/>start of&#160;routines is relevant&#160;for the&#160;FBL.&#160;<br/>
<b>2.2.7.1&#160;</b><br/>
<b>Check&#160;Routine&#160;</b><br/>
This&#160;routine&#160;is&#160;used&#160;to&#160;calculate&#160;a&#160;checksum&#160;or&#160;verify&#160;a&#160;signature&#160;of&#160;the&#160;downloaded&#160;data.&#160;<br/>The&#160;calculated&#160;checksum&#160;is compared&#160;to&#160;the&#160;downloaded&#160;checksum.&#160;<br/>
<b>Routine&#160;Control;&#160;Check Routine&#160;$31 $01&#160;$02&#160;$02&#160;–&#160;Request&#160;Message Format&#160;</b><br/>
Data&#160;Byte#&#160;&#160;Data&#160;Value&#160;&#160;Parameter&#160;Description&#160;<br/>
1&#160;<br/>
$31&#160;<br/>
Request Service&#160;ID&#160;<br/>
2&#160;<br/>
$01&#160;<br/>
Routine&#160;Control&#160;Type&#160;–&#160;Start Routine&#160;<br/>
3-4&#160;<br/>
$0202&#160;<br/>
Routine&#160;Identifier&#160;–&#160;Calculate&#160;Checksum&#160;<br/>
5..x&#160;<br/>
$XX&#160;<br/>
Routine&#160;Control&#160;Option Record.&#160;These data&#160;bytes&#160;contain&#160;the&#160;checksum&#160;or&#160;<br/>signature&#160;which&#160;is&#160;compared&#160;to&#160;the&#160;calculated&#160;checksum&#160;or signature.&#160;<br/>
<b>Positive Response&#160;Message&#160;Format&#160;</b><br/>
Data&#160;Byte#&#160;&#160;Data&#160;Value&#160;&#160;Parameter&#160;Description&#160;<br/>
1&#160;<br/>
$71&#160;<br/>
Response&#160;Service&#160;ID&#160;<br/>
2&#160;<br/>
$01&#160;<br/>
Routine&#160;Control&#160;Type&#160;–&#160;Start Routine&#160;<br/>
3-4&#160;<br/>
$0202&#160;<br/>
Routine&#160;Identifier&#160;–&#160;Calculate&#160;Checksum&#160;<br/>
5&#160;<br/>
$XX&#160;<br/>
Routine&#160;Status&#160;Record&#160;-&#160;$00 indicates&#160;a&#160;successful&#160;checksum&#160;comparison, a&#160;<br/>different value&#160;indicates&#160;which&#160;kind&#160;of&#160;error occurred.&#160;<br/>
&#160;<br/>
<b>2.2.7.2&#160;</b><br/>
<b>Check&#160;Programming&#160;Preconditions&#160;</b><br/>
This service&#160;is optional and&#160;can&#160;be&#160;de-activated&#160;in&#160;GENy.&#160;<br/>
<b>Routine&#160;Control;&#160;Check Programming&#160;Preconditions $31&#160;$01 $02&#160;$03&#160;–&#160;Request&#160;Message&#160;<br/>Format&#160;</b><br/>
Data&#160;Byte#&#160;&#160;Data&#160;Value&#160;&#160;Parameter&#160;Description&#160;<br/>
1&#160;<br/>
$31&#160;<br/>
Request Service&#160;ID&#160;<br/>
2&#160;<br/>
$01&#160;<br/>
Routine&#160;Control&#160;Type&#160;–&#160;Start Routine&#160;<br/>
3-4&#160;<br/>
$0203&#160;<br/>
Routine&#160;Identifier&#160;–&#160;Check&#160;Programming&#160;Preconditions&#160;<br/>
<b>Positive Response&#160;Message&#160;Format&#160;</b><br/>
Data&#160;Byte#&#160;&#160;Data&#160;Value&#160;&#160;Parameter&#160;Description&#160;<br/>
1&#160;<br/>
$71&#160;<br/>
Response&#160;Service&#160;ID&#160;<br/>
2&#160;<br/>
$01&#160;<br/>
Routine&#160;Control&#160;Type&#160;–&#160;Start Routine&#160;<br/>
3-4&#160;<br/>
$0203&#160;<br/>
Routine&#160;Identifier&#160;–&#160;Check&#160;Programming&#160;Preconditions&#160;<br/>
5..x&#160;<br/>
$XX&#160;<br/>
Routine&#160;Status&#160;Record&#160;–&#160;contains&#160;the&#160;preconditions&#160;that are&#160;not&#160;fulfilled.&#160;<br/>
&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
16&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=17></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-17_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>2.2.7.3&#160;</b><br/>
<b>Erase&#160;Memory&#160;</b><br/>
<b>Routine&#160;Control;&#160;Erase&#160;Memory&#160;$31 $01 $FF&#160;$00&#160;–&#160;Request&#160;Message&#160;Format&#160;</b><br/>
Data&#160;Byte#&#160;&#160;Data&#160;Value&#160;&#160;Parameter&#160;Description&#160;<br/>
1&#160;<br/>
$31&#160;<br/>
Request Service&#160;ID&#160;<br/>
2&#160;<br/>
$01&#160;<br/>
Routine&#160;Control&#160;Type&#160;–&#160;Start Routine&#160;<br/>
3-4&#160;<br/>
$FF00&#160;<br/>
Routine&#160;Identifier&#160;–&#160;Erase&#160;Memory&#160;<br/>
5&#160;<br/>
$nm&#160;<br/>
ALFI&#160;–&#160;supported&#160;values&#160;BCD coded between $11 and $44.&#160;<br/>
6..(6+n-1)&#160;<br/>
$XX&#160;<br/>
Memory&#160;Address&#160;(n Bytes)&#160;<br/>
(6+n)..&#160;<br/>
$XX&#160;<br/>
Erase Length (m&#160;Bytes).&#160;Address&#160;based&#160;download&#160;only.&#160;<br/>
((6+n)+m-1)&#160;<br/>
<b>Positive Response&#160;Message&#160;Format&#160;</b><br/>
Data&#160;Byte#&#160;&#160;Data&#160;Value&#160;&#160;Parameter&#160;Description&#160;<br/>
1&#160;<br/>
$71&#160;<br/>
Response&#160;Service&#160;ID&#160;<br/>
2&#160;<br/>
$01&#160;<br/>
Routine&#160;Control&#160;Type&#160;–&#160;Start Routine&#160;<br/>
3-4&#160;<br/>
$FF00&#160;<br/>
Routine&#160;Identifier&#160;–&#160;Erase&#160;Memory&#160;<br/>
5&#160;<br/>
$XX&#160;<br/>
Routine&#160;Status&#160;Record&#160;-&#160;$00 indicates&#160;a&#160;successful&#160;erase operation,&#160;a&#160;<br/>different value&#160;indicates&#160;which kind&#160;of&#160;error occurred.&#160;<br/>
&#160;<br/>
<b>2.2.7.4&#160;</b><br/>
<b>Check&#160;Programming&#160;Dependencies&#160;</b><br/>
<b>Routine&#160;Control;&#160;Check Routine&#160;$31 $01&#160;$FF&#160;$01&#160;–&#160;Request&#160;Message Format&#160;</b><br/>
Data&#160;Byte#&#160;&#160;Data&#160;Value&#160;&#160;Parameter&#160;Description&#160;<br/>
1&#160;<br/>
$31&#160;<br/>
Request Service&#160;ID&#160;<br/>
2&#160;<br/>
$01&#160;<br/>
Routine&#160;Control&#160;Type&#160;–&#160;Start Routine&#160;<br/>
3-4&#160;<br/>
$FF01&#160;<br/>
Routine&#160;Identifier&#160;–&#160;Check&#160;Programming&#160;Dependencies.&#160;<br/>
<b>Positive Response&#160;Message&#160;Format&#160;</b><br/>
Data&#160;Byte#&#160;&#160;Data&#160;Value&#160;&#160;Parameter&#160;Description&#160;<br/>
1&#160;<br/>
$71&#160;<br/>
Response&#160;Service&#160;ID&#160;<br/>
2&#160;<br/>
$01&#160;<br/>
Routine&#160;Control&#160;Type&#160;–&#160;Start Routine&#160;<br/>
3-4&#160;<br/>
$FF01&#160;<br/>
Routine&#160;Identifier&#160;–&#160;Check&#160;Programming&#160;Dependencies&#160;<br/>
5&#160;<br/>
$XX&#160;<br/>
Routine&#160;Status&#160;Record&#160;-&#160;$00 indicates&#160;a&#160;successful&#160;dependency&#160;check, a&#160;<br/>different value&#160;indicates&#160;which kind&#160;of&#160;error occurred.&#160;<br/>
&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
17&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=18></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-18_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>2.2.7.5&#160;</b><br/>
<b>Force&#160;Boot&#160;Mode&#160;</b><br/>
This service&#160;is optional and&#160;is available&#160;if&#160;“Stay&#160;in&#160;Boot” is enabled&#160;in&#160;GENy.&#160;<br/>
<b>Routine&#160;Control;&#160;Check Routine&#160;$31 $01&#160;$F5&#160;$18&#160;–&#160;Request&#160;Message Format&#160;</b><br/>
Data&#160;Byte#&#160;&#160;Data&#160;Value&#160;&#160;Parameter&#160;Description&#160;<br/>
1&#160;<br/>
$31&#160;<br/>
Request Service&#160;ID&#160;<br/>
2&#160;<br/>
$01&#160;<br/>
Routine&#160;Control&#160;Type&#160;–&#160;Start Routine&#160;<br/>
3-4&#160;<br/>
$F518&#160;<br/>
Routine&#160;Identifier&#160;–&#160;Stay&#160;In&#160;Boot&#160;<br/>
<b>Positive Response&#160;Message&#160;Format&#160;</b><br/>
Data&#160;Byte#&#160;&#160;Data&#160;Value&#160;&#160;Parameter&#160;Description&#160;<br/>
1&#160;<br/>
$71&#160;<br/>
Response&#160;Service&#160;ID&#160;<br/>
2&#160;<br/>
$01&#160;<br/>
Routine&#160;Control&#160;Type&#160;–&#160;Start&#160;Routine&#160;<br/>
3-4&#160;<br/>
$F518&#160;<br/>
Routine&#160;Identifier&#160;–&#160;Stay&#160;In&#160;Boot&#160;<br/>
&#160;<br/>
<b>2.2.8&#160;</b><br/>
<b>Request Download&#160;</b><br/>
<b>Request&#160;Download $34&#160;–&#160;Request&#160;Message&#160;Format&#160;</b><br/>
Data&#160;Byte#&#160;&#160;Data&#160;Value&#160;&#160;Parameter&#160;Description&#160;<br/>
1&#160;<br/>
$34&#160;<br/>
Request Service&#160;ID&#160;<br/>
2&#160;<br/>
$xx&#160;<br/>
Data&#160;Format&#160;Identifier&#160;–&#160;Determines&#160;if&#160;a&#160;download&#160;is&#160;compressed&#160;or&#160;<br/>encrypted.&#160;<br/>
3&#160;<br/>
$nm&#160;<br/>
ALFI&#160;–&#160;supported&#160;values&#160;BCD coded between $11 and $44.&#160;<br/>
4,&#160;m&#160;Bytes&#160;<br/>
$xx&#160;<br/>
Memory&#160;Address. Length&#160;m&#160;Bytes.&#160;<br/>
4+m,&#160;n&#160;<br/>
$xx&#160;<br/>
Memory&#160;Size.&#160;Length&#160;n&#160;Bytes&#160;<br/>
Bytes&#160;<br/>
<b>Positive Response&#160;Message&#160;Format&#160;</b><br/>
Data&#160;Byte#&#160;&#160;Data&#160;Value&#160;&#160;Parameter&#160;Description&#160;<br/>
1&#160;<br/>
$74&#160;<br/>
Response&#160;Service&#160;ID&#160;<br/>
2&#160;<br/>
$nm&#160;<br/>
Length&#160;Format&#160;Identifier&#160;–&#160;n determines&#160;the length&#160;of&#160;the&#160;<br/>maxNumberOfBlockLengthParameter..&#160;<br/>
3..x&#160;(n&#160;<br/>
$xx&#160;<br/>
Max&#160;Number&#160;Of&#160;Block&#160;Length.&#160;Contains&#160;the&#160;maximum number&#160;of&#160;bytes&#160;to&#160;be&#160;<br/>
Bytes)&#160;<br/>
transmitted&#160;with each&#160;transfer data&#160;service.&#160;<br/>
&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
18&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=19></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-19_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>2.2.9&#160;</b><br/>
<b>Transfer&#160;Data&#160;</b><br/>
<b>Transfer&#160;Data&#160;$36&#160;–&#160;Request&#160;Message&#160;Format&#160;</b><br/>
Data&#160;Byte#&#160;&#160;Data&#160;Value&#160;&#160;Parameter&#160;Description&#160;<br/>
1&#160;<br/>
$36&#160;<br/>
Request Service&#160;ID&#160;<br/>
2&#160;<br/>
$XX&#160;<br/>
Block&#160;Sequence&#160;Counter.&#160;This&#160;value&#160;starts&#160;at&#160;$01 and&#160;is&#160;incremented&#160;with&#160;<br/>each following&#160;transfer data&#160;service.&#160;<br/>
3..x&#160;<br/>
$XX&#160;<br/>
Transfer Data Parameter&#160;Record. Contains&#160;the downloaded&#160;data.&#160;<br/>
<b>Positive Response&#160;Message&#160;Format&#160;</b><br/>
Data&#160;Byte#&#160;&#160;Data&#160;Value&#160;&#160;Parameter&#160;Description&#160;<br/>
1&#160;<br/>
$76&#160;<br/>
Response&#160;Service&#160;ID&#160;<br/>
2&#160;<br/>
$XX&#160;<br/>
Block&#160;Sequence&#160;Counter&#160;<br/>
&#160;<br/>
<b>2.2.10&#160;&#160;Request Transfer&#160;Exit&#160;</b><br/>
<b>Request&#160;Transfer&#160;Exit&#160;$37&#160;–&#160;Request&#160;Message&#160;Format&#160;</b><br/>
Data&#160;Byte#&#160;&#160;Data&#160;Value&#160;&#160;Parameter&#160;Description&#160;<br/>
1&#160;<br/>
$37&#160;<br/>
Request Service&#160;ID&#160;<br/>
<b>Positive Response&#160;Message&#160;Format&#160;</b><br/>
Data&#160;Byte#&#160;&#160;Data&#160;Value&#160;&#160;Parameter&#160;Description&#160;<br/>
1&#160;<br/>
$77&#160;<br/>
Response&#160;Service&#160;ID&#160;<br/>
&#160;<br/>
<b>2.2.11&#160;&#160;Tester&#160;Present&#160;</b><br/>
<b>Tester&#160;Present&#160;$3E&#160;–&#160;Request&#160;Message&#160;Format&#160;</b><br/>
Data&#160;Byte#&#160;&#160;Data&#160;Value&#160;&#160;Parameter&#160;Description&#160;<br/>
1&#160;<br/>
$3E&#160;<br/>
Request Service&#160;ID&#160;<br/>
2&#160;<br/>
$00&#160;<br/>
Zero&#160;Sub-function&#160;<br/>
<b>Positive Response&#160;Message&#160;Format&#160;</b><br/>
Data&#160;Byte#&#160;&#160;Data&#160;Value&#160;&#160;Parameter&#160;Description&#160;<br/>
1&#160;<br/>
$7E&#160;<br/>
Response&#160;Service&#160;ID&#160;<br/>
2&#160;<br/>
$00&#160;<br/>
Zero Sub-function&#160;<br/>
&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
19&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=20></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-20_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>2.2.12&#160;&#160;Control&#160;DTC Setting&#160;</b><br/>
<b>&#160;Control&#160;DTC&#160;Setting&#160;$85&#160;–&#160;Request&#160;Message&#160;Format&#160;</b><br/>
Data&#160;Byte#&#160;&#160;Data&#160;Value&#160;&#160;Parameter&#160;Description&#160;<br/>
1&#160;<br/>
$85&#160;<br/>
Request Service&#160;ID&#160;<br/>
2&#160;<br/>
$01/$02&#160;<br/>
Control&#160;DTC Setting&#160;Type:&#160;$01&#160;=&#160;on,&#160;$02&#160;=&#160;off&#160;<br/>
3..5&#160;<br/>
$FFFFFF&#160;<br/>
Control&#160;DTC option&#160;record.&#160;Deactivate all&#160;DTCs&#160;(optional, can be&#160;configured&#160;<br/>in GENy&#160;and&#160;vFlash)&#160;<br/>
<b>Positive Response&#160;Message&#160;Format&#160;</b><br/>
Data&#160;Byte#&#160;&#160;Data&#160;Value&#160;&#160;Parameter&#160;Description&#160;<br/>
1&#160;<br/>
$C5&#160;<br/>
Response&#160;Service&#160;ID&#160;<br/>
2&#160;<br/>
$01/02&#160;<br/>
Control&#160;DTC Setting&#160;Type&#160;<br/>
&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
20&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=21></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-21_1.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-21_2.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>2.3&#160;</b><br/>
<b>Negative&#160;Response&#160;Codes&#160;</b><br/>
The&#160;&#160;bootloader&#160;&#160;uses&#160;&#160;negative&#160;&#160;responses&#160;&#160;as&#160;&#160;described&#160;&#160;in&#160;&#160;the&#160;&#160;UDS&#160;&#160;specification<a href="TechnicalReference_FBL_Vector_SLP3s.html#3">&#160;&#160;[1].</a>&#160;&#160;The&#160;<br/>following&#160;NRCs are used:&#160;<br/>
&#160;<br/>
<b>NRC&#160;</b><br/>
<b>Description&#160;</b><br/>
$10&#160;<br/>
General&#160;reject&#160;<br/>
$11&#160;<br/>
Service not&#160;supported&#160;<br/>
$12&#160;<br/>
Sub-function&#160;not&#160;supported&#160;<br/>
$13&#160;<br/>
Incorrect&#160;message length or&#160;invalid format&#160;<br/>
$14&#160;<br/>
Response too&#160;long&#160;<br/>
$21&#160;<br/>
Busy&#160;–&#160;Repeat&#160;request&#160;<br/>
$22&#160;<br/>
Conditions&#160;not&#160;correct&#160;<br/>
$24&#160;<br/>
Request&#160;sequence&#160;error&#160;<br/>
$31&#160;<br/>
Request&#160;out&#160;of&#160;range&#160;<br/>
$33&#160;<br/>
Security&#160;Access&#160;denied&#160;<br/>
$35&#160;<br/>
Invalid key&#160;<br/>
$36&#160;<br/>
Exceeded number&#160;of&#160;attempts&#160;<br/>
$37&#160;<br/>
Required&#160;time&#160;delay&#160;not&#160;expired&#160;<br/>
$70&#160;<br/>
Upload/Download not&#160;accepted&#160;<br/>
$71&#160;<br/>
Transfer&#160;data&#160;suspended&#160;<br/>
$72&#160;<br/>
General&#160;Programming&#160;failure&#160;<br/>
$73&#160;<br/>
Wrong&#160;Block&#160;Sequence&#160;counter&#160;<br/>
$75&#160;<br/>
Illegal&#160;Byte count&#160;in&#160;block transfer&#160;<br/>
$7E&#160;<br/>
Sub-function&#160;not&#160;supported&#160;in active session&#160;<br/>
$7F&#160;<br/>
Service not&#160;supported&#160;in&#160;active session&#160;<br/>
$92&#160;<br/>
Voltage&#160;too&#160;high&#160;<br/>
$93&#160;<br/>
Voltage&#160;too&#160;low&#160;<br/>
Table&#160;2-1&#160;&#160;&#160;NRC&#160;codes&#160;used&#160;by&#160;Bootloader&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>Note&#160;<br/></b>This&#160;NRC&#160;table includes&#160;an&#160;overall&#160;summary&#160;of&#160;the NRCs&#160;supported&#160;by&#160;the&#160;bootloader.&#160;<br/>
&#160;&#160;Your&#160;actual&#160;implementation&#160;may&#160;not&#160;use&#160;all&#160;of&#160;them.&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
21&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=22></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-22_1.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-22_2.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-22_3.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>3&#160;&#160;Flash&#160;Bootloader&#160;Delivery&#160;</b><br/>
<b>3.1&#160;</b><br/>
<b>Bootloader Components&#160;</b><br/>
The&#160;flash&#160;bootloader&#160;delivery&#160;contains&#160;the&#160;following&#160;components:&#160;<br/><b>&#160;&#160;</b>Flash&#160;bootloader&#160;source&#160;code&#160;<br/>
<b>&#160;&#160;</b>Configuration&#160;Tool GENy&#160;<br/>
<b>&#160;&#160;</b>Flash&#160;Driver source&#160;code&#160;and&#160;executable&#160;<br/>
<b>&#160;&#160;</b>Non-volatile&#160;memory&#160;module.&#160;Normally,&#160;a&#160;dummy&#160;EEPROM&#160;driver is delivered&#160;with&#160;the&#160;<br/>
bootloader.&#160;Drivers for external&#160;EEPROMs&#160;or&#160;EEPROM&#160;emulations can&#160;be&#160;ordered&#160;as&#160;<br/>optional components.&#160;<br/>
<b>&#160;&#160;</b>Security&#160;module&#160;(Security&#160;class DDD). Other&#160;security&#160;classes are optional.&#160;<br/>
<b>&#160;&#160;</b>Optional decompression&#160;module.&#160;<br/>
<b>&#160;&#160;</b>vFlash&#160;template&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>Caution&#160;<br/></b>The&#160;vFlash&#160;framework&#160;is&#160;not&#160;licensed&#160;with the&#160;bootloader.&#160;A&#160;license&#160;of&#160;the&#160;vFlash&#160;<br/>
<b>&#160;&#160;</b>framework&#160;has&#160;to be&#160;obtained separately.&#160;Please&#160;contact&#160;your&#160;Vector&#160;sales&#160;contact&#160;if&#160;<br/>
you&#160;need&#160;to obtain a&#160;license.&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>
<b>&#160;&#160;</b>HexView.&#160;HexView&#160;can&#160;be&#160;used&#160;to&#160;show&#160;and&#160;change&#160;the&#160;contents&#160;of&#160;various&#160;binary&#160;<br/>
formats.&#160;It&#160;can&#160;also&#160;be&#160;used&#160;for signature&#160;and&#160;checksum&#160;calculations&#160;<br/>
<b>&#160;&#160;</b>MakeSupport:&#160;Make&#160;system&#160;which&#160;can&#160;be&#160;used&#160;to&#160;compile&#160;the&#160;bootloader.&#160;<br/>
&#160;<br/>
<b>3.2&#160;</b><br/>
<b>Bootloader&#160;Integration&#160;</b><br/>
The&#160;&#160;integration&#160;&#160;of&#160;&#160;a&#160;&#160;flash&#160;&#160;bootloader&#160;&#160;project&#160;&#160;is&#160;&#160;described&#160;&#160;in&#160;&#160;this&#160;&#160;manual.&#160;&#160;If&#160;&#160;you&#160;&#160;are&#160;&#160;not&#160;<br/>familiar with&#160;Vector&#160;bootloaders,&#160;please&#160;see<a href="TechnicalReference_FBL_Vector_SLP3s.html#3">&#160;[5]&#160;</a>for&#160;more&#160;information.&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>Bootloader&#160;integration&#160;steps&#160;</b><br/>
&#160;&#160;1.&#160;&#160;Install&#160;the&#160;bootloader&#160;package&#160;<br/>
2.&#160;&#160;Start&#160;your&#160;own integration&#160;project&#160;<br/>3.&#160;&#160;Configure&#160;the&#160;bootloader&#160;using&#160;the&#160;configuration&#160;tool&#160;<br/>4.&#160;&#160;Adjust&#160;the&#160;user&#160;callback&#160;files&#160;from&#160;template&#160;<br/>5.&#160;&#160;Build the&#160;bootloader&#160;<br/>6.&#160;&#160;Adapt&#160;your&#160;application&#160;software&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
22&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=23></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-23_1.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-23_2.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>4&#160;&#160;Bootloader&#160;Installation&#160;</b><br/>
<b>4.1&#160;</b><br/>
<b>[#oem_files]&#160;-&#160;Bootloader package&#160;structure&#160;</b><br/>
For&#160;&#160;more&#160;&#160;general&#160;&#160;information&#160;&#160;about&#160;&#160;this&#160;&#160;see&#160;&#160;the&#160;&#160;UserManual_FlashBootloader&#160;&#160;in&#160;&#160;the&#160;&#160;chapter&#160;&#160;<b>Extract&#160;&#160;the&#160;<br/>files to&#160;a&#160;folder&#160;on&#160;your&#160;PC.&#160;<br/>&#160;<br/></b>You&#160;&#160;will&#160;&#160;get&#160;&#160;your&#160;&#160;software&#160;&#160;as&#160;&#160;an&#160;&#160;installer.&#160;&#160;After&#160;&#160;installation,&#160;&#160;a&#160;&#160;directory&#160;&#160;structure&#160;&#160;with&#160;<br/>several subfolders will&#160;be&#160;created:&#160;<br/>
<b>Directory&#160;&#160;Description&#160;<br/></b>BSW&#160;<br/>
Contains the&#160;bootloader&#160;source&#160;code&#160;(core&#160;files and&#160;<br/>template&#160;files).&#160;Files without&#160;leading&#160;underscore&#160;<br/>found&#160;in BSW&#160;and&#160;subfolders&#160;mustn’t&#160;be&#160;changed.&#160;<br/>
_Common&#160;&#160;Common&#160;modules,&#160;e.g.&#160;ECU-&#160;and compiler-specific&#160;<br/>
type&#160;definitions.&#160;<br/>
Eep&#160;<br/>
EEPROM&#160;driver.&#160;If&#160;no&#160;EEPROM&#160;driver&#160;has&#160;been&#160;<br/>ordered,&#160;this&#160;directory&#160;contains the&#160;dummy&#160;<br/>EEPROM&#160;driver.&#160;<br/>
Fbl&#160;<br/>
Bootloader&#160;source&#160;files.&#160;<br/>
_Template&#160;&#160;Contains the&#160;bootloader&#160;template&#160;files.&#160;You&#160;have&#160;to&#160;<br/>
adapt&#160;these&#160;files&#160;for&#160;your&#160;project.&#160;<br/>
Flash&#160;<br/>
Flash&#160;driver.&#160;Includes its&#160;own make&#160;system&#160;and&#160;<br/>binary&#160;file in&#160;Build.&#160;<br/>
SecMod&#160;<br/>
SecMod&#160;contains the&#160;security&#160;module.&#160;Depending&#160;<br/>on&#160;the&#160;security&#160;class supported&#160;by&#160;the&#160;bootloader,&#160;a&#160;<br/>library&#160;and source&#160;code&#160;can&#160;be&#160;included.&#160;<br/>
Demo&#160;<br/>
Root&#160;directory&#160;of&#160;demonstration&#160;application and&#160;<br/>demonstration&#160;bootloader.&#160;<br/>
DemoAppl&#160;&#160;Root&#160;directory&#160;of&#160;demonstration&#160;application.&#160;This&#160;<br/>
application is used&#160;to demonstrate&#160;the&#160;transition&#160;<br/>from&#160;application&#160;to&#160;bootloader&#160;and&#160;back.&#160;<br/>
DemoFbl&#160;<br/>
An example how&#160;the&#160;bootloader&#160;could&#160;be used.&#160;<br/>This&#160;example uses&#160;the&#160;bootloader&#160;source&#160;files&#160;from&#160;<br/>the&#160;Fbl&#160;directory&#160;and the&#160;adapted&#160;template&#160;files&#160;<br/>from&#160;“source”&#160;and&#160;“include subdirectories.&#160;<br/>
DemoKeys&#160;&#160;Demonstration&#160;keys&#160;for&#160;use with security&#160;class&#160;C&#160;or&#160;<br/>
CCC.&#160;This&#160;directory&#160;is&#160;optional.&#160;<br/>
Config&#160;<br/>
Example bootloader&#160;configuration&#160;(either&#160;GENy&#160;or&#160;<br/>Cfg5)&#160;<br/>
Appl&#160;<br/>
This&#160;directory&#160;contains&#160;the&#160;bootloader&#160;<br/>demonstration&#160;project.&#160;<br/>
&#160;<br/>
GenData<br/>
Figure&#160;4<br/>
&#160;<br/>
Generated&#160;files&#160;used&#160;in the&#160;demonstration&#160;<br/>
-1&#160;<br/>
Bootloader&#160;Folder&#160;Structure&#160;<br/>
bootloader.&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
23&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=24></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-24_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>Directory&#160;</b><br/>
<b>Description&#160;</b><br/>
include&#160;<br/>
Adapted&#160;header&#160;templates of&#160;demonstration project.&#160;<br/>
source&#160;<br/>
Adapted&#160;Source&#160;templates of&#160;demonstration project.&#160;<br/>
Doc&#160;<br/>
Bootloader&#160;documentation,&#160;e.g.&#160;UserManual,&#160;this&#160;manual,&#160;Reference&#160;Manual&#160;<br/>Hardware,&#160;Reference Manual&#160;Security&#160;Module (optional)&#160;and project&#160;specific&#160;<br/>documentation.&#160;<br/>
FlashTool&#160;<br/>
vFlash&#160;template&#160;installer,&#160;example Seed/Key&#160;DLL&#160;and Visual&#160;Studio project&#160;to&#160;<br/>adapt&#160;the&#160;Seed/Key&#160;DLL.&#160;<br/>
Generators&#160;<br/>
Project&#160;specific&#160;part&#160;of&#160;the&#160;generation&#160;tool.&#160;<br/>
MakeSupport&#160;<br/>
Make system&#160;to&#160;recompile the&#160;demonstration&#160;bootloader.&#160;<br/>
Misc&#160;<br/>
Additional&#160;tools&#160;like&#160;HexView.&#160;<br/>
Table&#160;4-1&#160;&#160;&#160;Bootloader&#160;Folder&#160;Structure&#160;<br/>
<b>4.2&#160;</b><br/>
<b>Demonstration Bootloader&#160;</b><br/>
The&#160;.\Demo\DemoFbl\Appl&#160;directory&#160;contains&#160;an&#160;exemplary&#160;bootloader&#160;integration&#160;project.&#160;<br/>The&#160;bootloader&#160;template&#160;files from&#160;.\BSW\Fbl\_Template&#160;have&#160;been&#160;copied&#160;to&#160;“source”&#160;and&#160;<br/>“include”&#160;subdirectories&#160;of&#160;the&#160;DemoFbl&#160;directory.&#160;The&#160;“GenData”&#160;subdirectory&#160;contains&#160;the&#160;<br/>necessary&#160;&#160;files&#160;&#160;for&#160;&#160;the&#160;&#160;configuration&#160;&#160;of&#160;&#160;the&#160;&#160;bootloader.&#160;&#160;These&#160;&#160;files&#160;&#160;are&#160;&#160;created&#160;&#160;by&#160;&#160;the&#160;<br/>generation&#160;tool.&#160;<br/>
&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
24&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=25></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-25_1.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-25_2.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>5&#160;&#160;Generation&#160;Tool&#160;(GENy)&#160;</b><br/>
Standard&#160;&#160;configurations&#160;&#160;are&#160;&#160;done&#160;&#160;with&#160;&#160;the&#160;&#160;generation&#160;&#160;tool&#160;&#160;GENy.&#160;&#160;The&#160;&#160;generation&#160;&#160;tool&#160;&#160;is&#160;<br/>installed&#160;automatically&#160;during&#160;the&#160;delivery&#160;install.&#160;A&#160;link&#160;to&#160;GENy&#160;is&#160;added&#160;to&#160;your&#160;PC’s&#160;start&#160;<br/>menu.&#160;<br/>
<b>5.1&#160;</b><br/>
<b>Project Setup&#160;</b><br/>
To&#160;&#160;create&#160;&#160;a&#160;&#160;new&#160;&#160;configuration,&#160;&#160;please&#160;&#160;select&#160;&#160;“New…”&#160;&#160;from&#160;&#160;the&#160;&#160;File&#160;&#160;menu.&#160;The&#160;&#160;following&#160;<br/>dialog&#160;will appear:&#160;<br/>
&#160;<br/>
&#160;<br/>
Figure&#160;5-1&#160;&#160;GENy&#160;Setup&#160;Dialog&#160;<br/>
The&#160;actual&#160;field&#160;values&#160;will&#160;&#160;vary,&#160;&#160;depending&#160;on&#160;your&#160;delivery&#160;license&#160;and&#160;&#160;hardware.&#160;&#160;Note&#160;<br/>that&#160;&#160;several&#160;&#160;pre-configurations&#160;&#160;can&#160;&#160;exist.&#160;&#160;Please&#160;&#160;check,&#160;&#160;which&#160;&#160;one&#160;&#160;fits&#160;&#160;the&#160;&#160;most&#160;&#160;to&#160;&#160;your&#160;<br/>configuration.&#160;<br/>The&#160;&#160;setup&#160;&#160;dialog&#160;&#160;can&#160;&#160;include&#160;&#160;different&#160;&#160;pre-configuration&#160;&#160;variants&#160;&#160;if&#160;&#160;different&#160;&#160;bootloader&#160;<br/>addressing&#160;&#160;modes&#160;&#160;or&#160;&#160;other&#160;&#160;options&#160;&#160;which&#160;&#160;affect&#160;&#160;the&#160;&#160;communication&#160;&#160;configuration&#160;&#160;are&#160;<br/>included.&#160;The&#160;following&#160;options can&#160;be&#160;configured&#160;with&#160;different&#160;pre-configuration:&#160;<br/><b>&#160;&#160;</b>NormalFixed&#160;Addressing&#160;or Extended&#160;Addressing&#160;<br/>
<b>&#160;&#160;</b>XCP&#160;<br/>
The&#160;main&#160;GENy&#160;window&#160;will&#160;be&#160;updated&#160;as&#160;shown&#160;below&#160;once&#160;the&#160;initial&#160;setup&#160;has&#160;been&#160;<br/>completed.&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
25&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=26></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-26_1.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-26_2.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-26_3.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-26_4.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
&#160;<br/>
Figure&#160;5-2&#160;&#160;GENy&#160;main&#160;window&#160;after&#160;pre-configuration&#160;<br/>
You&#160;have&#160;to&#160;select&#160;the&#160;communication&#160;database&#160;(.dbc)&#160;in&#160;the&#160;next&#160;step.&#160;This&#160;file&#160;should&#160;be&#160;<br/>provided&#160;&#160;by&#160;&#160;your&#160;&#160;OEM.&#160;&#160;The&#160;&#160;database&#160;&#160;file&#160;&#160;is&#160;&#160;selected&#160;&#160;by&#160;&#160;using&#160;&#160;Configuration/Add&#160;<br/>Channel/CAN or the&#160;“+” icon.&#160;<br/>Once&#160;the&#160;database&#160;has&#160;been&#160;selected,&#160;a&#160;list&#160;of&#160;ECU&#160;Nodes&#160;defined&#160;by&#160;the&#160;database&#160;will&#160;<br/>appear&#160;in&#160;the&#160;“Database&#160;Nodes”&#160;field.&#160;Please&#160;select&#160;the&#160;node&#160;which&#160;should&#160;be&#160;used&#160;by&#160;the&#160;<br/>FBL.&#160;&#160;Multiple&#160;&#160;nodes&#160;&#160;may&#160;&#160;be&#160;&#160;selected&#160;&#160;if&#160;&#160;your&#160;&#160;ECU&#160;&#160;is&#160;&#160;used&#160;&#160;multiple&#160;&#160;times&#160;&#160;in&#160;&#160;the&#160;&#160;same&#160;<br/>vehicle.&#160;You&#160;can&#160;choose&#160;the&#160;actual&#160;node&#160;during&#160;the&#160;bootloader’s startup.&#160;<br/>
&#160;<br/>
Figure&#160;5-3&#160;&#160;GENy&#160;Channel&#160;Setup&#160;(CAN&#160;or&#160;LIN)&#160;<br/>
After&#160;&#160;the&#160;&#160;node&#160;&#160;was&#160;&#160;selected,&#160;&#160;you&#160;&#160;can&#160;&#160;activate&#160;&#160;the&#160;&#160;GENy&#160;&#160;modules&#160;&#160;used&#160;&#160;to&#160;&#160;configure&#160;&#160;the&#160;<br/>bootloader.&#160;<br/>
&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
26&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=27></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-27_1.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-27_2.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-27_3.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>Caution&#160;<br/></b>The&#160;CAN&#160;ID&#160;settings&#160;configured&#160;in&#160;the&#160;database&#160;are automatically&#160;included&#160;into&#160;the&#160;<br/>
<b>&#160;&#160;</b>bootloader&#160;configuration&#160;during&#160;the&#160;initial&#160;setup&#160;when the&#160;database&#160;is&#160;configured&#160;first.&#160;<br/>
If&#160;the&#160;database&#160;of&#160;an&#160;already&#160;existing&#160;configuration&#160;is&#160;changed,&#160;the&#160;communication&#160;<br/>settings&#160;are&#160;not&#160;automatically&#160;reconfigured&#160;to prevent&#160;overwriting&#160;of&#160;manually&#160;adapted&#160;<br/>settings.&#160;<br/>The&#160;changes&#160;have to be&#160;reloaded manually&#160;using&#160;GENy&#160;module FblWrapperCom_Can.&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>&#160;<br/>
&#160;<br/>
Figure&#160;5-4&#160;&#160;GENy&#160;main&#160;window&#160;after&#160;channel&#160;setup&#160;<br/>
At&#160;this&#160;point,&#160;you&#160;must&#160;add&#160;the&#160;Software&#160;Components&#160;for&#160;the&#160;FBL&#160;to&#160;the&#160;channel&#160;that&#160;was&#160;<br/>defined.&#160;Click&#160;on&#160;the&#160;check-boxes&#160;in&#160;the&#160;Channel&#160;0&#160;column&#160;for&#160;each&#160;component.&#160;Continue&#160;<br/>by&#160;adding&#160;the&#160;FblDrvCan_&lt;hardware&gt;&#160;and&#160;FblCan_14229_Vector components.&#160;<br/>After&#160;the&#160;Software&#160;Components&#160;have&#160;been&#160;selected,&#160;you&#160;should&#160;expand&#160;the&#160;tree&#160;list&#160;in&#160;the&#160;<br/>leftmost&#160;&#160;window&#160;&#160;to&#160;&#160;select&#160;&#160;between&#160;&#160;the&#160;&#160;component-configuration&#160;&#160;windows.&#160;&#160;The&#160;&#160;tree&#160;&#160;is&#160;<br/>expanded&#160;by&#160;clicking&#160;on&#160;the&#160;‚+’&#160;button,&#160;or by&#160;double-clicking&#160;on&#160;the&#160;“Components” label.&#160;<br/>
&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
27&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=28></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-28_1.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-28_2.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-28_3.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>Note&#160;<br/></b>Component&#160;selections&#160;for&#160;Tx&#160;Messages,&#160;Rx&#160;Messages,&#160;Tx&#160;Signals&#160;and&#160;Rx&#160;Signals&#160;are&#160;<br/>
&#160;&#160;not&#160;relevant&#160;for&#160;standard&#160;bootloader&#160;configurations.&#160;<br/>
If&#160;your&#160;bootloader&#160;delivery&#160;uses&#160;a communication&#160;driver&#160;from&#160;CANbedded&#160;or&#160;Microsar,&#160;<br/>this&#160;information&#160;is&#160;relevant.&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>If&#160;all&#160;necessary&#160;components&#160;are&#160;activated,&#160;GENy&#160;should&#160;look&#160;like&#160;this:&#160;<br/>
&#160;<br/>
Figure&#160;5-5&#160;&#160;GENy&#160;Components&#160;<br/>
Before&#160;&#160;proceeding&#160;&#160;to&#160;&#160;component&#160;&#160;configuration,&#160;&#160;you&#160;&#160;should&#160;&#160;save&#160;&#160;the&#160;&#160;configuration.&#160;&#160;Once&#160;<br/>the&#160;&#160;configuration&#160;&#160;has&#160;&#160;been&#160;&#160;saved,&#160;&#160;you&#160;&#160;should&#160;&#160;select&#160;&#160;“Generation&#160;&#160;Paths...”&#160;&#160;from&#160;&#160;the&#160;<br/>Configuration&#160;menu.&#160;<br/>By&#160;default,&#160;GENy&#160;will&#160;place&#160;the&#160;generated&#160;files&#160;into&#160;the&#160;Project&#160;Directory.&#160;You&#160;may&#160;enter&#160;a&#160;<br/>new&#160;path&#160;relative&#160;to&#160;the&#160;Project&#160;Directory,&#160;or&#160;enter&#160;a&#160;path&#160;relative&#160;to&#160;the&#160;GENy’s&#160;working-<br/>directory&#160;(the&#160;directory,&#160;where GENy&#160;is executed&#160;from), or you&#160;may&#160;enter an&#160;absolute&#160;path.&#160;<br/>After pressing&#160;OK,&#160;you&#160;are ready&#160;to&#160;configure the&#160;individual components.&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
28&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=29></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-29_1.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-29_2.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-29_3.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>5.2&#160;</b><br/>
<b>CAN configuration&#160;</b><br/>
The&#160;CAN&#160;controller&#160;is&#160;configured&#160;by&#160;expanding&#160;the&#160;“Channels”&#160;component,&#160;and&#160;selecting&#160;<br/>the&#160;“Channel&#160;0”&#160;component&#160;from&#160;the&#160;tree&#160;list.&#160;The&#160;contents&#160;of&#160;the&#160;window&#160;on&#160;the&#160;right&#160;will&#160;<br/>be&#160;&#160;highly&#160;&#160;dependent&#160;&#160;on&#160;&#160;the&#160;&#160;hardware&#160;&#160;that&#160;&#160;has&#160;&#160;been&#160;&#160;selected.&#160;&#160;Refer&#160;&#160;to&#160;&#160;the&#160;<br/>TechnicalReference_FBL_&lt;hardware&gt;.pdf&#160;that&#160;is&#160;also&#160;located&#160;in&#160;the&#160;documentation&#160;folder&#160;<br/>of&#160;your delivery.&#160;<br/>An&#160;example&#160;of&#160;the&#160;CAN configuration&#160;window&#160;is shown&#160;below:&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>Note&#160;<br/></b>Note&#160;that&#160;this&#160;bootloader&#160;supports&#160;only&#160;one&#160;channel&#160;if&#160;nothing else is&#160;mentioned&#160;in&#160;<br/>
&#160;&#160;project&#160;specific&#160;documentation.&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>
&#160;<br/>
Figure&#160;5-6&#160;&#160;GENy&#160;CAN&#160;configuration&#160;<br/>
By&#160;default,&#160;GENy&#160;initializes&#160;the&#160;CAN&#160;hardware&#160;as&#160;high&#160;speed&#160;CAN&#160;(500.0&#160;KBPS).&#160;Use&#160;the&#160;<br/>“Bustiming&#160;Configuration” dialog&#160;to&#160;select&#160;the&#160;appropriate&#160;baud&#160;rate.&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
29&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=30></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-30_1.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-30_2.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-30_3.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>5.3&#160;</b><br/>
<b>CAN ID configuration&#160;</b><br/>
In&#160;&#160;case&#160;&#160;a&#160;&#160;bootloader&#160;&#160;CAN&#160;&#160;stack&#160;&#160;is&#160;&#160;used,&#160;&#160;CAN&#160;&#160;IDs&#160;&#160;can&#160;&#160;be&#160;&#160;configured&#160;&#160;with&#160;&#160;the&#160;&#160;GENy&#160;<br/>module&#160;FblWrapperCom_Can.&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>Note&#160;<br/></b>Vector&#160;SLP3&#160;bootloaders&#160;are&#160;delivered&#160;with support&#160;for&#160;Normal&#160;Addressing.&#160;If&#160;<br/>
&#160;&#160;NormalFixed&#160;Addressing&#160;or&#160;Extended&#160;Addressing is required,&#160;support&#160;for&#160;these&#160;<br/>
addressing&#160;modes has&#160;to be&#160;requested&#160;with the&#160;bootloader&#160;order.&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>The&#160;module&#160;can&#160;be&#160;delivered&#160;in&#160;two&#160;variants:&#160;<br/><b>&#160;&#160;</b>Standard&#160;CAN configuration:&#160;The&#160;connections,&#160;CAN objects&#160;and&#160;handler&#160;functions are&#160;<br/>
pre-configured&#160;and&#160;write&#160;protected.&#160;The&#160;CAN identifiers&#160;of&#160;the&#160;.dbc&#160;file&#160;provided&#160;to&#160;the&#160;<br/>bootloader&#160;are&#160;used&#160;and&#160;can&#160;be&#160;overwritten.&#160;<br/>
<b>&#160;&#160;</b>Extended&#160;CAN configuration:&#160;The&#160;connections,&#160;CAN&#160;objects&#160;and&#160;handler&#160;functions can&#160;<br/>
be&#160;changed&#160;by&#160;the&#160;user.&#160;This setting&#160;is used&#160;if&#160;a&#160;bootloader&#160;supports&#160;several&#160;<br/>addressing&#160;modes which&#160;can&#160;be&#160;configured&#160;in&#160;GENy&#160;or is delivered&#160;with&#160;several&#160;<br/>access options&#160;like&#160;UDS&#160;or XCP.&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>Caution&#160;<br/></b>The&#160;bootloader&#160;connection&#160;configuration&#160;has&#160;to&#160;be verified&#160;carefully&#160;if&#160;the&#160;extended&#160;<br/>
<b>&#160;&#160;</b>CAN&#160;configuration&#160;is&#160;changed.&#160;It&#160;is&#160;possible&#160;to create&#160;configurations&#160;which do&#160;not&#160;fulfill&#160;<br/>
all&#160;bootloader&#160;requirements.&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
30&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=31></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-31_1.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-31_2.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
&#160;<br/>
Figure&#160;5-7&#160;&#160;FblWrapperCom_Can&#160;GENy&#160;module&#160;<br/>
This&#160;&#160;module&#160;&#160;includes&#160;&#160;a&#160;&#160;tree&#160;&#160;structure&#160;&#160;to&#160;&#160;configure&#160;&#160;the&#160;&#160;bootloader&#160;&#160;CAN&#160;&#160;messages&#160;&#160;and&#160;<br/>some&#160;overall&#160;options on&#160;the&#160;main&#160;page.&#160;<br/>
&#160;<br/>
<b>Configuration&#160;Option&#160;</b><br/>
<b>Description&#160;</b><br/>
User&#160;Config File&#160;<br/>
The&#160;path&#160;and name of&#160;a&#160;file&#160;to be&#160;included&#160;in&#160;the&#160;generated&#160;<br/>configuration&#160;file&#160;fbl_cw_cfg.h&#160;may&#160;be&#160;specified.&#160;The&#160;file&#160;may&#160;be&#160;<br/>used to&#160;activate&#160;features&#160;of&#160;the&#160;FBL&#160;that&#160;are not&#160;included&#160;in the&#160;<br/>GENy&#160;components.&#160;Normally,&#160;this&#160;field is&#160;blank.&#160;<br/>
Restore&#160;default&#160;<br/>
Restores&#160;the&#160;default&#160;configuration&#160;using&#160;pre-configured&#160;data&#160;<br/>and the&#160;data&#160;read&#160;from&#160;the&#160;communication&#160;database.&#160;<br/>Please note:&#160;Data&#160;which has&#160;been&#160;manually&#160;adapted&#160;is&#160;<br/>overwritten.&#160;<br/>
Delete&#160;everything&#160;<br/>
Deletes&#160;the&#160;complete&#160;CAN&#160;ID&#160;setup.&#160;<br/>
Lowest&#160;Functional&#160;Address&#160;<br/>
Specify&#160;the&#160;lowest&#160;functional&#160;address&#160;for&#160;Extended&#160;Addressing.&#160;<br/>
Highest&#160;Functional&#160;Address&#160;<br/>
Specify&#160;the&#160;highest&#160;functional&#160;address&#160;for&#160;Extended&#160;Addressing.&#160;<br/>
Receive Ranges&#160;<br/>
Add&#160;receive ranges&#160;for&#160;addressing&#160;modes like NormalFixed&#160;<br/>Addressing&#160;or&#160;Extended&#160;Addressing.&#160;This&#160;option&#160;is&#160;write&#160;<br/>protected.&#160;<br/>
Table&#160;5-1&#160;&#160;&#160;FblWrapperCom_Can&#160;main page&#160;GENy&#160;options&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
31&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=32></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-32_1.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-32_2.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-32_3.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
The&#160;&#160;CAN&#160;&#160;connections&#160;&#160;used&#160;&#160;by&#160;&#160;the&#160;&#160;bootloader&#160;&#160;are&#160;&#160;configured&#160;&#160;in&#160;&#160;the&#160;following&#160;&#160;table.&#160;This&#160;<br/>table&#160;is write-protected&#160;if&#160;a&#160;standard CAN configuration&#160;setup&#160;is&#160;used.&#160;<br/>
&#160;<br/>
Figure&#160;5-8&#160;&#160;CAN&#160;connection&#160;table&#160;<br/>
<b>Configuration&#160;Option&#160;</b><br/>
<b>Description&#160;</b><br/>
CAN&#160;Message&#160;<br/>
Documents&#160;the&#160;purpose&#160;of&#160;the&#160;used&#160;CAN&#160;message.&#160;<br/>
Direction&#160;<br/>
Request&#160;or&#160;response&#160;<br/>
Indication/Confirmation&#160;<br/>
Configures which&#160;function&#160;is&#160;called&#160;if&#160;a&#160;request&#160;is&#160;received&#160;or&#160;a&#160;<br/>
Function&#160;<br/>
response is&#160;successfully&#160;transmitted.&#160;<br/>
Message Object&#160;<br/>
Software&#160;receive object&#160;list&#160;or&#160;transmit&#160;object&#160;list&#160;index.&#160;<br/>
Nodes&#160;<br/>
Number&#160;of&#160;nodes&#160;used&#160;for&#160;this&#160;message.&#160;If&#160;there&#160;is&#160;more&#160;than&#160;<br/>one node&#160;available,&#160;it&#160;can be&#160;selected&#160;during&#160;the&#160;bootloader’s&#160;<br/>startup.&#160;<br/>
Addressing&#160;Mode&#160;<br/>
Checks&#160;if&#160;a&#160;message&#160;is&#160;used&#160;for&#160;a&#160;Normal&#160;addressing,&#160;<br/>NormalFixed&#160;addressing&#160;or&#160;Extended addressing.&#160;<br/>
Receive Handle&#160;<br/>
Parameter&#160;which is handed&#160;over&#160;by&#160;the&#160;CAN&#160;driver.&#160;It&#160;identifies&#160;<br/>the&#160;receive object&#160;set&#160;by&#160;the&#160;CAN&#160;driver.&#160;<br/>
Table&#160;5-2&#160;&#160;&#160;GENy&#160;–&#160;CAN&#160;connection&#160;table&#160;<br/>
Every&#160;message&#160;can&#160;include&#160;several&#160;CAN&#160;IDs&#160;(in&#160;case&#160;of&#160;a&#160;multiple&#160;nodes&#160;setup).&#160;The&#160;CAN&#160;<br/>IDs for each&#160;node&#160;can&#160;be&#160;configured&#160;in&#160;this table:&#160;<br/>
&#160;<br/>
Figure&#160;5-9&#160;&#160;GENy&#160;–&#160;CAN&#160;message&#160;table&#160;<br/>
<b>Configuration&#160;Option&#160;</b><br/>
<b>Description&#160;</b><br/>
CAN&#160;ID&#160;<br/>
Value&#160;of&#160;the CAN&#160;ID&#160;which is sent&#160;or&#160;received.&#160;<br/>
Extended Identifier&#160;<br/>
If&#160;this&#160;checkbox&#160;is&#160;set,&#160;the CAN&#160;ID&#160;is&#160;configured&#160;as&#160;a 29-Bit&#160;<br/>CAN&#160;ID.&#160;<br/>
PGN&#160;<br/>
PGN&#160;used&#160;for&#160;NormalFixed&#160;addressing.&#160;<br/>
Base&#160;Address&#160;<br/>
Receive range base address&#160;for&#160;Extended addressing.&#160;<br/>
Target&#160;Address&#160;<br/>
Target&#160;address&#160;of&#160;a&#160;CAN&#160;message.&#160;Identifies&#160;the&#160;ECU&#160;in case&#160;a&#160;<br/>message&#160;is&#160;received&#160;and the&#160;tester&#160;in case&#160;a&#160;message&#160;is&#160;sent.&#160;<br/>
Source&#160;Address&#160;<br/>
Source&#160;Address&#160;of&#160;a&#160;CAN&#160;message.&#160;Identifies&#160;the ECU&#160;in case&#160;<br/>a message is&#160;sent&#160;and&#160;the tester&#160;in case&#160;a&#160;message&#160;is&#160;received.&#160;<br/>
Description&#160;<br/>
Comment&#160;to identify&#160;the&#160;CAN&#160;node&#160;and&#160;message.&#160;<br/>
Table&#160;5-3&#160;&#160;&#160;GENy&#160;–&#160;CAN&#160;message&#160;table&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
32&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=33></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-33_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>5.4&#160;</b><br/>
<b>Bootloader Configuration&#160;</b><br/>
The&#160;&#160;features&#160;&#160;of&#160;&#160;the&#160;&#160;bootloader&#160;&#160;are&#160;&#160;configured&#160;&#160;in&#160;&#160;two&#160;&#160;separate&#160;&#160;components:&#160;<br/>FblDrvCan_&lt;hardware&gt;,&#160;&#160;and&#160;&#160;FblCan_14229_Vector.&#160;&#160;Configuration&#160;&#160;options&#160;&#160;for&#160;&#160;the&#160;<br/>selected&#160;component&#160;on&#160;the&#160;left&#160;will be&#160;shown&#160;on&#160;the&#160;right&#160;panel.&#160;<br/>The&#160;&#160;FblDrvCan&#160;&#160;component&#160;&#160;contains&#160;&#160;both&#160;&#160;hardware-specific,&#160;&#160;and&#160;&#160;hardware&#160;&#160;independent&#160;<br/>selections.&#160;&#160;For&#160;&#160;details&#160;&#160;of&#160;&#160;the&#160;&#160;hardware-specific&#160;&#160;features,&#160;&#160;please&#160;&#160;refer&#160;&#160;to&#160;&#160;the&#160;&#160;document&#160;<br/>“Technical Reference&#160;Hardware”.&#160;<br/>The&#160;&#160;figure&#160;&#160;shown&#160;&#160;below&#160;&#160;shows&#160;&#160;the&#160;&#160;hardware&#160;&#160;independent&#160;&#160;sections&#160;&#160;of&#160;&#160;the&#160;&#160;FblDrvCan&#160;<br/>component:&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
33&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=34></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-34_1.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-34_2.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
&#160;<br/>
Figure&#160;5-10&#160;&#160;GENy&#160;General&#160;FBL&#160;configuration&#160;<br/>
&#160;<br/>
&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
34&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=35></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-35_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
Each&#160;field&#160;is described&#160;below:&#160;<br/>
<b>Configuration&#160;Option&#160;</b><br/>
<b>Description&#160;</b><br/>
User&#160;Config File&#160;<br/>
The&#160;path&#160;and name of&#160;a&#160;file&#160;to be&#160;included&#160;in&#160;the&#160;generated&#160;<br/>configuration&#160;file&#160;fbl_cfg.h may&#160;be&#160;specified.&#160;The&#160;file may&#160;be&#160;<br/>used to&#160;activate&#160;features&#160;of&#160;the&#160;FBL&#160;that&#160;are not&#160;included&#160;in the&#160;<br/>GENy&#160;components.&#160;Normally,&#160;this&#160;field is&#160;blank.&#160;<br/>
Project&#160;State&#160;<br/>
Project&#160;state&#160;controls&#160;the&#160;number&#160;of&#160;internal&#160;checks&#160;done&#160;by&#160;<br/>the&#160;bootloader.&#160;There&#160;are 3&#160;levels&#160;available:&#160;<br/>&#160;&#160;Integration:&#160;Detailed&#160;checks&#160;to&#160;find&#160;configuration&#160;errors.&#160;This&#160;level&#160;<br/>
should be&#160;activated&#160;during&#160;the&#160;integration&#160;phase.&#160;<br/>
&#160;&#160;Production: Checks&#160;for all&#160;errors&#160;which might occur during&#160;normal&#160;<br/>
use of&#160;the&#160;bootloader. Should be used if&#160;the&#160;bootloader&#160;is&#160;ready&#160;for&#160;<br/>production.&#160;<br/>
&#160;&#160;Production&#160;(reduced checks): Can&#160;be&#160;used&#160;to&#160;reduce&#160;code size.&#160;<br/>
Please&#160;note&#160;that&#160;errors&#160;probably&#160;are detected later&#160;and that error&#160;<br/>messages&#160;like NRCs&#160;are more difficult to&#160;interpret&#160;if&#160;this&#160;setting&#160;is&#160;<br/>activated.&#160;We therefore recommend to use the&#160;Production&#160;error&#160;<br/>reporting&#160;level.&#160;<br/>
Stay&#160;In Boot&#160;<br/>
This&#160;switch enables the&#160;“Force Boot&#160;Mode”&#160;feature.&#160;Please see&#160;<br/>chapter<a href="TechnicalReference_FBL_Vector_SLP3s.html#74">&#160;10.1.3&#160;</a>-<a href="TechnicalReference_FBL_Vector_SLP3s.html#74">&#160;Force&#160;Boot&#160;Mode&#160;</a>for&#160;further&#160;information.&#160;<br/>
Maximum&#160;Number&#160;of&#160;Segments&#160;&#160;Maximum&#160;number&#160;of&#160;segments&#160;in a&#160;logical&#160;block.&#160;This&#160;value&#160;<br/>
specifies&#160;how&#160;many&#160;sections&#160;are&#160;allowed&#160;for&#160;one&#160;logical&#160;block.&#160;<br/>
Sleep Mode&#160;<br/>
If&#160;this&#160;switch is enabled,&#160;ApplFblBusSleep()&#160;will&#160;be called&#160;after&#160;<br/>a configurable&#160;time&#160;without&#160;diagnostic&#160;communication&#160;has&#160;<br/>expired.&#160;<br/>
Sleep&#160;Time&#160;[ms]&#160;<br/>
Activation time of&#160;sleep&#160;mode.&#160;<br/>
Application&#160;Task&#160;<br/>
When selected,&#160;the&#160;FBL&#160;will&#160;periodically&#160;call&#160;ApplFblTask()&#160;<br/>while it&#160;is&#160;idle.&#160;This&#160;function&#160;may&#160;be&#160;customized&#160;by&#160;you&#160;to&#160;<br/>implement&#160;idle task&#160;operations.&#160;<br/>
Bootloader&#160;Header&#160;Address&#160;<br/>
The&#160;address&#160;of&#160;the&#160;constant&#160;FblHeader&#160;has&#160;to be&#160;entered&#160;here.&#160;<br/>The&#160;value&#160;has&#160;to&#160;match&#160;the&#160;address&#160;used&#160;by&#160;your&#160;linker&#160;to&#160;map&#160;<br/>the&#160;header&#160;to its&#160;proper&#160;location.&#160;<br/>
Diagnostic&#160;Buffer&#160;Size [B]&#160;<br/>
This&#160;is&#160;the&#160;amount&#160;of&#160;memory&#160;(in bytes)&#160;reserved&#160;for&#160;data&#160;in&#160;<br/>diagnostic&#160;request&#160;messages.&#160;The&#160;value&#160;may&#160;be&#160;up&#160;to&#160;4095.&#160;<br/>
P2&#160;Time&#160;[ms]&#160;<br/>
P2 diagnostic&#160;timeout.&#160;The&#160;bootloader&#160;will&#160;send a&#160;response&#160;or&#160;<br/>response pending message&#160;before&#160;this&#160;timeout&#160;expires.&#160;<br/>
P2*&#160;Time&#160;[ms]&#160;<br/>
P2*&#160;diagnostic&#160;timeout.&#160;This&#160;timeout&#160;will&#160;be&#160;used instead of&#160;the&#160;<br/>P2 timeout&#160;if&#160;a&#160;response&#160;pending&#160;message&#160;has&#160;been sent.&#160;<br/>
Gap&#160;Filling&#160;<br/>
This&#160;feature is&#160;used&#160;to&#160;fill&#160;unused areas&#160;of&#160;a logical&#160;block with a&#160;<br/>specific&#160;value.&#160;<br/>
Fill&#160;Code&#160;<br/>
When writing&#160;data&#160;to&#160;a non-volatile memory&#160;device,&#160;the&#160;number&#160;<br/>of&#160;bytes written&#160;must&#160;be&#160;a multiple of&#160;the&#160;device’s&#160;write-<br/>segment&#160;size.&#160;If&#160;an&#160;address-region&#160;does not&#160;end&#160;on&#160;a write-<br/>segment&#160;boundary,&#160;the&#160;FBL&#160;will&#160;fill&#160;the&#160;unused&#160;bytes with the&#160;<br/>value&#160;specified&#160;in&#160;this&#160;field.&#160;<br/>The&#160;fill&#160;code is&#160;also used&#160;if&#160;gap&#160;filling&#160;is&#160;activated.&#160;<br/>
Internal&#160;Memory&#160;Copy&#160;<br/>
Activates&#160;a bootloader&#160;specific&#160;memory&#160;copy&#160;function.&#160;If&#160;<br/>deactivated,&#160;the&#160;memory&#160;copy&#160;function&#160;of&#160;the compiler&#160;library&#160;is&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
35&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=36></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-36_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>Configuration&#160;Option&#160;</b><br/>
<b>Description&#160;<br/></b>used.&#160;<br/>
Presence&#160;Pattern&#160;<br/>
If&#160;this&#160;option&#160;is&#160;enabled,&#160;the&#160;bootloader&#160;will&#160;use&#160;flash memory&#160;at&#160;<br/>the&#160;end&#160;of&#160;each logical&#160;block to&#160;store&#160;the&#160;block&#160;validity&#160;<br/>information&#160;instead&#160;of&#160;using&#160;NV-memory.&#160;<br/>
FblStart&#160;Function&#160;<br/>
The&#160;bootloader&#160;provides&#160;a&#160;function&#160;to start&#160;the&#160;programming&#160;<br/>session&#160;from&#160;the&#160;application&#160;(The&#160;function&#160;can&#160;be&#160;called&#160;using&#160;<br/>the&#160;FblHeader&#160;structure).&#160;If&#160;this&#160;feature is enabled,&#160;flags&#160;in&#160;<br/>shared&#160;RAM&#160;or&#160;non-volatile memory&#160;are&#160;not&#160;needed&#160;to&#160;invoke&#160;<br/>the&#160;bootloader.&#160;<br/>
Response&#160;After&#160;Reset&#160;<br/>
This&#160;setting&#160;is&#160;used&#160;to&#160;decide&#160;if&#160;the&#160;bootloader&#160;should send a&#160;<br/>positive response&#160;to default&#160;session&#160;or&#160;reset&#160;requests&#160;<br/>(deactivated)&#160;or&#160;the&#160;application software&#160;should&#160;send this&#160;<br/>response after&#160;a&#160;reset.&#160;<br/>If&#160;activated,&#160;the&#160;bootloader&#160;will&#160;send a&#160;response&#160;pending&#160;<br/>message&#160;before issuing&#160;the&#160;reset.&#160;<br/>
User&#160;Subfunction&#160;<br/>
Enables a&#160;callback&#160;function&#160;which could be&#160;used&#160;to add&#160;<br/>additional&#160;sub-functions&#160;to existing&#160;services.&#160;<br/>
User&#160;Service&#160;<br/>
Enables a&#160;callback&#160;function&#160;which allows&#160;the&#160;implementation&#160;of&#160;<br/>additional&#160;diagnostic&#160;services.&#160;<br/>
User&#160;Routine&#160;<br/>
Enables a&#160;callback&#160;function&#160;which allows&#160;the&#160;implementation&#160;of&#160;<br/>additional&#160;Routine&#160;Identifiers.&#160;<br/>
Flash&#160;Driver&#160;Usage&#160;<br/>
Configures how&#160;the&#160;flash&#160;driver&#160;is&#160;copied&#160;to&#160;RAM&#160;<br/>&#160;Download Driver:&#160;Flash&#160;Driver&#160;is&#160;downloaded to&#160;ECU&#160;with&#160;<br/>
the&#160;configured&#160;bus&#160;system.&#160;<br/>
&#160;Use Flash&#160;Driver&#160;from&#160;ROM:&#160;Flash&#160;Driver&#160;is&#160;stored in&#160;an&#160;<br/>
encrypted&#160;ROM&#160;image in&#160;the&#160;bootloader's&#160;flash&#160;memory&#160;and&#160;<br/>copied&#160;to RAM&#160;before&#160;initialization.&#160;<br/>
&#160;Optional&#160;Flash&#160;Driver&#160;Download:&#160;Flash&#160;Driver&#160;can&#160;be&#160;<br/>
downloaded to&#160;the&#160;ECU.&#160;If&#160;it&#160;isn't&#160;downloaded,&#160;the&#160;flash&#160;<br/>driver&#160;from&#160;an internal&#160;image&#160;will&#160;be&#160;used.&#160;<br/>
Encryption Mode&#160;<br/>
Optional&#160;feature.&#160;If&#160;activated,&#160;the&#160;bootloader&#160;an&#160;interface&#160;to&#160;<br/>decrypt&#160;data&#160;after&#160;download.&#160;<br/>
Compression&#160;Mode&#160;<br/>
Optional&#160;feature.&#160;If&#160;activated,&#160;the&#160;bootloader&#160;provides&#160;an&#160;<br/>interface&#160;to&#160;decompress&#160;data.&#160;<br/>
Data&#160;processing&#160;buffer&#160;size [B]&#160;&#160;If&#160;encryption or&#160;compression&#160;mode&#160;is&#160;enabled,&#160;the buffer&#160;size&#160;<br/>
used by&#160;these&#160;data&#160;processing&#160;functions&#160;can&#160;be&#160;configured&#160;<br/>here.&#160;<br/>
Pipelined Verification&#160;<br/>
Optional&#160;feature:&#160;Download&#160;is&#160;verified&#160;in background&#160;while&#160;<br/>additional&#160;data is&#160;received.&#160;<br/>
Output&#160;Verification&#160;<br/>
Standard verification&#160;method:&#160;Download is verified during&#160;the&#160;<br/>Routine&#160;Control&#160;-&#160;Check&#160;Memory&#160;service.&#160;<br/>Please note:&#160;Either&#160;Pipelined or&#160;Output&#160;Verification has&#160;to be&#160;<br/>configured.&#160;<br/>
Signature verification length&#160;[B]&#160;&#160;Length of&#160;data blocks&#160;sent&#160;to security&#160;module&#160;for&#160;verification.&#160;<br/>Pipelined Programming&#160;<br/>
Optional&#160;feature.&#160;If&#160;activated,&#160;the&#160;bootloader&#160;will&#160;process&#160;and&#160;<br/>write downloaded data while the&#160;following&#160;data&#160;is&#160;transferred&#160;to&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
36&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=37></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-37_1.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-37_2.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>Configuration&#160;Option&#160;</b><br/>
<b>Description&#160;<br/></b>the&#160;bootloader.&#160;<br/>This&#160;feature is&#160;also&#160;known as&#160;“Double Buffered&#160;Download”.&#160;<br/>
Write segmentation&#160;[B]&#160;<br/>
Size of&#160;data packets&#160;handed over&#160;to&#160;the&#160;flash&#160;driver.&#160;<br/>
Unaligned data&#160;transfer&#160;<br/>
If&#160;activated,&#160;the&#160;bootloader&#160;will&#160;request&#160;to&#160;receive the&#160;full&#160;<br/>diagnostic&#160;buffer&#160;and handles&#160;flash&#160;segment&#160;alignment&#160;<br/>internally.&#160;&#160;<br/>Otherwise,&#160;the&#160;tester&#160;has&#160;to&#160;send data with the&#160;length&#160;aligned&#160;<br/>to&#160;the&#160;flash segment&#160;size.&#160;<br/>
Watchdog&#160;Service&#160;<br/>
Enables watchdog&#160;handling&#160;by&#160;the&#160;bootloader.&#160;<br/>
Trigger&#160;Cycle [ms]&#160;<br/>
Specifies&#160;the&#160;interval&#160;in&#160;milliseconds&#160;between the calls&#160;of&#160;the&#160;<br/>watchdog&#160;handling&#160;function&#160;ApplFblWDTrigger().&#160;<br/>
Table&#160;5-4&#160;&#160;&#160;GENy&#160;General&#160;FBL&#160;Configuration&#160;<br/>
The&#160;FblCan_14229_Vector&#160;module&#160;includes&#160;the&#160;following&#160;options:&#160;<br/>
&#160;<br/>
Figure&#160;5-11&#160;&#160;OEM&#160;specific&#160;UDS&#160;configuration&#160;<br/>
&#160;<br/>
<b>Configuration&#160;Option&#160;</b><br/>
<b>Description&#160;</b><br/>
Access Delay&#160;Time&#160;(ms)&#160;<br/>
Delay&#160;time is active after&#160;three&#160;unsuccessful&#160;seed/key&#160;<br/>attempts.&#160;All&#160;further&#160;security&#160;access&#160;requests&#160;will&#160;be&#160;rejected&#160;<br/>during&#160;the&#160;delay&#160;time.&#160;<br/>Default&#160;value&#160;is&#160;10&#160;seconds.&#160;Setting&#160;this&#160;value&#160;to&#160;0 will&#160;disable&#160;<br/>this&#160;feature.&#160;<br/>
Communication&#160;Control&#160;Type&#160;<br/>
Configures sub-function&#160;of&#160;Communication&#160;Control&#160;service sent&#160;<br/>in pre-programming sequence.&#160;<br/>
ControlDTC&#160;Option&#160;Record&#160;<br/>
Activates&#160;or&#160;deactivates&#160;the&#160;usage of&#160;a&#160;ControlDTC&#160;Option&#160;<br/>Record with the&#160;ControlDTC&#160;service.&#160;<br/>
Check&#160;Programming&#160;<br/>
If&#160;activated,&#160;the&#160;service&#160;Routine&#160;Control&#160;–&#160;Check&#160;Programming&#160;<br/>
Preconditions&#160;Service&#160;<br/>
Preconditions&#160;is&#160;mandatory&#160;before&#160;the&#160;bootloader&#160;switches&#160;to&#160;<br/>programming&#160;session.&#160;<br/>
Application Validity&#160;Flag&#160;<br/>
Configures,&#160;if&#160;the&#160;result&#160;of&#160;the&#160;Check&#160;Programming&#160;<br/>Dependencies service is&#160;used to&#160;determine&#160;if&#160;an&#160;application&#160;<br/>software&#160;is&#160;present&#160;or&#160;if&#160;the&#160;application validity&#160;is&#160;established on&#160;<br/>every&#160;startup&#160;(based&#160;on&#160;logical&#160;block&#160;validity&#160;information).&#160;<br/>
Table&#160;5-5&#160;&#160;&#160;OEM&#160;UDS&#160;Specific&#160;Configuration&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
37&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=38></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-38_1.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-38_2.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>5.5&#160;</b><br/>
<b>Memory&#160;Configuration&#160;</b><br/>
The&#160;memory&#160;configuration&#160;module&#160;is&#160;used&#160;to&#160;configure&#160;&#160;the&#160;memory&#160;layout&#160;&#160;used&#160;to&#160;store&#160;<br/>application&#160;software and&#160;calibration&#160;data.&#160;It&#160;can&#160;be&#160;found&#160;in&#160;the&#160;FblDrvCan_&lt;HW&gt;-module.&#160;<br/>The&#160;memory&#160;configuration&#160;is divided&#160;into&#160;3&#160;modules:&#160;<br/>
<b>5.5.1&#160;</b><br/>
<b>Flash Block&#160;Table&#160;</b><br/>
The&#160;flash&#160;block&#160;table&#160;is&#160;used&#160;to&#160;map&#160;memory&#160;devices&#160;&#160;and&#160;logical&#160;blocks&#160;&#160;to&#160;flash&#160;blocks.&#160;<br/>The&#160;blocks&#160;configured&#160;here&#160;should&#160;describe&#160;physically&#160;erasable&#160;areas&#160;(1&#160;or&#160;more&#160;physical&#160;<br/>flash&#160;blocks&#160;depending&#160;on&#160;the&#160;flash&#160;driver implementation&#160;and&#160;the&#160;flash&#160;block&#160;size).&#160;<br/>
&#160;<br/>
Figure&#160;5-12&#160;&#160;Flash&#160;Block&#160;Table&#160;<br/>
&#160;<br/>
<b>Configuration&#160;Option&#160;</b><br/>
<b>Description&#160;</b><br/>
Start&#160;Address&#160;<br/>
Start&#160;address&#160;of&#160;the&#160;flash&#160;block.&#160;Has&#160;to be&#160;aligned&#160;to&#160;the&#160;start&#160;<br/>of&#160;an&#160;erasable&#160;flash&#160;block.&#160;<br/>
End&#160;Address&#160;<br/>
End&#160;Address.&#160;Has&#160;to&#160;be&#160;the&#160;end of&#160;an&#160;erasable&#160;flash block.&#160;<br/>
Memory&#160;Device&#160;<br/>
Memory&#160;device:&#160;Select&#160;the&#160;memory&#160;device used&#160;for&#160;this&#160;flash&#160;<br/>block.&#160;If&#160;“Protected”&#160;is&#160;selected,&#160;the&#160;block&#160;is&#160;not&#160;<br/>erasable/flashable.&#160;<br/>
Description&#160;<br/>
Comment&#160;to identify&#160;the&#160;block.&#160;<br/>
Logical&#160;Block&#160;<br/>
Used&#160;to&#160;map&#160;a logical&#160;block to&#160;a&#160;flash&#160;block.&#160;<br/>
Table&#160;5-6&#160;&#160;&#160;Flash&#160;Block&#160;Table&#160;Configuration&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
38&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=39></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-39_1.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-39_2.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-39_3.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>5.5.1.1&#160;</b><br/>
<b>Logical&#160;Block&#160;Table&#160;</b><br/>
&#160;<br/>
Figure&#160;5-13&#160;&#160;Logical&#160;Block&#160;Table&#160;<br/>
The&#160;&#160;logical&#160;&#160;block&#160;&#160;table&#160;&#160;is&#160;&#160;used&#160;&#160;to&#160;&#160;divide&#160;&#160;the&#160;&#160;reprogrammable&#160;&#160;memory&#160;&#160;of&#160;&#160;the&#160;&#160;ECU&#160;&#160;into&#160;<br/>different&#160;&#160;logical&#160;&#160;blocks.&#160;&#160;They&#160;&#160;are&#160;&#160;writeable&#160;&#160;independently&#160;&#160;and&#160;&#160;can&#160;&#160;be&#160;&#160;used&#160;&#160;for&#160;&#160;e.g.&#160;&#160;an&#160;<br/>application&#160;and&#160;a&#160;calibration&#160;block.&#160;<br/>
&#160;<br/>
<b>Configuration&#160;Option&#160;</b><br/>
<b>Description&#160;</b><br/>
Name&#160;<br/>
Name&#160;used&#160;to&#160;identify&#160;the block&#160;in&#160;the&#160;flash&#160;block&#160;table.&#160;<br/>
Disposability&#160;<br/>
Is&#160;used&#160;to determine&#160;if&#160;a&#160;block is mandatory&#160;or&#160;optional&#160;during&#160;<br/>application validation.&#160;<br/>
Start&#160;Address&#160;<br/>
Set&#160;automatically&#160;by&#160;flash block&#160;table.&#160;<br/>
End&#160;Address&#160;<br/>
Set&#160;automatically&#160;by&#160;flash block&#160;table.&#160;<br/>
Max.&#160;reprogramming&#160;attempts&#160;<br/>
This&#160;value&#160;has&#160;to&#160;be&#160;set&#160;to the&#160;maximum&#160;allowed&#160;erase&#160;cycles&#160;<br/>of&#160;your&#160;hardware.&#160;If&#160;0 is&#160;set,&#160;no&#160;reprogramming&#160;attempt&#160;check&#160;<br/>is&#160;done.&#160;<br/>
Pipelined Verification&#160;<br/>
If&#160;the&#160;bootloader&#160;is&#160;ordered&#160;with support&#160;of&#160;pipelined&#160;<br/>verification,&#160;the&#160;verification&#160;routine&#160;can&#160;be&#160;chosen here.&#160;<br/>
Output&#160;Verification&#160;<br/>
Optional&#160;setting:&#160;If&#160;needed,&#160;the&#160;verification&#160;routine&#160;can&#160;be&#160;<br/>chosen&#160;here.&#160;<br/>
Description&#160;<br/>
Comment&#160;to describe&#160;the block&#160;in&#160;generated&#160;code.&#160;<br/>
Table&#160;5-7&#160;&#160;&#160;Logical&#160;Block&#160;Table&#160;Configuration&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>Caution&#160;<br/></b>Be careful&#160;to&#160;set&#160;all&#160;needed&#160;blocks&#160;to&#160;“mandatory”.&#160;Otherwise they&#160;are&#160;not&#160;used to&#160;<br/>
<b>&#160;&#160;</b>determine&#160;the&#160;application’s&#160;overall&#160;validity.&#160;<br/>
You&#160;also have to&#160;make&#160;sure&#160;the&#160;flash&#160;blocks&#160;used&#160;by&#160;the&#160;bootloader&#160;are&#160;configured&#160;to&#160;<br/>“protected”&#160;to ensure&#160;the&#160;bootloader&#160;cannot&#160;erase&#160;itself.&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>
<b>5.5.2&#160;</b><br/>
<b>Memory&#160;Device&#160;Table&#160;</b><br/>
All&#160;available&#160;memory&#160;devices&#160;have&#160;to&#160;be&#160;configured&#160;in&#160;the&#160;memory&#160;device&#160;table.&#160;There&#160;are&#160;<br/>2&#160;default&#160;devices:&#160;<br/><b>&#160;&#160;</b>Protected:&#160;Areas protected&#160;by&#160;the&#160;bootloader.&#160;All&#160;areas which&#160;must&#160;not&#160;flashed&#160;by&#160;the&#160;<br/>
bootloader&#160;have&#160;to&#160;be&#160;set&#160;to&#160;protected.&#160;This includes&#160;the&#160;bootloader&#160;itself&#160;and&#160;<br/>memories&#160;used&#160;by&#160;modules&#160;like&#160;EEPROM&#160;emulations.&#160;<br/>
<b>&#160;&#160;</b>Flash:&#160;Internal&#160;flash&#160;memory&#160;delivered&#160;with&#160;the&#160;bootloader.&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
39&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=40></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-40_1.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-40_2.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
Additional&#160;memory&#160;drivers&#160;like&#160;EEPROM&#160;drivers&#160;or&#160;drivers&#160;for&#160;external&#160;flash&#160;devices&#160;&#160;can&#160;<br/>be&#160;added&#160;here.&#160;These&#160;drivers&#160;must&#160;conform&#160;to&#160;the&#160;HIS&#160;memory&#160;driver&#160;interface.&#160;A&#160;detailed&#160;<br/>description&#160;of&#160;the&#160;flash&#160;driver interface&#160;can&#160;be&#160;found&#160;in<a href="TechnicalReference_FBL_Vector_SLP3s.html#3">&#160;[3].</a>&#160;<br/>The&#160;following&#160;settings&#160;have&#160;to&#160;be&#160;done&#160;for&#160;every&#160;added&#160;memory&#160;device:&#160;<br/>
<b>Configuration&#160;Option&#160;</b><br/>
<b>Description&#160;</b><br/>
Name&#160;<br/>
Name&#160;used&#160;to&#160;identify&#160;the device in&#160;the&#160;flash&#160;block&#160;table.&#160;It&#160;also&#160;<br/>is&#160;used as&#160;prefix&#160;to&#160;the&#160;driver&#160;interface&#160;functions.&#160;<br/>
Segment&#160;Size&#160;<br/>
Smallest&#160;writeable data&#160;segment.&#160;<br/>
Erased Value&#160;<br/>
The&#160;value&#160;which is set&#160;after&#160;a device has&#160;been&#160;erased.&#160;<br/>
Table&#160;5-8&#160;&#160;&#160;Memory&#160;Device&#160;Table&#160;Configuration&#160;<br/>
&#160;<br/>
&#160;<br/>
Figure&#160;5-14&#160;&#160;Memory&#160;Device&#160;Table&#160;<br/>
&#160;<br/>
<b>5.5.3&#160;</b><br/>
<b>NV-Wrapper&#160;Configuration&#160;</b><br/>
The&#160;&#160;bootloader&#160;&#160;stores&#160;&#160;a&#160;&#160;set&#160;&#160;of&#160;&#160;control&#160;&#160;information&#160;&#160;in&#160;&#160;non-volatile&#160;&#160;memory.&#160;&#160;This&#160;&#160;can&#160;&#160;be&#160;<br/>done&#160;using&#160;an&#160;address&#160;based&#160;memory&#160;like&#160;an&#160;external EEPROM&#160;or an&#160;ID&#160;based&#160;EEPROM&#160;<br/>emulation&#160;like&#160;the&#160;EepM&#160;module.&#160;<br/>The&#160;&#160;NV-Wrapper&#160;&#160;provides&#160;&#160;an&#160;&#160;abstraction&#160;&#160;layer&#160;&#160;between&#160;&#160;these&#160;&#160;memory&#160;&#160;devices&#160;&#160;and&#160;&#160;the&#160;<br/>bootloader’s&#160;fbl_apnv&#160;layer.&#160;Please&#160;see<a href="TechnicalReference_FBL_Vector_SLP3s.html#3">&#160;[8]&#160;</a>for&#160;more&#160;information.&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
40&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=41></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-41_1.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-41_2.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-41_3.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-41_4.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
The&#160;&#160;following&#160;&#160;NV-memory&#160;&#160;entries&#160;&#160;are&#160;&#160;pre-configured&#160;&#160;within&#160;&#160;your&#160;&#160;bootloader.&#160;&#160;Most&#160;&#160;of&#160;&#160;the&#160;<br/>information&#160;is stored&#160;once&#160;per&#160;bootloader:&#160;<br/>
&#160;<br/>
Figure&#160;5-15&#160;&#160;NV-Wrapper&#160;configuration&#160;<br/>
MetaData&#160;is&#160;a&#160;table&#160;&#160;which&#160;&#160;stores&#160;&#160;information&#160;needed&#160;for&#160;every&#160;logical&#160;block.&#160;Please&#160;see&#160;<br/>the&#160;following&#160;figure&#160;for&#160;details:&#160;<br/>
&#160;<br/>
Figure&#160;5-16&#160;&#160;Meta&#160;Data&#160;configuration&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>Caution&#160;<br/></b>The&#160;number&#160;of&#160;Metadata&#160;entries&#160;must&#160;correspond&#160;to&#160;the&#160;configured&#160;number&#160;of&#160;logical&#160;<br/>
<b>&#160;&#160;</b>blocks.&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
41&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=42></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-42_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>5.5.4&#160;</b><br/>
<b>Running the&#160;Generator&#160;</b><br/>
When&#160;&#160;you&#160;&#160;have&#160;&#160;finished&#160;&#160;your&#160;&#160;configuration&#160;&#160;selections,&#160;&#160;you&#160;&#160;need&#160;&#160;to&#160;&#160;run&#160;&#160;the&#160;&#160;generator&#160;&#160;to&#160;<br/>produce&#160;the&#160;files&#160;needed&#160;to&#160;compile&#160;the&#160;FBL.&#160;To&#160;generate&#160;the&#160;files,&#160;click&#160;on&#160;the&#160;lightning-<br/>bolt&#160;button&#160;on&#160;the&#160;toolbar,&#160;or&#160;select&#160;“Generate&#160;System”&#160;from&#160;the&#160;Configuration&#160;menu.&#160;The&#160;<br/>following&#160;table&#160;describes the&#160;contents&#160;of&#160;the&#160;generated&#160;files:&#160;<br/>
&#160;<br/>
<b>File&#160;Name&#160;</b><br/>
<b>Contents&#160;</b><br/>
fbl_apfb.c&#160;<br/>
Contains the&#160;flash&#160;block&#160;table.&#160;If&#160;multiple memory&#160;devices are configured,&#160;this&#160;<br/>file also&#160;contains&#160;a&#160;table&#160;mapping&#160;the&#160;block&#160;entries to&#160;the&#160;appropriate&#160;device&#160;<br/>driver&#160;API&#160;functions.&#160;<br/>
fbl_apfb.h&#160;<br/>
Interface&#160;definition&#160;of&#160;fbl_apfb.c.&#160;<br/>
fbl_cfg.h&#160;<br/>
Contains macro&#160;definitions used&#160;to&#160;configure&#160;the&#160;bootloader.&#160;For&#160;the&#160;most&#160;part,&#160;<br/>the&#160;file defines&#160;switches&#160;in the&#160;form&#160;of&#160;FBL_ENABLE_&lt;feature&gt;&#160;or&#160;<br/>FBL_DISABLE_&lt;feature&gt;.&#160;<br/>
fbl_cw_cfg.c&#160;<br/>
Communication&#160;setup&#160;of&#160;CAN&#160;bootloaders.&#160;<br/>
fbl_cw_cfg.h&#160;<br/>
Communication&#160;setup&#160;of&#160;CAN&#160;bootloaders.&#160;<br/>
fbl_mtab.c&#160;<br/>
Contains the&#160;logical&#160;block&#160;table.&#160;<br/>
fbl_mtab.h&#160;<br/>
Interface&#160;definition&#160;of&#160;fbl_mtab.c.&#160;<br/>
ftp_cfg.h&#160;<br/>
This&#160;file is used&#160;to&#160;configure&#160;the&#160;transport&#160;protocol.&#160;<br/>
SecM_cfg.h&#160;<br/>
Configuration of&#160;the&#160;security&#160;module.&#160;<br/>
Secmpar.c&#160;<br/>
Additional&#160;constants&#160;used by&#160;the&#160;security&#160;module,&#160;e.g.&#160;the&#160;public&#160;key&#160;if&#160;security&#160;<br/>class CCC&#160;is&#160;used.&#160;This&#160;file isn’t&#160;needed&#160;if&#160;security&#160;class DDD&#160;is&#160;used.&#160;<br/>
Secmpar.h&#160;<br/>
Interface&#160;definition&#160;of&#160;Secmpar.c.&#160;<br/>
v_cfg.h&#160;<br/>
Contains macro&#160;definitions specific&#160;to&#160;your&#160;hardware.&#160;<br/>
v_inc.h&#160;<br/>
Single include&#160;file&#160;to include v_cfg.h&#160;and v_par.h.&#160;<br/>
v_par.c,&#160;v_par.h&#160;&#160;Defines&#160;to&#160;identify&#160;the&#160;bootloader&#160;delivery&#160;version.&#160;<br/>WrapNv_cfg.c&#160;<br/>
Not&#160;needed&#160;currently.&#160;This&#160;file is&#160;generated&#160;for&#160;future&#160;use.&#160;Please&#160;do&#160;not&#160;include&#160;<br/>it&#160;into&#160;your&#160;project,&#160;it&#160;won’t&#160;compile.&#160;<br/>
WrapNv_cfg.h&#160;<br/>
NvWrapper&#160;configuration.&#160;Defines&#160;a wrapper&#160;layer&#160;between ID&#160;and&#160;address&#160;<br/>based&#160;NV-memory&#160;stacks.&#160;<br/>
Table&#160;5-9&#160;&#160;&#160;Generated&#160;Files&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
42&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=43></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-43_1.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-43_2.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-43_3.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>6&#160;&#160;User&#160;callback files&#160;and&#160;hardware&#160;specific&#160;adaptions&#160;</b><br/>
The&#160;bootloader&#160;&#160;includes&#160;a&#160;number&#160;of&#160;files&#160;that&#160;must&#160;be&#160;adapted&#160;and&#160;reviewed&#160;by&#160;you&#160;to&#160;<br/>make&#160;&#160;sure&#160;&#160;they&#160;&#160;fit&#160;&#160;the&#160;&#160;needs&#160;&#160;of&#160;&#160;your&#160;&#160;ECU&#160;&#160;and&#160;&#160;application.&#160;&#160;All&#160;&#160;files&#160;&#160;found&#160;&#160;at&#160;<br/>.\BSW\Fbl\_Template&#160;require&#160;customization.&#160;<br/>To&#160;use&#160;these&#160;files,&#160;please&#160;follow&#160;these&#160;steps:&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>User&#160;callback&#160;file setup&#160;</b><br/>
&#160;&#160;1.&#160;&#160;Copy&#160;the&#160;files&#160;from&#160;.\BSW\Fbl\_Template&#160;to&#160;your&#160;project.&#160;<br/>
2.&#160;&#160;Remove the&#160;leading&#160;underscores&#160;from&#160;these&#160;files.&#160;<br/>3.&#160;&#160;Adapt&#160;them&#160;to&#160;your&#160;needs.&#160;<br/>4.&#160;&#160;Include them&#160;into&#160;your&#160;project&#160;setup&#160;and&#160;build the&#160;bootloader.&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>Please&#160;pay&#160;attention&#160;when&#160;adapting&#160;callback&#160;functions.&#160;If&#160;a&#160;routine&#160;(such&#160;as&#160;an&#160;EEPROM&#160;<br/>function) takes&#160;a&#160;long&#160;time&#160;to&#160;run,&#160;it is possible&#160;that&#160;the&#160;ECU’s&#160;watchdog&#160;timer will force&#160;the&#160;<br/>ECU&#160;to&#160;reset.&#160;You&#160;should&#160;also&#160;be&#160;careful when&#160;using&#160;library&#160;routines&#160;such&#160;as memcpy().&#160;<br/>To&#160;avoid&#160;a&#160;reset,&#160;you&#160;must&#160;call&#160;FblLookForWatchdog()&#160;at&#160;least&#160;once&#160;per&#160;millisecond.&#160;More&#160;<br/>often&#160;is&#160;desirable.&#160;Failure&#160;&#160;to&#160;meet&#160;this&#160;requirement&#160;may&#160;lead&#160;to&#160;unexpected&#160;resets&#160;&#160;while&#160;<br/>programming&#160;&#160;the&#160;&#160;ECU.&#160;&#160;If&#160;&#160;the&#160;&#160;function&#160;&#160;is&#160;&#160;called&#160;&#160;during&#160;&#160;a&#160;&#160;service&#160;&#160;request&#160;&#160;before&#160;&#160;the&#160;<br/>response&#160;&#160;has&#160;&#160;been&#160;&#160;given,&#160;&#160;call&#160;&#160;the&#160;&#160;routine&#160;&#160;FblRealTimeSupport()&#160;&#160;instead&#160;&#160;of&#160;<br/>FblLookForWatchdog().&#160;&#160;This&#160;&#160;will&#160;&#160;also&#160;&#160;maintain&#160;&#160;the&#160;&#160;response-pending&#160;&#160;of&#160;&#160;the&#160;&#160;service&#160;<br/>request.&#160;<br/>
<b>6.1&#160;</b><br/>
<b>Startup&#160;code&#160;</b><br/>
&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/></b>Caution&#160;<br/>It&#160;is&#160;absolutely&#160;necessary&#160;that&#160;you&#160;adapt&#160;the&#160;startup&#160;code&#160;for&#160;the&#160;bootloader&#160;to your&#160;<br/>
<b>&#160;&#160;</b>specific&#160;hardware&#160;platform&#160;and&#160;configuration.&#160;<br/>
Please be&#160;aware&#160;that&#160;there will&#160;be&#160;two startup&#160;codes executed&#160;subsequently&#160;(the&#160;<br/>startup&#160;code&#160;of&#160;the&#160;bootloader&#160;and&#160;the&#160;startup&#160;code&#160;of&#160;your&#160;application)&#160;and&#160;that&#160;there&#160;<br/>are&#160;write-once&#160;registers&#160;on&#160;several&#160;platforms.&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
43&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=44></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-44_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>6.2&#160;</b><br/>
<b>Hardware,&#160;Input/Output&#160;and miscellaneous&#160;Callbacks&#160;</b><br/>
The&#160;&#160;file&#160;&#160;fbl_ap.c&#160;&#160;contains&#160;&#160;functions&#160;&#160;to&#160;&#160;handle&#160;&#160;hardware&#160;&#160;specific&#160;&#160;operations,&#160;&#160;e.g.&#160;<br/>input/output&#160;control.&#160;<br/>The&#160;&#160;following&#160;&#160;pages&#160;&#160;describe&#160;&#160;each&#160;&#160;function.&#160;&#160;When&#160;&#160;building&#160;&#160;your&#160;&#160;bootloader,&#160;&#160;you&#160;&#160;should&#160;<br/>review&#160;&#160;the&#160;&#160;implementation&#160;&#160;of&#160;&#160;each&#160;function,&#160;&#160;and&#160;&#160;adapt&#160;&#160;them&#160;&#160;to&#160;&#160;conform&#160;&#160;with&#160;&#160;your&#160;&#160;ECUs&#160;<br/>requirements.&#160;<br/>
&#160;<br/>
<b>Prototype&#160;<br/></b>void&#160;ApplFblInit(&#160;void&#160;)&#160;<br/><b>Functional&#160;Description&#160;</b><br/>
Perform&#160;basic&#160;hardware and I/O&#160;initialization,&#160;e.g.&#160;PLL&#160;and CAN&#160;output&#160;PINs. If&#160;a&#160;non-volatile memory&#160;<br/>driver is&#160;needed&#160;to decide&#160;if&#160;the&#160;application should&#160;be&#160;started&#160;or&#160;not, the driver&#160;has&#160;to&#160;be initialized&#160;in&#160;this&#160;<br/>function&#160;as&#160;well.&#160;<br/>
<b>Particularities&#160;and&#160;Limitations&#160;</b><br/>
<b>&gt;&#160;&#160;</b>ApplFblInit()&#160;is&#160;executed&#160;before the&#160;application&#160;software is&#160;started.&#160;Please keep in&#160;mind&#160;that&#160;it&#160;will&#160;be&#160;<br/>
executed&#160;on&#160;every&#160;startup.&#160;<br/>
<b>&gt;&#160;&#160;</b>If&#160;the&#160;watchdog&#160;is&#160;initialized&#160;in&#160;ApplFblInit(),&#160;it&#160;will&#160;run&#160;if&#160;the application&#160;software is&#160;started.&#160;The&#160;<br/>
bootloader&#160;will&#160;begin to&#160;handle&#160;the&#160;watchdog&#160;later during&#160;its&#160;initialization.&#160;<br/>
&#160;<br/>
<b>Prototype&#160;<br/></b>void&#160;ApplFblStartup(&#160;vuint8&#160;initposition&#160;)&#160;<br/><b>Parameter&#160;</b><br/>
initposition&#160;<br/>
The&#160;call&#160;context of&#160;this&#160;function&#160;is&#160;defined&#160;by&#160;this&#160;parameter.&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
This&#160;function&#160;is&#160;called during the&#160;bootloader&#160;initialization before and&#160;after each initialization step. User-<br/>specific&#160;initialization&#160;steps&#160;are added&#160;to&#160;the&#160;bootloader&#160;initialization using&#160;this&#160;function.&#160;<br/>The&#160;parameter&#160;of&#160;ApplFblStartup()&#160;determines&#160;the&#160;bootloader&#160;initialization step&#160;and if&#160;the function&#160;is&#160;called&#160;<br/>before or after the&#160;initialization&#160;step.&#160;The&#160;following parameters&#160;are supported:&#160;<br/>&#160;&#160;(kFblInitPreCallback&#160;|&#160;kFblInitBaseInitialization): First call. No&#160;initializations&#160;are&#160;done&#160;by&#160;the&#160;bootloader&#160;<br/>
at&#160;this&#160;point&#160;<br/>
&#160;&#160;(kFblInitPreCallback&#160;|&#160;kFblInitFblCommunication): Call&#160;before the&#160;communication&#160;stack&#160;of&#160;the&#160;<br/>
bootloader&#160;is&#160;initialized.&#160;<br/>
&#160;&#160;(kFblInitPreCallback&#160;|&#160;kFblInitFblFinalize): Call&#160;before the&#160;bootloader&#160;initialization is&#160;finalized.&#160;At this&#160;<br/>
point,&#160;the&#160;bootloader&#160;decided&#160;not&#160;to&#160;start the application&#160;software independent&#160;of&#160;the startup&#160;<br/>configuration.&#160;<br/>
&#160;&#160;(kFblInitPostCallback&#160;|&#160;kFblInitBaseInitialization): Called after the&#160;hardware pre-initialization.&#160;At this&#160;<br/>
point,&#160;ApplFblInit()&#160;normally&#160;is&#160;called&#160;to&#160;initialize&#160;the hardware for both&#160;bootloader&#160;and&#160;application.&#160;<br/>
&#160;&#160;(kFblInitPostCallback&#160;|&#160;kFblInitFblCommunication): Called&#160;after the&#160;communication&#160;stack&#160;is&#160;initialized.&#160;<br/>&#160;&#160;(kFblInitPostCallback&#160;|&#160;kFblInitFblFinalize): Called&#160;after the&#160;bootloader&#160;initialization&#160;is&#160;finalized.&#160;At this&#160;<br/>
point,&#160;all&#160;core modules&#160;are&#160;fully&#160;initialized.&#160;<br/>
<b>Particularities&#160;and&#160;Limitations&#160;</b><br/>
<b>&gt;&#160;&#160;</b>This&#160;function&#160;is&#160;called several&#160;times&#160;during the&#160;bootloader&#160;initialization.&#160;<br/><b>&gt;&#160;&#160;</b>The&#160;second call&#160;of&#160;this&#160;function&#160;can&#160;be positioned&#160;before or after the&#160;decision&#160;if&#160;the&#160;application&#160;software&#160;<br/>
should be&#160;started.&#160;This&#160;depends&#160;on the startup configuration, e.g.&#160;if&#160;Force&#160;Boot&#160;Mode&#160;is&#160;used&#160;or not.&#160;<br/>
&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
44&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=45></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-45_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>Prototype&#160;<br/></b>tFblResult&#160;ApplFblCheckProgConditions(&#160;void&#160;)&#160;<br/><b>Return&#160;code&#160;</b><br/>
tFblResult&#160;<br/>
If&#160;all&#160;conditions&#160;are correct,&#160;the&#160;function&#160;returns&#160;kFblOk, otherwise kFblFailed.&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
This&#160;function&#160;is&#160;called after&#160;receiving the service request sessionControl&#160;ProgrammingSession&#160;to check&#160;the&#160;<br/>programming&#160;conditions&#160;like reprogramming&#160;counter,&#160;ambient temperature,&#160;programming&#160;voltage,&#160;etc.&#160;<br/>
&#160;<br/>
<b>Prototype&#160;<br/></b>tFblResult&#160;ApplFblCheckConditions(&#160;vuint8&#160;*&#160;pbDiagData,&#160;tTpDataType&#160;diagReqDataLen&#160;)&#160;<br/><b>Parameter&#160;</b><br/>
pbDiagData&#160;<br/>
Pointer&#160;to diagnostic&#160;data buffer&#160;<br/>
diagReqDataLen&#160;<br/>
Request data length&#160;<br/>
<b>Return&#160;code&#160;</b><br/>
tFblResult&#160;<br/>
kFblOk&#160;or&#160;kFblFailed&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
This&#160;is&#160;a&#160;general&#160;condition-check&#160;function. It&#160;is&#160;called for all&#160;diagnostic&#160;services&#160;and&#160;can&#160;be&#160;used&#160;to check&#160;<br/>conditions,&#160;which are&#160;necessary&#160;for the diagnostic&#160;service.&#160;<br/>If&#160;a&#160;condition is&#160;not&#160;fulfilled,&#160;please trigger the&#160;respective&#160;NRC and&#160;return kFblFailed.&#160;<br/>An example&#160;use case&#160;would be&#160;to&#160;check&#160;the ECU’s&#160;voltage&#160;while&#160;the&#160;transfer data&#160;service&#160;is&#160;received and&#160;<br/>issue&#160;the NRCs&#160;$92&#160;and&#160;$93.&#160;<br/>
&#160;<br/>
<b>Prototype&#160;<br/></b>vuint8&#160;ApplFblCheckProgDependencies(&#160;void&#160;)&#160;<br/><b>Return&#160;code&#160;</b><br/>
Vuint8&#160;<br/>
If&#160;program&#160;dependencies&#160;are fulfilled,&#160;0x00. Otherwise&#160;!=&#160;0x00&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
This&#160;function&#160;is&#160;used to&#160;check&#160;the dependencies&#160;between&#160;bootloader&#160;and&#160;application&#160;software.&#160;The&#160;<br/>application&#160;software modules&#160;have to be&#160;verified&#160;against each other&#160;here as&#160;well.&#160;<br/>There are 2&#160;possibilities&#160;when&#160;this&#160;function is&#160;called:&#160;<br/>&#160;&#160;During application&#160;startup&#160;and&#160;compatibility&#160;check&#160;service if&#160;<br/>
FBL_APPL_ENABLE_STARTUP_DEPENDENCY_CHECK&#160;is&#160;set.&#160;This&#160;setting&#160;can&#160;be&#160;controlled&#160;by&#160;the&#160;<br/>GENy&#160;option&#160;“Application&#160;Validity&#160;Flag”.&#160;<br/>
&#160;&#160;From&#160;compatibility&#160;check&#160;service&#160;<br/>
&#160;<br/>
<b>Prototype&#160;<br/></b>void&#160;ApplTrcvrNormalMode(&#160;void&#160;)&#160;<br/><b>Functional&#160;Description&#160;</b><br/>
This&#160;function&#160;is&#160;used to&#160;configure&#160;your CAN bus&#160;transceiver for normal&#160;CAN&#160;communication. You&#160;must&#160;<br/>implement this&#160;routine&#160;to&#160;perform&#160;the necessary&#160;Input/Output&#160;operations&#160;to&#160;control&#160;the transceiver state.&#160;<br/>
&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
45&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=46></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-46_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>Prototype&#160;<br/></b>void&#160;ApplTrcvrSleepMode(&#160;void&#160;)&#160;<br/><b>Functional&#160;Description&#160;</b><br/>
This&#160;function&#160;is&#160;used to&#160;configure CAN bus&#160;transceiver&#160;for low-power (sleep)&#160;operation. You must&#160;<br/>implement this&#160;routine&#160;to&#160;perform&#160;the necessary&#160;Input/Output&#160;operations&#160;to&#160;control&#160;the transceiver state.&#160;<br/>
&#160;<br/>
<b>Prototype&#160;<br/></b>void&#160;ApplFblSetVfp(&#160;void&#160;)&#160;<br/><b>Functional&#160;Description&#160;</b><br/>
The&#160;purpose of&#160;this&#160;routine&#160;is&#160;to&#160;turn on&#160;the&#160;power&#160;supply&#160;required&#160;to&#160;program&#160;non-volatile memory. &#160;If&#160;your&#160;<br/>ECU does&#160;not&#160;require&#160;an&#160;external&#160;power&#160;source to&#160;erase and&#160;program&#160;memory, then&#160;this&#160;function may&#160;be&#160;<br/>left empty.&#160;It’s&#160;been&#160;called shortly&#160;before the&#160;flashdriver&#160;will&#160;be initialized.&#160;<br/>
<b>Particularities&#160;and&#160;Limitations&#160;</b><br/>
<b>&gt;&#160;&#160;</b>This&#160;function&#160;can&#160;remain empty&#160;on&#160;most&#160;hardware platforms. It&#160;is&#160;needed e.g.&#160;on&#160;some V850&#160;<br/>
controllers.&#160;<br/>
&#160;<br/>
<b>Prototype&#160;<br/></b>void&#160;ApplFblResetVfp(&#160;void&#160;)&#160;<br/><b>Functional&#160;Description&#160;</b><br/>
The&#160;purpose of&#160;this&#160;routine&#160;is&#160;to&#160;turn off&#160;the power supply&#160;required&#160;to&#160;program&#160;non-volatile memory. &#160;If&#160;your&#160;<br/>ECU does&#160;not&#160;require&#160;an&#160;external&#160;power&#160;source to&#160;erase and&#160;program&#160;memory, then&#160;this&#160;function may&#160;be&#160;<br/>left empty.&#160;<br/>
<b>Particularities&#160;and&#160;Limitations&#160;</b><br/>
<b>&gt;&#160;&#160;</b>This&#160;function&#160;can&#160;remain empty&#160;on&#160;most hardware platforms. It&#160;is&#160;needed e.g.&#160;on&#160;some V850&#160;<br/>
controllers.&#160;<br/>
&#160;<br/>
<b>Prototype&#160;<br/></b>void&#160;ApplFblReset(&#160;void&#160;)&#160;<br/><b>Functional&#160;Description&#160;</b><br/>
This&#160;function&#160;is&#160;responsible&#160;for resetting&#160;the&#160;ECU.&#160;For&#160;example,&#160;you may&#160;execute&#160;a restart instruction (if&#160;<br/>available), jump to the&#160;reset vector, or&#160;use the&#160;watchdog.&#160;The&#160;choice is&#160;up&#160;to&#160;you,&#160;and&#160;depends&#160;on&#160;your&#160;<br/>ECU hardware.&#160;This&#160;function&#160;is&#160;called&#160;when&#160;it is&#160;necessary&#160;to&#160;reset the ECU.&#160;<br/>
<b>Particularities&#160;and&#160;Limitations&#160;</b><br/>
<b>&gt;&#160;&#160;</b>Jumping&#160;directly&#160;to the&#160;ECU’s&#160;reset&#160;vector should&#160;be&#160;considered a&#160;last-choice option. Some ECUs&#160;<br/>
contain registers&#160;that may&#160;be&#160;accessed&#160;only&#160;once&#160;–&#160;it&#160;is&#160;possible that&#160;the&#160;FBL&#160;will&#160;be&#160;unable&#160;to&#160;re-<br/>initialize&#160;them&#160;when&#160;it&#160;is&#160;restarted&#160;via a&#160;jump to the reset&#160;vector.&#160;<br/>
<b>&gt;&#160;&#160;</b>Do not&#160;waste&#160;too&#160;much time in&#160;this&#160;function&#160;(e.g. through&#160;an endless&#160;loop&#160;waiting&#160;for a long-lasting&#160;<br/>
watchdog trigger).&#160;This&#160;can&#160;cause unwanted&#160;delay&#160;on&#160;the&#160;network&#160;operation&#160;or service&#160;tester.&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
46&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=47></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-47_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>Prototype&#160;<br/></b>vuint8&#160;ApplFblSecuritySeedInit(&#160;void&#160;)&#160;<br/><b>Return&#160;code&#160;</b><br/>
vuint8&#160;<br/>
Status&#160;of&#160;seed initialization&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
This&#160;function&#160;can&#160;be&#160;used to Initialize seed&#160;values. For&#160;example,&#160;a random&#160;number&#160;generator can&#160;be&#160;<br/>started&#160;here.&#160;This&#160;function&#160;will&#160;be called,&#160;when&#160;a&#160;TP&#160;message is&#160;received.&#160;<br/>
<b>Particularities&#160;and&#160;Limitations&#160;</b><br/>
<b>&gt;&#160;&#160;</b>This&#160;function&#160;has&#160;to be linked&#160;to&#160;RAM if&#160;pipelined&#160;programming&#160;is&#160;configured.&#160;<br/>
&#160;<br/>
<b>Prototype&#160;<br/></b>vuint8&#160;ApplFblSecuritySeed(&#160;void&#160;)&#160;<br/><b>Return&#160;code&#160;</b><br/>
vuint8&#160;<br/>
Status&#160;of&#160;seed generation&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
This&#160;function&#160;is&#160;called to&#160;obtain&#160;the&#160;security-seed&#160;for the ECU.&#160;The&#160;function&#160;is&#160;called&#160;when&#160;a Security-<br/>Access&#160;(service $27) request is&#160;received&#160;containing&#160;a&#160;request-seed sub-function.&#160;<br/>
<b>Particularities&#160;and&#160;Limitations&#160;</b><br/>
<b>&gt;&#160;&#160;</b>See&#160;also&#160;ApplFblSecurityKey()&#160;<br/><b>&gt;&#160;&#160;</b>The&#160;default&#160;implementation&#160;calls&#160;the&#160;function&#160;SecM_GenerateSeed()&#160;of&#160;the&#160;security&#160;module.&#160;<br/>
&#160;<br/>
<b>Prototype&#160;<br/></b>vuint8&#160;ApplFblSecurityKey(&#160;void&#160;)&#160;<br/><b>Return&#160;code&#160;</b><br/>
vuint8&#160;<br/>
Status&#160;of&#160;key&#160;verification&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
The&#160;purpose of&#160;this&#160;function is&#160;to&#160;verify&#160;that&#160;the security-key&#160;supplied in the diagnostic&#160;request is&#160;equal&#160;to&#160;<br/>the&#160;expected&#160;security-key. &#160;The&#160;expected&#160;security-key&#160;is&#160;based&#160;upon&#160;the&#160;security-seed&#160;returned by&#160;<br/>ApplFblSecuritySeed().&#160;<br/>This&#160;function&#160;is&#160;called&#160;when&#160;a&#160;Security-Access&#160;(service&#160;$27) request containing&#160;the send-key&#160;sub-function&#160;<br/>is&#160;received.&#160;<br/>
<b>Particularities&#160;and&#160;Limitations&#160;</b><br/>
<b>&gt;&#160;&#160;</b>See&#160;also&#160;ApplFblSecuritySeed()&#160;<br/><b>&gt;&#160;&#160;</b>The&#160;default&#160;implementation&#160;calls&#160;the&#160;function&#160;SecM_ComputeKey()&#160;of&#160;the security&#160;module.&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
47&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=48></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-48_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>Prototype&#160;<br/></b>vuint8&#160;ApplFblSecurityInit(&#160;void&#160;)&#160;<br/><b>Return&#160;code&#160;</b><br/>
vuint8&#160;<br/>
Status&#160;of&#160;security&#160;module initialization&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
This&#160;function&#160;can&#160;be&#160;used to initialize user specific&#160;functionality&#160;of&#160;the&#160;Seed/Key&#160;algorithm.&#160;<br/>
&#160;<br/>
<b>Prototype&#160;<br/></b>tFblResult&#160;ApplFblInitDataProcessing(&#160;tProcParam&#160;*&#160;procParam&#160;)&#160;<br/>
<b>Parameter&#160;</b><br/>
procParam&#160;<br/>
Pointer&#160;to data&#160;processing&#160;parameter&#160;structure&#160;<br/>
<b>Return&#160;code&#160;</b><br/>
tFblResult&#160;<br/>
kFblOk/kFblFailed&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
ApplFblInitDataProcessing&#160;is&#160;called&#160;during&#160;processing&#160;of&#160;a&#160;RequestDownload service request&#160;with a&#160;data&#160;<br/>format&#160;identifier value !=&#160;0x00&#160;<br/>The&#160;function&#160;should&#160;perform&#160;any&#160;necessary&#160;initialization&#160;required for application&#160;specific&#160;data&#160;processing&#160;<br/>functions&#160;(e.g.&#160;decryption/decompression&#160;algorithms).&#160;<br/>
<b>Particularities&#160;and&#160;Limitations&#160;</b><br/>
<b>&gt;&#160;&#160;</b>This&#160;function&#160;can&#160;be&#160;used to process&#160;(decompress&#160;or decrypt)&#160;data. It&#160;includes&#160;an implementation in&#160;<br/>
case an decompression&#160;or&#160;decryption module&#160;has&#160;been ordered&#160;with&#160;the&#160;bootloader.&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
48&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=49></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-49_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>Prototype&#160;<br/></b>tFblResult&#160;ApplFblDataProcessing(&#160;tProcParam&#160;*&#160;procParam&#160;)&#160;<br/><b>Parameter&#160;</b><br/>
procParam&#160;<br/>
Pointer&#160;to data&#160;processing&#160;parameter&#160;structure&#160;<br/>
<b>Return&#160;code&#160;</b><br/>
tFblResult&#160;<br/>
kFblOk/kFblFailed&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
This&#160;function&#160;is&#160;called to&#160;allow&#160;for user&#160;specific&#160;download&#160;data&#160;processing&#160;(e.g.&#160;data&#160;decompression&#160;and/or&#160;<br/>decryption).&#160;<br/>The&#160;bootloader&#160;will&#160;call&#160;this&#160;function&#160;in&#160;every&#160;Transfer-Data&#160;request&#160;if&#160;the&#160;preceding&#160;Request-Download&#160;<br/>request contained a&#160;non-zero data-format-identifier&#160;parameter.&#160;The&#160;input&#160;data&#160;corresponds&#160;to the data&#160;<br/>which&#160;has&#160;been&#160;received&#160;with&#160;the&#160;TransferData&#160;request, the&#160;output&#160;data&#160;will&#160;be&#160;written&#160;to the target&#160;<br/>memory.&#160;<br/>The&#160;function&#160;is&#160;responsible&#160;for decrypting&#160;and/or decompressing&#160;data.&#160;The&#160;decrypted/decompressed&#160;<br/>results&#160;must be&#160;placed in the output&#160;buffer procParam&#160;structure. &#160;The&#160;number&#160;of&#160;output&#160;bytes&#160;may&#160;be&#160;<br/>different from&#160;the number&#160;of&#160;input&#160;bytes&#160;so that&#160;this&#160;function&#160;also&#160;has&#160;to&#160;make sure&#160;that&#160;the&#160;output&#160;length&#160;<br/>variable&#160;is&#160;set&#160;to&#160;the&#160;correct&#160;value.&#160;<br/>
<b>Particularities&#160;and&#160;Limitations&#160;</b><br/>
<b>&gt;&#160;&#160;</b>This&#160;function&#160;is&#160;only&#160;provided&#160;if&#160;Vector data&#160;processing modules&#160;(decryption&#160;and/or decompression)&#160;are&#160;<br/>
part of&#160;the&#160;bootloader&#160;package.&#160;In&#160;this&#160;case,&#160;the&#160;function&#160;will&#160;be&#160;used&#160;as&#160;a&#160;wrapper for the&#160;dedicated&#160;<br/>decryption/decompression&#160;module.&#160;<br/>
&#160;<br/>
<b>Prototype&#160;<br/></b>tFblResult&#160;ApplFblDeinitDataProcessing(&#160;tProcParam&#160;*&#160;procParam&#160;)&#160;<br/>
<b>Parameter&#160;</b><br/>
procParam&#160;<br/>
Pointer&#160;to data&#160;processing&#160;parameter&#160;structure&#160;<br/>
<b>Return&#160;code&#160;</b><br/>
tFblResult&#160;<br/>
kFblOk/kFblFailed&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
The&#160;FBL&#160;calls&#160;this&#160;function&#160;in order&#160;to&#160;conclude&#160;the&#160;data processing for the&#160;current&#160;contiguous&#160;address&#160;<br/>range.&#160;All&#160;remaining input&#160;data&#160;bytes&#160;have to be processed&#160;and&#160;passed&#160;to the output buffer.&#160;<br/>
<b>Particularities&#160;and&#160;Limitations&#160;</b><br/>
<b>&gt;&#160;&#160;</b>This&#160;function&#160;is&#160;only&#160;provided&#160;if&#160;Vector data&#160;processing modules&#160;(decryption&#160;and/or decompression)&#160;are&#160;<br/>
part of&#160;the&#160;bootloader&#160;package.&#160;In&#160;this&#160;case,&#160;the&#160;function&#160;will&#160;be&#160;used&#160;as&#160;a&#160;wrapper for the&#160;dedicated&#160;<br/>decryption/decompression&#160;module.&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
49&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=50></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-50_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>Prototype&#160;<br/></b>void&#160;ApplFblTask(&#160;void&#160;)&#160;<br/><b>Functional&#160;Description&#160;</b><br/>
This&#160;function&#160;is&#160;called every&#160;millisecond&#160;if&#160;the&#160;bootloader&#160;is&#160;in idle state.&#160;It&#160;is&#160;not&#160;called during flash&#160;<br/>operations.&#160;<br/>
<b>Particularities&#160;and&#160;Limitations&#160;</b><br/>
<b>&gt;&#160;&#160;</b>This&#160;function&#160;is&#160;called only&#160;if&#160;the configuration&#160;selects&#160;“Enable&#160;ApplTask”.&#160;<br/><b>&gt;&#160;&#160;</b>This&#160;function&#160;is&#160;only&#160;called&#160;while the&#160;FBL&#160;is&#160;idle.&#160;Calling intervals&#160;exceeding&#160;the&#160;TpCallCycle can occur&#160;<br/>
while the&#160;FBL&#160;handles&#160;diagnostic&#160;service requests.&#160;This&#160;normally&#160;occurs&#160;while&#160;erasing&#160;and&#160;writing&#160;non-<br/>volatile&#160;memory.&#160;<br/>
&#160;<br/>
<b>Prototype&#160;<br/></b>void&#160;ApplFblStateTask(&#160;void&#160;)&#160;<br/><b>Functional&#160;Description&#160;</b><br/>
This&#160;function&#160;is&#160;called&#160;continuously&#160;if&#160;the&#160;bootloader&#160;is&#160;in&#160;idle state.&#160;It&#160;is&#160;not called&#160;during flash operations.&#160;<br/>
<b>Particularities&#160;and&#160;Limitations&#160;</b><br/>
<b>&gt;&#160;&#160;</b>This&#160;function&#160;is&#160;called only&#160;if&#160;the&#160;configuration selects&#160;“Enable&#160;ApplTask”.&#160;<br/><b>&gt;&#160;&#160;</b>This&#160;function&#160;is&#160;only&#160;called&#160;while the&#160;FBL&#160;is&#160;idle.&#160;Calling intervals&#160;exceeding&#160;the&#160;TpCallCycle can occur&#160;<br/>
while the&#160;FBL&#160;handles&#160;diagnostic&#160;service requests.&#160;This&#160;normally&#160;occurs&#160;while&#160;erasing&#160;and&#160;writing&#160;non-<br/>volatile&#160;memory.&#160;<br/>
&#160;<br/>
<b>Prototype&#160;<br/></b>void&#160;ApplFblFatalError(&#160;FBL_DECL_ASSERT_EXTENDED_INFO(vuint8&#160;errorCode)&#160;)&#160;<br/><b>Parameter&#160;</b><br/>
errorCode&#160;<br/>
Code&#160;number&#160;of&#160;the encountered&#160;assertion&#160;<br/>
module&#160;<br/>
Name of&#160;the affected&#160;module (Only&#160;if&#160;extended info is&#160;enabled)&#160;<br/>
line&#160;<br/>
Line&#160;number&#160;where&#160;the&#160;assertion&#160;occurred&#160;(configuration&#160;dependent)&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
If&#160;the bootloader assertions&#160;are enabled, this&#160;function&#160;will&#160;be called&#160;in case an invalid bootloader&#160;state is&#160;<br/>encountered.&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
50&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=51></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-51_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>Prototype&#160;<br/></b>void&#160;ApplFblCanParamInit(&#160;void&#160;)&#160;<br/><b>Functional&#160;Description&#160;</b><br/>
This&#160;function&#160;is&#160;used if&#160;the&#160;configuration&#160;selects&#160;“Enable Can&#160;Configuration”, or&#160;if&#160;the configuration&#160;defines&#160;<br/>Multiple-ECUs&#160;(for example door&#160;ECUs&#160;(left door/ right&#160;door)). &#160;The&#160;routine&#160;is&#160;called as&#160;part&#160;of&#160;the FBL&#160;<br/>initialization&#160;sequence&#160;when started&#160;from&#160;both&#160;reset&#160;and&#160;from&#160;the application.&#160;<br/>The&#160;purpose of&#160;the function&#160;is&#160;to&#160;allow&#160;the&#160;setting or&#160;modification&#160;of&#160;the CAN-ID&#160;and&#160;bus&#160;timing&#160;parameters.&#160;<br/>They&#160;can be set&#160;based&#160;upon runtime conditions&#160;instead of&#160;fixed&#160;ones&#160;at&#160;compile-time. Usually,&#160;only&#160;the&#160;<br/>CAN-IDs&#160;need&#160;to&#160;be adapted.&#160;<br/>
<b>Particularities&#160;and&#160;Limitations&#160;</b><br/>
<b>&gt;&#160;&#160;</b>Two global&#160;variables&#160;are involved&#160;with&#160;the&#160;FBL&#160;communication&#160;initialization:&#160;fblCanIdTable,&#160;and&#160;<br/>
CanInitTable.&#160;<br/>
<b>&gt;&#160;&#160;</b>fblCanIdTable contains&#160;the&#160;diagnostic&#160;message request CAN-IDs&#160;(the functionally-address&#160;ID,&#160;and&#160;the&#160;<br/>
physically-addressed&#160;ID), as&#160;well&#160;as&#160;the CAN bus&#160;timing&#160;and other&#160;hardware&#160;initialization&#160;parameters.&#160;<br/>
<b>&gt;&#160;&#160;</b>At compile time,&#160;the&#160;constant&#160;kFblCanIdTable contains&#160;the fixed&#160;request and response message CAN-<br/>
IDs&#160;and&#160;the&#160;bus&#160;timing&#160;parameters, based&#160;on&#160;the&#160;database and configuration&#160;settings&#160;(results&#160;from&#160;the&#160;<br/>generated&#160;files&#160;from&#160;“Geny”). &#160;The&#160;table&#160;is&#160;copied&#160;to&#160;fblCanIdTable just before the&#160;FBL&#160;calls&#160;this&#160;<br/>function.&#160;<br/>
<b>&gt;&#160;&#160;</b>The&#160;ApplFblCanParamInit()&#160;function&#160;in the&#160;fbl_ap.c&#160;file&#160;contains&#160;an&#160;exemplary&#160;implementation.&#160;It&#160;allows&#160;<br/>
the&#160;user to overwrite&#160;the&#160;default settings&#160;before the&#160;CAN-controller is&#160;initialized.&#160;<br/>
&#160;<br/>
<b>Prototype&#160;<br/></b>void&#160;ApplFblCanBusOff(&#160;void&#160;)&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
The&#160;FBL&#160;checks&#160;internally&#160;for communication errors&#160;via&#160;FblCanErrorTask()&#160;in the&#160;main loop.&#160;This&#160;function&#160;is&#160;<br/>called from&#160;FblCanErrorTask()&#160;while&#160;the&#160;CAN&#160;controller is&#160;in&#160;a&#160;bus-off&#160;state.&#160;<br/>This&#160;is&#160;a&#160;notification&#160;that the ECU&#160;cannot&#160;transmit&#160;messages.&#160;A&#160;strategy&#160;to&#160;re-initialize&#160;the&#160;CAN cell&#160;and/or&#160;<br/>controller has&#160;to&#160;implemented&#160;here to&#160;make sure the&#160;controller&#160;won’t be stuck&#160;in a&#160;bus&#160;off&#160;state.&#160;<br/>The&#160;example implementation&#160;resets&#160;the&#160;ECU.&#160;Please&#160;make sure that the reset&#160;complies&#160;with&#160;your ECU’s&#160;<br/>requirements.&#160;<br/>
&#160;<br/>
<b>Prototype&#160;<br/></b>void&#160;ApplFblBusSleep(&#160;void&#160;)&#160;<br/><b>Functional&#160;Description&#160;</b><br/>
This&#160;function&#160;indicates&#160;transition to&#160;bus&#160;silence.&#160;By&#160;calling&#160;this&#160;function&#160;the&#160;FBL&#160;indicates&#160;the&#160;application&#160;<br/>that the&#160;CAN&#160;bus&#160;has&#160;to&#160;go&#160;to&#160;bus&#160;sleep.&#160;<br/>
<b>Particularities&#160;and&#160;Limitations&#160;</b><br/>
<b>&gt;&#160;&#160;</b>If&#160;possible,&#160;the&#160;ECU must be set&#160;into&#160;sleep mode in&#160;this&#160;function.&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
51&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=52></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-52_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>Prototype&#160;<br/></b>void&#160;ApplFblStartApplication(&#160;void&#160;)&#160;<br/><b>Functional&#160;Description&#160;</b><br/>
This&#160;function&#160;is&#160;used to&#160;start the&#160;application software.&#160;<br/>
<b>Particularities&#160;and&#160;Limitations&#160;</b><br/>
<b>&gt;&#160;&#160;</b>When&#160;this&#160;function is&#160;called,&#160;ApplFblInit()&#160;has&#160;been&#160;executed.&#160;<br/><b>&gt;&#160;&#160;</b>The&#160;non-volatile memory&#160;driver has&#160;most likely&#160;been&#160;initialized.&#160;<br/>
<b>6.3&#160;</b><br/>
<b>Validation&#160;and non-volatile&#160;memory&#160;callbacks&#160;</b><br/>
<b>Prototype&#160;<br/></b>tFblProgStatus&#160;ApplFblExtProgRequest(&#160;void&#160;)&#160;<br/>
<b>Return&#160;code&#160;</b><br/>
tFblProgStatus&#160;<br/>
External&#160;programming&#160;request set&#160;or not&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
Function is&#160;called&#160;on power-on&#160;reset&#160;to check&#160;if&#160;an&#160;external&#160;programming&#160;request&#160;exists.&#160;<br/>
<b>Particularities&#160;and&#160;Limitations&#160;</b><br/>
<b>&gt;&#160;&#160;</b>The&#160;programming&#160;request flag&#160;will&#160;be&#160;reset&#160;by&#160;this&#160;function.&#160;<br/>
&#160;<br/>
<b>Prototype&#160;<br/></b>tApplStatus&#160;ApplFblIsValidApp(&#160;void&#160;)&#160;<br/>
<b>Return&#160;code&#160;</b><br/>
tApplStatus&#160;<br/>
Application&#160;validity&#160;status&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
Returns&#160;kApplValid if&#160;application is&#160;valid (all&#160;mandatory&#160;blocks&#160;available)&#160;and&#160;application&#160;start is&#160;allowed.&#160;<br/>Otherwise&#160;it returns&#160;kApplInvalid.&#160;<br/>
&#160;<br/>
<b>Prototype&#160;<br/></b>tFblResult&#160;ApplFblValidateApp(&#160;void&#160;)&#160;<br/><b>Return&#160;code&#160;</b><br/>
tFblResult&#160;<br/>
Validation&#160;success&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
Returns&#160;OK&#160;if&#160;the&#160;application valid flag&#160;has&#160;been successfully&#160;written.&#160;<br/>
&#160;<br/>
<b>Prototype&#160;<br/></b>tFblResult&#160;ApplFblInvalidateApp(&#160;void&#160;)&#160;<br/>
<b>Return&#160;code&#160;</b><br/>
tFblResult&#160;<br/>
Invalidation success&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
Returns&#160;OK&#160;if&#160;the&#160;application valid flag&#160;has&#160;been successfully&#160;removed.&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
52&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=53></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-53_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>Prototype&#160;<br/></b>tFblResult&#160;ApplFblValidateBlock(&#160;tBlockDescriptor&#160;blockDescriptor&#160;)&#160;<br/><b>Parameter&#160;</b><br/>
blockDescriptor&#160;<br/>
Block&#160;descriptor&#160;structure&#160;of&#160;logical&#160;block&#160;which is&#160;currently&#160;validated.&#160;<br/>
<b>Return&#160;code&#160;</b><br/>
tFblResult&#160;<br/>
Validation&#160;information&#160;has&#160;been&#160;written correctly.&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
Function is&#160;called&#160;after a successful&#160;download&#160;(CRC&#160;check&#160;was&#160;successful)&#160;to&#160;validate the logical&#160;block.&#160;<br/>
&#160;<br/>
<b>Prototype&#160;<br/></b>tFblResult&#160;ApplFblInvalidateBlock(&#160;tBlockDescriptor&#160;blockDescriptor&#160;)&#160;<br/><b>Parameter&#160;</b><br/>
blockDescriptor&#160;<br/>
Block&#160;descriptor&#160;structure&#160;of&#160;logical&#160;block&#160;which is&#160;currently&#160;invalidated.&#160;<br/>
<b>Return&#160;code&#160;</b><br/>
tFblResult&#160;<br/>
Validation&#160;information&#160;has&#160;been&#160;deleted&#160;correctly.&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
Whenever the&#160;bootloader&#160;needs&#160;to&#160;delete data,&#160;this&#160;function&#160;is&#160;called to&#160;invalidate&#160;the current logical&#160;block.&#160;<br/>
&#160;<br/>
<b>Prototype&#160;<br/></b>static&#160;tFblResult&#160;ApplFblChgBlockValid(&#160;vuint8&#160;mode,&#160;tBlockDescriptor&#160;descriptor&#160;)&#160;<br/>
<b>Parameter&#160;</b><br/>
Mode&#160;<br/>
Determines&#160;if&#160;a&#160;block&#160;is&#160;validated or&#160;invalidated.&#160;<br/>
tBlockDescriptor&#160;<br/>
Block&#160;descriptor&#160;of&#160;logical&#160;block&#160;to&#160;be&#160;validated&#160;or invalidated.&#160;<br/>
<b>Return&#160;code&#160;</b><br/>
tFblResult&#160;<br/>
Validation&#160;information&#160;stored correctly.&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
This&#160;function&#160;changes&#160;the&#160;validation&#160;flag&#160;of&#160;a&#160;logical&#160;block&#160;in NV-memory.&#160;<br/>
<b>Particularities&#160;and&#160;Limitations&#160;</b><br/>
<b>&gt;&#160;&#160;</b>The&#160;value&#160;is&#160;stored&#160;inverted.&#160;<br/><b>&gt;&#160;&#160;</b>Not used if&#160;presence&#160;patterns&#160;are activated.&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
53&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=54></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-54_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>Prototype&#160;<br/></b>static&#160;vsint16&#160;ApplFblGetPresencePatternBaseAddress(&#160;vuint8&#160;blockNr,&#160;<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;IO_PositionType&#160;*&#160;pPresPtnAddr,&#160;<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;IO_SizeType&#160;*&#160;pPresPtnLen&#160;)&#160;<br/><b>Parameter&#160;</b><br/>
blockNr&#160;<br/>
Logical&#160;block&#160;number&#160;<br/>
pPresPtnAddr&#160;<br/>
Presence&#160;pattern base&#160;address&#160;(output&#160;value)&#160;<br/>
pPresPtnLen&#160;<br/>
Presence&#160;pattern length&#160;(output&#160;value)&#160;<br/>
<b>Return&#160;code&#160;</b><br/>
memSegment&#160;<br/>
Returns&#160;the index&#160;of&#160;the selected&#160;flash&#160;block. If&#160;no&#160;flash block&#160;is&#160;found, a&#160;<br/>negative&#160;value&#160;is&#160;returned.&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
This&#160;function&#160;calculates&#160;the&#160;start&#160;address&#160;of&#160;the presence patterns&#160;of&#160;a&#160;specific&#160;logical&#160;block. It&#160;uses&#160;the&#160;<br/>logical&#160;block&#160;table to calculate&#160;the&#160;address,&#160;which&#160;is&#160;normally&#160;at&#160;the&#160;very&#160;end&#160;of&#160;a&#160;logical&#160;block.&#160;<br/>
&#160;<br/>
<b>Prototype&#160;<br/></b>static&#160;tFblResult&#160;ApplFblSetModulePresence(&#160;tBlockDescriptor&#160;*&#160;blockDescriptor&#160;)&#160;<br/>
<b>Parameter&#160;</b><br/>
blockDescriptor&#160;<br/>
Pointer&#160;to logical&#160;block&#160;descriptor.&#160;<br/>
<b>Return&#160;code&#160;</b><br/>
tFblResult&#160;<br/>
kFblOk&#160;if&#160;operation&#160;was&#160;successful, otherwise kFblFailed.&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
This&#160;function&#160;sets&#160;the&#160;presence pattern for a specific&#160;logical&#160;block.&#160;<br/>
<b>Particularities&#160;and&#160;Limitations&#160;</b><br/>
<b>&gt;&#160;&#160;</b>Previous&#160;erase operation must have cleared this&#160;area.&#160;<br/>
&#160;<br/>
<b>Prototype&#160;<br/></b>static&#160;tFblResult&#160;ApplFblClrModulePresence(&#160;tBlockDescriptor&#160;*&#160;blockDescriptor&#160;)&#160;<br/><b>Parameter&#160;</b><br/>
blockDescriptor&#160;<br/>
Pointer&#160;to logical&#160;block&#160;descriptor.&#160;<br/>
<b>Return&#160;code&#160;</b><br/>
tFblResult&#160;<br/>
kFblOk&#160;if&#160;operation&#160;was&#160;successful, otherwise kFblFailed.&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
This&#160;function&#160;writes&#160;a&#160;value&#160;into the presence mask.&#160;This&#160;invalidates&#160;the&#160;block.&#160;Note&#160;that the&#160;presence&#160;<br/>pattern&#160;area&#160;must be cleared by&#160;a&#160;following&#160;erase&#160;operation.&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
54&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=55></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-55_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>Prototype&#160;<br/></b>static&#160;tFblResult&#160;ApplFblChkModulePresence(&#160;tBlockDescriptor&#160;*&#160;blockDescriptor&#160;)&#160;<br/><b>Parameter&#160;</b><br/>
blockDescriptor&#160;<br/>
Pointer&#160;to logical&#160;block&#160;descriptor.&#160;<br/>
<b>Return&#160;code&#160;</b><br/>
tFblResult&#160;<br/>
Returns&#160;if&#160;a&#160;logical&#160;block&#160;is&#160;valid.&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
This&#160;function&#160;checks&#160;the presence pattern&#160;and mask&#160;if it indicates&#160;together&#160;a&#160;valid&#160;application.&#160;<br/>
&#160;<br/>
<b>Prototype&#160;<br/></b>tFblResult&#160;ApplFblAdjustLbtBlockData(&#160;tBlockDescriptor&#160;*&#160;blockDescriptor&#160;)&#160;<br/><b>Parameter&#160;</b><br/>
blockDescriptor&#160;<br/>
Pointer&#160;to logical&#160;block&#160;descriptor.&#160;<br/>
<b>Return&#160;code&#160;</b><br/>
tFblResult&#160;<br/>
Returns&#160;if&#160;a&#160;logical&#160;block&#160;is&#160;valid.&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
This&#160;function&#160;is&#160;called by&#160;the diagnostic&#160;layer&#160;after the&#160;logical&#160;block&#160;has&#160;been erased&#160;according&#160;to&#160;the&#160;<br/>definition of&#160;the&#160;logical&#160;block&#160;table.&#160;Now in this&#160;function&#160;the&#160;logical&#160;block&#160;size&#160;can&#160;be re-adjusted&#160;to&#160;the&#160;<br/>flashable area.&#160;This&#160;gives&#160;the&#160;possibility&#160;to disallow the download&#160;of&#160;data&#160;into a&#160;particular area.&#160;With&#160;the&#160;<br/>use of&#160;presence&#160;pattern this&#160;function&#160;is&#160;used&#160;to spare&#160;the&#160;presence pattern&#160;and mask&#160;area from&#160;the&#160;<br/>download,&#160;so that&#160;no&#160;data can&#160;be downloaded&#160;into this&#160;section. Only&#160;after successful&#160;validation&#160;of&#160;the&#160;<br/>logical&#160;block&#160;the function&#160;ApplFblSetPresencePattern&#160;is&#160;allowed&#160;to&#160;write&#160;into this&#160;area.&#160;Otherwise,&#160;an&#160;invalid&#160;<br/>download could&#160;lead&#160;to valid presence&#160;pattern and&#160;accidental&#160;start of&#160;an&#160;invalid application.&#160;<br/>
<b>Particularities&#160;and&#160;Limitations&#160;</b><br/>
<b>&gt;&#160;&#160;</b>The&#160;block&#160;descriptor&#160;handed over by&#160;the diagnostics&#160;module&#160;is&#160;changed&#160;by&#160;this&#160;function.&#160;<br/>
&#160;<br/>
<b>Prototype&#160;<br/></b>tFblResult&#160;ApplFblStoreFingerprint(&#160;vuint8&#160;*&#160;buffer&#160;)&#160;<br/><b>Parameter&#160;</b><br/>
buffer&#160;<br/>
Pointer&#160;to received&#160;fingerprint.&#160;<br/>
<b>Return&#160;code&#160;</b><br/>
tFblResult&#160;<br/>
Result&#160;of&#160;storage&#160;operation.&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
This&#160;function&#160;is&#160;called by&#160;the&#160;WriteDataByIdentifier service&#160;to&#160;store&#160;the&#160;received&#160;fingerprint&#160;in a&#160;temporary&#160;<br/>RAM&#160;buffer.&#160;The&#160;fingerprint&#160;is&#160;written into&#160;a non-volatile&#160;memory&#160;when the corresponding&#160;logical&#160;block&#160;is&#160;<br/>invalidated.&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
55&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=56></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-56_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>Prototype&#160;<br/></b>void&#160;ApplFblErrorNotification(&#160;tFblErrorType&#160;errorType,&#160;tFblErrorCode&#160;errorCode&#160;)&#160;<br/><b>Parameter&#160;</b><br/>
errorType&#160;<br/>
Indicates&#160;the error type&#160;(see&#160;fbl_def.h&#160;for a list&#160;of&#160;error types)&#160;<br/>
errorCode&#160;<br/>
Error code returned by&#160;the&#160;memory&#160;driver routine&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
Call-back&#160;function&#160;for diagnostic&#160;trouble code&#160;entries.&#160;This&#160;function is&#160;called&#160;whenever a&#160;programming&#160;error&#160;<br/>occurs.&#160;<br/>
&#160;<br/>
<b>Prototype&#160;<br/></b>tFblResult&#160;ApplFblWriteCRCTotal(&#160;tBlockDescriptor&#160;*&#160;blockDescriptor,&#160;<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;vuint32&#160;crcStart,&#160;<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;vuint32&#160;crcLength,&#160;<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;vuint32&#160;crcValue&#160;)&#160;<br/><b>Parameter&#160;</b><br/>
blockDescriptor&#160;<br/>
Information&#160;about the logical&#160;block&#160;being downloaded.&#160;<br/>
crcStart&#160;<br/>
Start&#160;address&#160;of&#160;checksum&#160;calculation area&#160;<br/>
crcLength&#160;<br/>
Length&#160;of&#160;checksum&#160;calculation area&#160;<br/>
crcValue&#160;<br/>
Checksum&#160;<br/>
<b>Return&#160;code&#160;</b><br/>
tFblResult&#160;<br/>
Write&#160;access&#160;result.&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
This&#160;function&#160;saves&#160;the&#160;CRC total&#160;to non-volatile memory.&#160;<br/>
&#160;<br/>
<b>Prototype&#160;<br/></b>vuint8&#160;ApplFblRWSecurityAccessDelayFlag(&#160;vuint8&#160;mode,&#160;vuint8&#160;value&#160;)&#160;<br/><b>Parameter&#160;</b><br/>
mode&#160;<br/>
Indicates&#160;if&#160;security&#160;access&#160;delay&#160;flag should&#160;be&#160;written&#160;or read.&#160;<br/>
value&#160;<br/>
Value&#160;to be&#160;written&#160;<br/>
<b>Return&#160;code&#160;</b><br/>
vuint8&#160;<br/>
Status&#160;of&#160;security&#160;access&#160;delay&#160;flag.&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
This&#160;function&#160;handles&#160;the security&#160;access&#160;delay&#160;flag. &#160;If&#160;the delay&#160;flag&#160;is&#160;set,&#160;a&#160;security&#160;access&#160;won’t be&#160;<br/>possible (programming&#160;won’t&#160;be&#160;possible).&#160;The&#160;delay&#160;flag&#160;is&#160;set&#160;after three&#160;unlock&#160;attempts.&#160;After a certain&#160;<br/>time period (default&#160;value:&#160;10&#160;minutes)&#160;the&#160;flag&#160;is&#160;cleared&#160;and&#160;the&#160;next attempt&#160;is&#160;possible.&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
56&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=57></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-57_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>Prototype&#160;<br/></b>tFblResult&#160;ApplFblIncProgCounts(&#160;tBlockDescriptor&#160;blockDescriptor&#160;)&#160;<br/>tFblResult&#160;ApplFblIncProgAttempts(&#160;tBlockDescriptor&#160;blockDescriptor&#160;)&#160;<br/><b>Parameter&#160;</b><br/>
blockDescriptor&#160;<br/>
Handle&#160;of&#160;current&#160;logical&#160;block.&#160;<br/>
<b>Return&#160;code&#160;</b><br/>
tFblResult&#160;<br/>
Indicates&#160;if&#160;the&#160;NV-memory&#160;access&#160;was&#160;successful.&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
These functions&#160;are used to incement the programming counter and programming attempt&#160;counter&#160;for each&#160;<br/>logical&#160;block.&#160;<br/>
<b>Particularities&#160;and&#160;Limitations&#160;</b><br/>
<b>&gt;&#160;&#160;</b>Values&#160;are stored&#160;inverted.&#160;<br/>
&#160;<br/>
<b>Prototype&#160;<br/></b>tFblResult&#160;ApplFblGetProgCounts(&#160;tBlockDescriptor&#160;blockDescriptor,&#160;vuint16&#160;*&#160;progCounts&#160;)&#160;<br/>tFblResult&#160;ApplFblGetProgAttempts(&#160;tBlockDescriptor&#160;blockDescriptor,&#160;<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;vuint16&#160;*&#160;progAttempts&#160;)&#160;<br/><b>Parameter&#160;</b><br/>
blockDescriptor&#160;<br/>
Handle&#160;of&#160;current logical&#160;block.&#160;<br/>
progCounts/Attempts&#160;&#160;Count&#160;of&#160;successful&#160;program&#160;updates&#160;or programming&#160;attempts.&#160;<br/>
<b>Return&#160;code&#160;</b><br/>
tFblResult&#160;<br/>
Indicates&#160;if&#160;the&#160;NV-memory&#160;access&#160;was&#160;successful.&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
Both&#160;functions&#160;are used to read the&#160;programming&#160;and&#160;programming&#160;attempt&#160;counters&#160;from&#160;NV-memory.&#160;<br/>
&#160;<br/>
<b>Prototype&#160;<br/></b>tFblResult&#160;ApplFblWriteSecAccessInvalidCount(vuint8&#160;*&#160;invalidCount)&#160;<br/><b>Parameter&#160;</b><br/>
invalidCount&#160;<br/>
Number&#160;of&#160;invalid&#160;security&#160;access&#160;attempts.&#160;<br/>
<b>Return&#160;code&#160;</b><br/>
tFblResult&#160;<br/>
Indicates&#160;if&#160;the&#160;NV-memory&#160;access&#160;was&#160;successful.&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
Write&#160;number&#160;of&#160;invalid security&#160;access&#160;attempts.&#160;<br/>
<b>Particularities&#160;and&#160;Limitations&#160;</b><br/>
<b>&gt;&#160;&#160;</b>Value&#160;is&#160;stored&#160;inverted.&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
57&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=58></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-58_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>Prototype&#160;<br/></b>tFblResult&#160;ApplFblReadSecAccessInvalidCount(vuint8&#160;*&#160;invalidCount)&#160;<br/><b>Parameter&#160;</b><br/>
invalidCount&#160;<br/>
Number&#160;of&#160;invalid&#160;security&#160;access&#160;attempts.&#160;<br/>
<b>Return&#160;code&#160;</b><br/>
tFblResult&#160;<br/>
Indicates&#160;if&#160;the&#160;NV-memory&#160;access&#160;was&#160;successful.&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
Read&#160;number&#160;of&#160;invalid security&#160;access&#160;attempts.&#160;<br/>
<b>Particularities&#160;and&#160;Limitations&#160;</b><br/>
&#160;<br/>
<b>Prototype&#160;<br/></b>vuint16&#160;ApplFblGetPromMaxProgAttempts(vuint8&#160;blockNr)&#160;<br/><b>Parameter&#160;</b><br/>
blockNr&#160;<br/>
Number&#160;of&#160;logical&#160;block.&#160;<br/>
<b>Return&#160;code&#160;</b><br/>
vuint16&#160;<br/>
Maximum&#160;number&#160;of&#160;allowed programming&#160;attempts.&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
This&#160;function&#160;returns&#160;the&#160;number&#160;of&#160;allowed&#160;programming&#160;attempts&#160;for a given logical&#160;block.&#160;<br/>
&#160;<br/>
<b>Prototype&#160;<br/></b>vuint8&#160;ApplFblGetSecAccessDelayFlag(&#160;void&#160;)&#160;<br/><b>Return&#160;code&#160;</b><br/>
vuint8&#160;<br/>
0 if&#160;security&#160;access&#160;delay&#160;flag&#160;is&#160;not set, !=&#160;0&#160;if&#160;set.&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
Returns&#160;the state of&#160;the security&#160;access&#160;delay&#160;flag.&#160;<br/>
&#160;<br/>
<b>Prototype&#160;<br/></b>vuint8&#160;ApplFblSetSecAccessDelayFlag(&#160;void&#160;)&#160;<br/><b>Return&#160;code&#160;</b><br/>
vuint8&#160;<br/>
State of&#160;non-volatile memory&#160;access.&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
Sets&#160;the security&#160;access&#160;delay&#160;flag&#160;in NV-memory.&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
58&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=59></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-59_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>Prototype&#160;<br/></b>vuint8&#160;ApplFblClrSecAccessDelayFlag(&#160;void&#160;)&#160;<br/><b>Return&#160;code&#160;</b><br/>
vuint8&#160;<br/>
State of&#160;non-volatile memory&#160;access.&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
Clears&#160;the security&#160;access&#160;delay&#160;flag in NV-memory.&#160;<br/>
&#160;<br/>
<b>Prototype&#160;<br/></b>tFblResult&#160;ApplFblReadResetResponseFlag(&#160;vuint8*&#160;buffer&#160;);&#160;<br/>
<b>Parameter&#160;</b><br/>
buffer&#160;<br/>
Read&#160;buffer&#160;<br/>
<b>Return&#160;code&#160;</b><br/>
tFblResult&#160;<br/>
Returns&#160;if&#160;NV-memory&#160;access&#160;was&#160;successful.&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
Reads&#160;the&#160;reset&#160;response flag&#160;from&#160;NV-memory.&#160;<br/>
<b>Particularities&#160;and&#160;Limitations&#160;</b><br/>
<b>&gt;&#160;&#160;</b>Has&#160;to&#160;be evaluated&#160;in&#160;both&#160;application and&#160;bootloader.&#160;<br/>
&#160;<br/>
<b>Prototype&#160;<br/></b>tFblResult&#160;ApplFblWriteResetResponseFlag(&#160;vuint8*&#160;buffer&#160;)&#160;<br/>
<b>Parameter&#160;</b><br/>
buffer&#160;<br/>
Buffer with&#160;reset response flag.&#160;<br/>
<b>Return&#160;code&#160;</b><br/>
tFblResult&#160;<br/>
Returns&#160;if&#160;NV-memory&#160;access&#160;was&#160;successful.&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
Write&#160;reset&#160;response flag&#160;to&#160;NV-memory&#160;before reset.&#160;<br/>
<b>6.4&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>
<b>&#160;</b><br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
59&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=60></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-60_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>6.5&#160;</b><br/>
<b>Diagnostic&#160;Service&#160;Callbacks&#160;</b><br/>
<b>Prototype&#160;<br/></b>void&#160;ApplDiagUserService(&#160;vuint8&#160;*&#160;pbDiagData,&#160;tTpDataType&#160;diagReqDataLen&#160;)&#160;<br/>void&#160;ApplDiagUserRoutine(&#160;vuint8&#160;*&#160;pbDiagData,&#160;tTpDataType&#160;diagReqDataLen&#160;)&#160;<br/>void&#160;ApplDiagUserSubFunction(&#160;vuint8&#160;*&#160;pbDiagData,&#160;tTpDataType&#160;diagReqDataLen&#160;)&#160;<br/><b>Parameter&#160;</b><br/>
pbDiagData&#160;<br/>
Pointer&#160;to diag&#160;service data&#160;(after SID!)&#160;<br/>
diagReqDataLen&#160;<br/>
Service data&#160;length&#160;(without SID!)&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
The&#160;flash&#160;bootloader&#160;supports&#160;a&#160;set&#160;of&#160;diagnostic&#160;services.&#160;All&#160;diagnostic&#160;services&#160;not supported by&#160;the&#160;<br/>bootloader&#160;are&#160;passed&#160;to&#160;three&#160;call-back&#160;functions.&#160;<br/>The&#160;call-back&#160;function&#160;ApplDiagUserService&#160;is&#160;called&#160;whenever the&#160;bootloader&#160;receives&#160;an&#160;unknown&#160;<br/>service&#160;identifier,&#160;ApplDiagUserSubFunction&#160;is&#160;called&#160;whenever the&#160;bootloader&#160;receives&#160;an&#160;unknown&#160;sub-<br/>function&#160;identifier&#160;and&#160;ApplDiagUserRoutine is&#160;called&#160;whenever the&#160;bootloader receives&#160;an&#160;unknown&#160;<br/>routine identifier..&#160;<br/>
&#160;<br/>
&#160;<br/>
<b>Prototype&#160;<br/></b>void&#160;ApplFblReadDataByIdentifier(&#160;vuint8&#160;*&#160;pbDiagData,&#160;tTpDataType&#160;diagReqDataLen&#160;)&#160;<br/>
<b>Parameter&#160;</b><br/>
pbDiagData&#160;<br/>
Pointer&#160;to diag&#160;service data&#160;(after SID!)&#160;<br/>
diagReqDataLen&#160;<br/>
Service data&#160;length&#160;(without SID!)&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
This&#160;function&#160;is&#160;called to&#160;handle&#160;Read-Data-By-Identifier requests.&#160;<br/>The&#160;routine must retrieve&#160;the data-identifier (DID)&#160;from&#160;the message buffer, fill&#160;the&#160;message buffer with&#160;the&#160;<br/>appropriate response,&#160;and&#160;set&#160;the&#160;global&#160;variable DiagDataLength&#160;to the number&#160;of&#160;bytes&#160;added to&#160;the&#160;<br/>buffer.&#160;<br/>
&#160;<br/>
<b>Prototype&#160;<br/></b>vuint8&#160;ApplFblWriteDataByIdentifier(&#160;vuint8&#160;*&#160;pbDiagData,&#160;tTpDataType&#160;diagReqDataLen&#160;)&#160;<br/><b>Parameter&#160;</b><br/>
pbDiagData&#160;<br/>
Pointer&#160;to diag&#160;service data&#160;(after SID!)&#160;<br/>
diagReqDataLen&#160;<br/>
Service data&#160;length&#160;(without SID!)&#160;<br/>
<b>Return&#160;code&#160;</b><br/>
vuint8&#160;<br/>
Success&#160;of&#160;NV-memory&#160;access.&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
This&#160;function&#160;is&#160;called to&#160;handle&#160;Write-Data-By-Identifier&#160;requests.&#160;<br/>The&#160;routine must retrieve&#160;the data-identifier (DID)&#160;from&#160;the message buffer.&#160;<br/>
<b>Particularities&#160;and&#160;Limitations&#160;</b><br/>
<b>&gt;&#160;&#160;</b>This&#160;function&#160;supports&#160;a&#160;special&#160;return&#160;value besides&#160;kFblOk&#160;and kFblFailed&#160;to signal&#160;that&#160;a&#160;fingerprint&#160;<br/>
has&#160;been&#160;received: kDiagReturnValidationOk.&#160;<br/>
&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
60&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=61></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-61_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>Prototype&#160;<br/></b>void&#160;ApplFblInitErrStatus(&#160;void&#160;)&#160;<br/><b>Functional&#160;Description&#160;</b><br/>
This&#160;routine&#160;is&#160;called to&#160;initialize&#160;the&#160;global&#160;variables&#160;used&#160;to&#160;save&#160;the&#160;FBL&#160;state&#160;when&#160;an&#160;error occurs.&#160;The&#160;<br/>state may&#160;be&#160;retrieved by&#160;sending&#160;a Read-Data-By-Identifier request&#160;with&#160;a data-identifier of&#160;$7F.&#160;<br/>
<b>Particularities&#160;and&#160;Limitations&#160;</b><br/>
<b>&gt;&#160;&#160;</b>FBL&#160;error state is&#160;available&#160;only&#160;if&#160;project state&#160;is&#160;set&#160;to&#160;„Integration“&#160;<br/>
&#160;<br/>
<b>6.6&#160;</b><br/>
<b>Watchdog&#160;Callbacks&#160;</b><br/>
<b>Prototype&#160;<br/></b>void&#160;ApplFblWDInit(&#160;void&#160;)&#160;<br/>
<b>Functional&#160;Description&#160;</b><br/>
The&#160;purpose of&#160;this&#160;function is&#160;to&#160;start the&#160;watchdog function&#160;of&#160;the&#160;ECU.&#160;The&#160;function&#160;is&#160;called only&#160;after&#160;<br/>the&#160;FBL&#160;has&#160;determined that&#160;it&#160;will&#160;not start the&#160;application (It&#160;is&#160;called&#160;shortly&#160;after the&#160;first call&#160;of&#160;<br/>ApplFblStartup()).&#160;<br/>If&#160;the&#160;watchdog&#160;is&#160;initialized&#160;in this&#160;routine,&#160;then&#160;the&#160;FBL&#160;may&#160;start the&#160;application&#160;without starting the&#160;<br/>watchdog.&#160;&#160;In this&#160;case,&#160;the&#160;application&#160;will&#160;be&#160;responsible for starting&#160;the&#160;watchdog itself.&#160;<br/>The&#160;FBL&#160;uses&#160;a&#160;hardware timer to determine&#160;when&#160;to&#160;reset&#160;the&#160;watchdog&#160;(via&#160;ApplFblWDTrigger()).&#160;The&#160;<br/>timer is&#160;initialized&#160;shortly&#160;after this&#160;routine&#160;is&#160;called. You&#160;must ensure that the&#160;watchdog&#160;timer will&#160;not reset&#160;<br/>the&#160;ECU before the&#160;FBL&#160;can call&#160;the trigger&#160;function&#160;for&#160;the first time.&#160;<br/>
<b>Particularities&#160;and&#160;Limitations&#160;</b><br/>
<b>&gt;&#160;&#160;</b>In&#160;addition to&#160;initializing the&#160;hardware responsible for the&#160;watchdog,&#160;the global&#160;variable&#160;WDTimer&#160;must&#160;<br/>
be&#160;initialized to&#160;the&#160;number&#160;of&#160;“ticks”&#160;that&#160;define&#160;the&#160;interval&#160;between&#160;calls&#160;to&#160;the&#160;trigger function. &#160;The&#160;<br/>interval&#160;is&#160;determined from&#160;your configuration, and&#160;is&#160;defined&#160;by&#160;the&#160;macro FBL_WATCHDOG_TIME.&#160;<br/>
<b>&gt;&#160;&#160;</b>You may&#160;decide&#160;to initialize&#160;the&#160;watchdog&#160;hardware in&#160;the&#160;ECU startup&#160;code or&#160;in&#160;ApplFblInit().&#160;<br/>
&#160;<br/>
<b>Prototype&#160;<br/></b>void&#160;ApplFblWDLong(&#160;void&#160;)&#160;<br/><b>Functional&#160;Description&#160;</b><br/>
The&#160;purpose of&#160;this&#160;function is&#160;to&#160;synchronize&#160;the&#160;start of&#160;the application&#160;with the&#160;watchdog.&#160;&#160;The&#160;call&#160;gives&#160;<br/>you&#160;the&#160;opportunity&#160;to ensure that&#160;the&#160;watchdog&#160;will&#160;not interrupt the&#160;application’s&#160;startup.&#160;<br/>The&#160;function&#160;is&#160;called&#160;just before the&#160;bootloader&#160;starts&#160;your&#160;application.&#160;<br/>
<b>Particularities&#160;and&#160;Limitations&#160;</b><br/>
<b>&gt;&#160;&#160;</b>The&#160;function&#160;is&#160;not&#160;called&#160;when&#160;the&#160;FBL&#160;jumps&#160;to&#160;the&#160;application&#160;directly&#160;after power-on.&#160;The&#160;call&#160;is&#160;<br/>
made when&#160;the&#160;FBL&#160;is&#160;ready&#160;to&#160;start the O.S.&#160;after a download. Care&#160;should&#160;be&#160;taken&#160;if&#160;the&#160;watchdog&#160;<br/>(WD)&#160;is&#160;initialized in&#160;ApplFblInit(), as&#160;no&#160;synchronization is&#160;performed.&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
61&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=62></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-62_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>Prototype&#160;<br/></b>void&#160;ApplFblWDShort(&#160;void&#160;)&#160;<br/><b>Particularities&#160;and&#160;Limitations&#160;</b><br/>
<b>&gt;&#160;&#160;</b>Currently&#160;not&#160;used&#160;in&#160;bootloader.&#160;<br/>
&#160;<br/>
<b>Prototype&#160;<br/></b>void&#160;V_CALLBACK_NEAR&#160;ApplFblWDTrigger(&#160;void&#160;)&#160;<br/><b>Functional&#160;Description&#160;</b><br/>
This&#160;function&#160;is&#160;called by&#160;FblLookForWatchdog()&#160;and&#160;contains&#160;the&#160;actual&#160;watchdog&#160;trigger code. Depending&#160;<br/>on&#160;the configuration,&#160;please note the following&#160;points:&#160;<br/>&#160;&#160;If&#160;the function&#160;is&#160;copied&#160;by&#160;FblCopyWatchdog(), it has&#160;to&#160;be&#160;relocatable&#160;and&#160;normally&#160;no&#160;function&#160;calls&#160;<br/>
out of&#160;this&#160;function&#160;are&#160;allowed.&#160;<br/>
&#160;&#160;If&#160;the function&#160;is&#160;placed&#160;in&#160;RAM&#160;by&#160;the&#160;linker, it&#160;has&#160;to&#160;be&#160;present&#160;before the&#160;first call.&#160;<br/>&#160;&#160;If&#160;any&#160;function&#160;calls&#160;are&#160;done,&#160;the called&#160;functions&#160;have&#160;to&#160;be placed&#160;in&#160;RAM as&#160;well.&#160;<br/>
&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
62&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=63></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-63_1.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-63_2.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-63_3.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>7&#160;&#160;Build&#160;your&#160;Bootloader&#160;</b><br/>
The&#160;bootloader&#160;demonstration&#160;is&#160;delivered&#160;with&#160;a&#160;make&#160;system&#160;which&#160;can&#160;be&#160;used&#160;to&#160;build&#160;<br/>the&#160;bootloader.&#160;The&#160;following&#160;files control&#160;how&#160;your&#160;bootloader&#160;is built:&#160;<br/><b>&#160;&#160;</b>Makefile:&#160;Compiler&#160;dependent&#160;settings like&#160;the&#160;path&#160;to&#160;your compiler installation&#160;and&#160;<br/>
compiler&#160;options.&#160;To&#160;rebuild&#160;the&#160;demonstrations&#160;bootloader,&#160;you&#160;have&#160;to&#160;adapt&#160;the&#160;<br/>compiler&#160;path&#160;in&#160;this&#160;file.&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>Example&#160;</b><br/>
&#160;&#160;#------------------------------------------------------------------------------&#160;<br/>
#-------------------------&#160;MUST&#160;be&#160;filled&#160;out&#160;---------------------------------&#160;<br/>#&#160;Define&#160;Compiler&#160;path&#160;<br/>#&#160;E.g.:&#160;COMPILER_BASE&#160;=&#160;C:\Uti\HC08\HIWARE&#160;<br/>#&#160;&#160;&#160;&#160;&#160;&#160;&#160;COMPILER_BIN&#160;&#160;=&#160;$(COMPILER_BASE)\prog&#160;<br/>#&#160;&#160;&#160;&#160;&#160;&#160;&#160;COMPILER_INC&#160;&#160;=&#160;$(COMPILER_BASE)\lib\hc08c\include&#160;<br/>#&#160;&#160;&#160;&#160;&#160;&#160;&#160;COMPILER_LIB&#160;&#160;=&#160;$(COMPILER_BASE)\lib\hc08c\lib&#160;<br/>#------------------------------------------------------------------------------&#160;<br/>
COMPILER_BASE&#160;=&#160;&lt;path&#160;to&#160;your&#160;compiler&gt;&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/><b>&#160;&#160;</b>Makefile.config:&#160;Project&#160;specific settings.&#160;<br/>
<b>&#160;&#160;</b>Makefile.&lt;platform&gt;.&lt;compiler&gt;.ALL.make:&#160;This&#160;file&#160;is used&#160;to&#160;generate&#160;the&#160;linker&#160;<br/>
control&#160;file.&#160;<br/>
<b>&#160;&#160;</b>Makefile.project.part.defines:&#160;Files and&#160;modules&#160;included&#160;in&#160;your&#160;bootloader&#160;project&#160;<br/>
are configured&#160;in&#160;this&#160;file.&#160;<br/>
<b>7.1&#160;</b><br/>
<b>Bootloader specific&#160;linker requirements&#160;</b><br/>
The&#160;bootloader&#160;has&#160;to&#160;execute&#160;parts&#160;of&#160;its&#160;code&#160;from&#160;RAM&#160;because&#160;flash&#160;read&#160;accesses&#160;<br/>are normally&#160;not&#160;permitted&#160;while&#160;flash&#160;memory is written&#160;or&#160;erased.&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>Example&#160;<br/></b>Please see&#160;the linker&#160;control&#160;file&#160;and&#160;the&#160;MemMap.h&#160;file of&#160;the&#160;bootloader&#160;<br/>
&#160;&#160;demonstration&#160;project&#160;as&#160;an&#160;example.&#160;<br/>
These&#160;files also&#160;can&#160;be&#160;used&#160;to&#160;get&#160;a detailed&#160;list&#160;of&#160;functions&#160;which have to be&#160;linked&#160;<br/>to RAM.&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>&#160;<br/>
&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
63&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=64></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-64_1.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-64_2.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
Please&#160;make&#160;sure&#160;the&#160;following&#160;parts of&#160;the&#160;bootloader&#160;are linked&#160;to&#160;RAM:&#160;<br/>
&#160;<br/>
<b>Bootloader&#160;use case&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</b><br/>
&#160;<br/>
<b>&#160;</b><br/>
&#160;<br/>
ngi<br/>
&#160;<br/>
er<br/>
n&#160;<br/>
d<br/>
oi<br/>
mm<br/>
&#160;<br/>
oa<br/>
atc<br/>
a<br/>
fi<br/>
r<br/>
i<br/>
&#160;<br/>
otl<br/>o<br/>
er<br/>
ogr<br/>
B<br/>
V<br/>
P<br/>
<b>&#160;</b><br/>
&#160;<br/>
&#160;<br/>
d&#160;r<br/>
ed<br/>
ed<br/>
<b>&#160;</b><br/>
da<br/>
ni<br/>
ni<br/>
el<br/>
el<br/>
<b>Module&#160;/&#160;function&#160;</b><br/>
tan<br/>
pi<br/>
pi<br/>
S<br/>
P<br/>
P<br/>
FblLookForWatchdog()&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
FblLookForWatchdogVoid()&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
ApplFblWdTrigger()&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
FblMemRxNotification()&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
FblDiagRx*()&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
FblDiagTx*()&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
FblDiagDefaultPostHandler, other post handler functions&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
fbl_hw.c&#160;(Code&#160;and&#160;constants)&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
fbl_cw.c&#160;(Code and constants)&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
fbl_tp.c&#160;(Code and&#160;constants)&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
Table&#160;7-1&#160;&#160;&#160;RAM/ROM&#160;linkage&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>Caution&#160;<br/></b>Depending&#160;on&#160;your&#160;hardware,&#160;additional&#160;functions&#160;or&#160;modules&#160;may&#160;have to be&#160;linked&#160;to&#160;<br/>
<b>&#160;&#160;</b>RAM.&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>&#160;<br/>
&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
64&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=65></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-65_1.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-65_2.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>8&#160;&#160;Adapt&#160;your&#160;application&#160;</b><br/>
<b>8.1&#160;</b><br/>
<b>Memory&#160;Layout&#160;</b><br/>
Bootloader&#160;&#160;and&#160;&#160;application&#160;&#160;mostly&#160;&#160;occupy&#160;&#160;different&#160;&#160;memory&#160;&#160;areas.&#160;&#160;There&#160;&#160;is&#160;&#160;only&#160;&#160;one&#160;<br/>shared&#160;area&#160;which&#160;is&#160;linked&#160;to&#160;the&#160;application&#160;memory&#160;by&#160;the&#160;bootloader&#160;and&#160;used&#160;to&#160;start&#160;<br/>the&#160;application&#160;software.&#160;<br/>The&#160;&#160;bootloader&#160;&#160;has&#160;&#160;to&#160;&#160;be&#160;&#160;linked&#160;&#160;to&#160;&#160;a&#160;&#160;memory&#160;&#160;area&#160;&#160;which&#160;&#160;can&#160;&#160;be&#160;&#160;started&#160;&#160;by&#160;&#160;your&#160;<br/>microcontroller,&#160;&#160;e.g.&#160;&#160;by&#160;&#160;the&#160;&#160;reset&#160;&#160;vector&#160;&#160;or&#160;&#160;a&#160;&#160;reset&#160;&#160;data&#160;&#160;structure.&#160;&#160;Please&#160;&#160;see&#160;&#160;also&#160;<br/>[#hw_mem].&#160;<br/>
<b>8.2&#160;</b><br/>
<b>Application Start&#160;</b><br/>
The&#160;application&#160;software&#160;is&#160;started&#160;using&#160;the&#160;so-called&#160;application&#160;vector&#160;table.&#160;This&#160;data&#160;<br/>structure is&#160;included&#160;in&#160;the&#160;bootloader&#160;but&#160;linked&#160;to&#160;the&#160;application&#160;memory.&#160;It&#160;is overwritten&#160;<br/>by&#160;the&#160;application&#160;during&#160;flashing.&#160;<br/>There&#160;&#160;are&#160;&#160;2&#160;&#160;variants&#160;&#160;of&#160;&#160;this&#160;&#160;table.&#160;&#160;Controllers&#160;&#160;with&#160;&#160;a&#160;&#160;configurable&#160;&#160;interrupt&#160;&#160;vector&#160;&#160;base&#160;<br/>address&#160;&#160;include&#160;&#160;a&#160;&#160;smaller&#160;&#160;table;&#160;&#160;controllers&#160;&#160;without&#160;&#160;a&#160;&#160;configurable&#160;&#160;interrupt&#160;&#160;vector&#160;&#160;base&#160;<br/>address&#160;include&#160;a&#160;complete&#160;interrupt&#160;vector table&#160;in&#160;bootloader&#160;and&#160;application.&#160;<br/>
<b>8.2.1&#160;</b><br/>
<b>Controllers&#160;with a&#160;configurable&#160;interrupt&#160;base&#160;address&#160;</b><br/>
Controllers&#160;&#160;with&#160;&#160;a&#160;&#160;configurable&#160;&#160;interrupt&#160;&#160;vector&#160;&#160;base&#160;&#160;address&#160;&#160;need&#160;&#160;to&#160;&#160;include&#160;&#160;a&#160;&#160;data&#160;<br/>structure&#160;&#160;which&#160;&#160;includes&#160;&#160;the&#160;&#160;start&#160;&#160;address&#160;&#160;of&#160;&#160;the&#160;&#160;application&#160;&#160;software.&#160;&#160;This&#160;&#160;structure&#160;&#160;is&#160;<br/>included&#160;in&#160;the&#160;file&#160;fbl_applvect.c&#160;and&#160;normally&#160;consists&#160;of&#160;a&#160;magic&#160;word&#160;and&#160;the&#160;address.&#160;<br/>A&#160;&#160;similar&#160;&#160;structure&#160;&#160;has&#160;&#160;to&#160;&#160;be&#160;&#160;added&#160;&#160;to&#160;&#160;the&#160;&#160;application&#160;&#160;software&#160;&#160;and&#160;&#160;linked&#160;&#160;to&#160;&#160;the&#160;&#160;exactly&#160;<br/>same&#160;address&#160;than&#160;the&#160;bootloader&#160;uses.&#160;<br/>
<b>8.2.2&#160;</b><br/>
<b>Controllers&#160;with interrupt&#160;jump tables&#160;</b><br/>
If&#160;&#160;the&#160;&#160;interrupt&#160;&#160;vector&#160;&#160;base&#160;&#160;address&#160;&#160;is&#160;&#160;not&#160;&#160;configurable,&#160;&#160;it&#160;&#160;is&#160;&#160;normally&#160;&#160;located&#160;&#160;in&#160;&#160;the&#160;<br/>bootloader’s&#160;&#160;address&#160;&#160;space.&#160;&#160;The&#160;&#160;bootloader&#160;&#160;includes&#160;&#160;a&#160;&#160;interrupt&#160;&#160;vector&#160;&#160;table&#160;&#160;with&#160;&#160;jump&#160;<br/>opcodes.&#160;&#160;These&#160;&#160;jump&#160;&#160;opcodes&#160;&#160;point&#160;&#160;to&#160;&#160;a&#160;&#160;second&#160;&#160;vector&#160;&#160;table&#160;&#160;which&#160;&#160;is&#160;&#160;placed&#160;&#160;in&#160;&#160;the&#160;<br/>application&#160;memory&#160;and&#160;can&#160;be&#160;used&#160;like&#160;the&#160;original&#160;interrupt&#160;vector&#160;table.&#160;This&#160;table&#160;also&#160;<br/>is&#160;linked&#160;with&#160;the&#160;bootloader&#160;(mostly&#160;fbl_applvect.c,&#160;but&#160;an&#160;assembler&#160;version&#160;may&#160;be&#160;used&#160;<br/>depending&#160;&#160;on&#160;&#160;the&#160;&#160;compiler).&#160;&#160;The&#160;&#160;application&#160;&#160;variant&#160;&#160;can&#160;&#160;be&#160;&#160;created&#160;&#160;from&#160;&#160;the&#160;&#160;file&#160;<br/>.\BSW\Fbl\_Template\_applvect.c.&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>Note&#160;<br/></b>Please note&#160;that&#160;the position&#160;of&#160;the&#160;interrupt&#160;vector&#160;table is&#160;fixed&#160;by&#160;the&#160;bootloader&#160;<br/>
&#160;&#160;setup&#160;and&#160;cannot&#160;be&#160;changed&#160;independently&#160;by&#160;the&#160;application software.&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
65&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=66></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-66_1.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-66_2.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-66_3.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-66_4.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>8.3&#160;</b><br/>
<b>Shared files&#160;between&#160;FBL and application&#160;</b><br/>
Bootloader&#160;and&#160;application&#160;do&#160;not&#160;have&#160;to&#160;share&#160;files.&#160;&#160;However,&#160;&#160;if&#160;some&#160;files&#160;are&#160;&#160;shared&#160;<br/>data&#160;exchange&#160;between&#160;both&#160;is&#160;made&#160;easier.&#160;<br/>The&#160;FblHeader&#160;structur&#160;is&#160;defined&#160;in&#160;fbl_main.h.&#160;Access&#160;macros&#160;which&#160;can&#160;be&#160;used&#160;in&#160;the&#160;<br/>application&#160;&#160;software&#160;&#160;are&#160;&#160;also&#160;&#160;defined&#160;&#160;in&#160;&#160;this&#160;&#160;file.&#160;&#160;The&#160;&#160;fbl_main.h&#160;&#160;header&#160;&#160;file&#160;&#160;depends&#160;&#160;on&#160;<br/>fbl_def.h&#160;and&#160;fbl_cfg.h.&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>Caution&#160;<br/></b>If&#160;“fbl_main.h”,&#160;“fbl_def.h”&#160;and&#160;“fbl_cfg.h”&#160;are&#160;used in&#160;the&#160;application software,&#160;you&#160;have&#160;<br/>
<b>&#160;&#160;</b>to&#160;make&#160;sure&#160;the&#160;files are consistent&#160;between&#160;bootloader&#160;and&#160;application.&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>
<b>8.4&#160;</b><br/>
<b>Shared memory&#160;between FBL&#160;and application&#160;</b><br/>
There&#160;is&#160;no&#160;memory,&#160;which&#160;is&#160;shared&#160;between&#160;the&#160;FBL&#160;and&#160;the&#160;&#160;application.&#160;Each&#160;project&#160;<br/>(FBL&#160;and&#160;application)&#160;uses its&#160;own&#160;stack,&#160;RAM&#160;and&#160;ROM.&#160;<br/>Besides&#160;this,&#160;bootloader&#160;and&#160;application&#160;have&#160;to&#160;share some&#160;information:&#160;<br/><b>&#160;&#160;</b>The&#160;transition&#160;between&#160;from&#160;bootloader&#160;to&#160;application&#160;and&#160;back&#160;has&#160;to&#160;be&#160;coordinated.&#160;<br/>
In&#160;general,&#160;a&#160;reset&#160;response&#160;flag&#160;and&#160;a&#160;programming&#160;request&#160;flag&#160;has to&#160;be&#160;passed&#160;<br/>between&#160;both.&#160;<br/>
<b>&#160;&#160;</b>Depending&#160;on&#160;your ECU’s requirements,&#160;process data&#160;like&#160;fingerprints&#160;or version&#160;<br/>
numbers&#160;have&#160;to&#160;be&#160;exchanged&#160;between&#160;bootloader&#160;and&#160;application.&#160;<br/>
User&#160;&#160;specific&#160;&#160;extensions&#160;&#160;can&#160;&#160;be&#160;added&#160;&#160;using&#160;&#160;the&#160;&#160;so-called&#160;&#160;common&#160;&#160;data&#160;&#160;structure.&#160;This&#160;<br/>data&#160;structure&#160;is&#160;added&#160;to&#160;FblHeader&#160;and&#160;can&#160;be&#160;defined&#160;according&#160;to&#160;the&#160;data&#160;which&#160;has&#160;<br/>to&#160;be&#160;shared&#160;between&#160;bootloader&#160;and&#160;application.&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>Note&#160;<br/></b>The&#160;common&#160;data&#160;structure&#160;can&#160;be&#160;activated&#160;by&#160;the&#160;switch&#160;<br/>
&#160;&#160;FBL_ENABLE_COMMON_DATA&#160;in a&#160;user&#160;configuration&#160;file.&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>The&#160;type&#160;definition&#160;and&#160;constant&#160;which&#160;contains&#160;the&#160;shared&#160;data&#160;should&#160;be&#160;added&#160;to&#160;a&#160;user&#160;<br/>modifiable&#160;file&#160;like&#160;fbl_ap.c.&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>Caution&#160;<br/></b>The&#160;variable name of&#160;this&#160;structure&#160;has&#160;to be&#160;fblCommonData.&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
66&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=67></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-67_1.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-67_2.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-67_3.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>8.5&#160;</b><br/>
<b>Transition between Bootloader and&#160;Application&#160;</b><br/>
<b>8.5.1&#160;</b><br/>
<b>[#oem_start]&#160;[#oem_trans]&#160;-&#160;Programming&#160;Session Request&#160;</b><br/>
There are&#160;two&#160;possibilities to&#160;handle&#160;the&#160;programming&#160;session&#160;request:&#160;<br/><b>&#160;&#160;</b>Shared&#160;memory:&#160;A&#160;shared&#160;memory&#160;location&#160;either in&#160;non-volatile&#160;memory&#160;or&#160;<br/>
uninitialized&#160;RAM&#160;is used&#160;to&#160;hand&#160;over the&#160;programming&#160;session&#160;request.&#160;This&#160;<br/>memory&#160;area&#160;has to&#160;be&#160;written&#160;by&#160;the&#160;application&#160;software.&#160;After a&#160;reset&#160;has&#160;been&#160;<br/>issued,&#160;the&#160;bootloader&#160;has to&#160;read&#160;the&#160;programming&#160;session&#160;request&#160;flag&#160;in&#160;<br/>ApplFblExtProgRequest()&#160;and&#160;clear the&#160;flag.&#160;<br/>
<b>&#160;&#160;</b>FblStart is used.&#160;The&#160;FblStart-feature&#160;provides a&#160;possibility&#160;to&#160;store the&#160;programming&#160;<br/>
session&#160;request&#160;flag&#160;completely&#160;in&#160;bootloader&#160;context.&#160;The&#160;FblHeader-structure&#160;<br/>provides a&#160;function&#160;pointer to&#160;a&#160;bootloader&#160;function&#160;called&#160;“FblStart()”.&#160;This&#160;function&#160;<br/>can&#160;be&#160;called&#160;using&#160;CallFblStart();.&#160;The&#160;function&#160;in&#160;bootloader&#160;context&#160;is started,&#160;a&#160;flag&#160;<br/>will&#160;be&#160;set&#160;in&#160;RAM&#160;and&#160;the&#160;bootloader&#160;issues&#160;a&#160;reset.&#160;After this reset,&#160;the&#160;flag&#160;is read&#160;<br/>by&#160;ApplFblExtProgRequest().&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>Caution&#160;<br/></b>CallFblStart()&#160;does not&#160;return&#160;to&#160;the&#160;application software.&#160;Please&#160;make&#160;sure all&#160;<br/>
<b>&#160;&#160;</b>necessary&#160;download tasks,&#160;e.g.&#160;shutting&#160;down the OS&#160;and&#160;running&#160;NVM&#160;tasks,&#160;are&#160;<br/>
finished&#160;before executing CallFblStart()&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>Caution&#160;<br/></b>Consider&#160;the&#160;usage&#160;of&#160;RAM&#160;pattern carefully.&#160;It&#160;can&#160;cause issues,&#160;e.g.&#160;as&#160;follows:&#160;<br/>
<b>&#160;</b><br/>
1.&#160;&#160;The&#160;bootloader&#160;cannot&#160;be started,&#160;because&#160;the&#160;RAM&#160;contents&#160;get&#160;lost&#160;after&#160;<br/>
reset&#160;(e.g.&#160;by&#160;a short&#160;loss&#160;of&#160;power&#160;on&#160;the&#160;micro&#160;or&#160;initialization through&#160;the&#160;<br/>startup&#160;code).&#160;<br/>
2.&#160;&#160;The&#160;bootloader&#160;is&#160;accidentally&#160;started&#160;after&#160;power-up,&#160;because&#160;the&#160;RAM&#160;<br/>
location&#160;contains&#160;by&#160;coincidence the&#160;specified&#160;pattern&#160;named&#160;above.&#160;&#160;<br/>
3.&#160;&#160;The&#160;RAM&#160;pattern&#160;will&#160;be&#160;allocated&#160;by&#160;the&#160;bootloader&#160;anywhere in&#160;RAM.&#160;This&#160;<br/>
may&#160;overlap with data inside&#160;the&#160;application.&#160;If&#160;you&#160;write into&#160;fblStartMagicFlag[]&#160;<br/>either&#160;by&#160;call&#160;of&#160;CallFblStart()&#160;or&#160;ApplSetStartMagicFlag(),&#160;you&#160;potentially&#160;<br/>overwrite your&#160;data&#160;with these.&#160;The&#160;ECU&#160;should be shutdown then&#160;immediately.&#160;<br/>This&#160;could otherwise cause unpredictable behavior&#160;of&#160;the&#160;ECU.&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>
If&#160;additional&#160;data&#160;should&#160;be&#160;transmitted&#160;with&#160;the&#160;FblStart&#160;function&#160;call,&#160;a&#160;parameter&#160;can&#160;be&#160;<br/>used&#160;to&#160;transmit&#160;this&#160;data.&#160;It&#160;is&#160;copied&#160;to&#160;a&#160;memory&#160;area&#160;which&#160;is&#160;placed&#160;together&#160;with&#160;the&#160;<br/>magic&#160;flag.&#160;<br/>
&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
67&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=68></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-68_1.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-68_2.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>Caution&#160;<br/></b>Vector&#160;SLP3&#160;bootloaders&#160;do&#160;not&#160;support&#160;a FblStart()&#160;parameter&#160;by&#160;default.&#160;A&#160;parameter&#160;<br/>
<b>&#160;&#160;</b>can&#160;be&#160;added&#160;using&#160;the&#160;switch FBL_MAIN_ENABLE_FBLSTART_PARAM,&#160;but&#160;the&#160;<br/>
respective data&#160;structures&#160;have to&#160;be&#160;defined&#160;in user&#160;callback&#160;files.&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>To&#160;define&#160;a&#160;parameter&#160;for the&#160;FblStart() function,&#160;the&#160;following&#160;settings have&#160;to&#160;be&#160;made:&#160;<br/><b>&#160;&#160;</b>FBL_MAIN_ENABLE_FBLSTART_PARAM&#160;has to&#160;be&#160;set.&#160;<br/>
<b>&#160;&#160;</b>The&#160;parameter&#160;type&#160;tFblStartParamter has to&#160;be&#160;defined.&#160;<br/>
<b>&#160;&#160;</b>A&#160;pointer to&#160;this parameter (as void&#160;pointer)&#160;and&#160;the&#160;size&#160;of&#160;the&#160;parameter have&#160;to&#160;be&#160;<br/>
added&#160;to&#160;the&#160;FblStart() function&#160;call.&#160;<br/>
&#160;<br/>
<b>8.5.2&#160;</b><br/>
<b>ECU&#160;Reset and Default Session Request&#160;</b><br/>
If&#160;an&#160;ECU&#160;Reset&#160;request&#160;or&#160;a&#160;Default&#160;Session&#160;Request&#160;is&#160;received&#160;by&#160;the&#160;bootloader,&#160;there&#160;<br/>are two&#160;possibilities to&#160;handle&#160;the&#160;response:&#160;<br/><b>&#160;&#160;</b>The&#160;response&#160;is sent&#160;by&#160;the&#160;bootloader&#160;and&#160;the&#160;reset&#160;is issued&#160;after the&#160;response&#160;was&#160;<br/>
sent.&#160;This is&#160;the&#160;easier variant,&#160;but&#160;the&#160;tester&#160;has to&#160;take&#160;into&#160;account&#160;that&#160;the&#160;reset&#160;<br/>takes some&#160;time.&#160;<br/>
<b>&#160;&#160;</b>The&#160;bootloader&#160;sends&#160;a&#160;Response&#160;Pending&#160;message,&#160;sets&#160;a&#160;flag&#160;and&#160;issues a&#160;reset.&#160;<br/>
The&#160;application&#160;software has to&#160;read&#160;this&#160;flag&#160;and&#160;send&#160;the&#160;response.&#160;This&#160;feature is&#160;<br/>called&#160;“Response&#160;After&#160;Reset”. In&#160;this case,&#160;the&#160;next&#160;request&#160;can&#160;be&#160;sent&#160;immediately,&#160;<br/>but&#160;the&#160;flag&#160;has&#160;to&#160;be&#160;handed&#160;over via&#160;RAM or non-volatile&#160;memory.&#160;<br/>
&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
68&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=69></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-69_1.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-69_2.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-69_3.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-69_4.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>9&#160;&#160;Memory&#160;Drivers&#160;</b><br/>
<b>9.1&#160;</b><br/>
<b>Flash Driver&#160;</b><br/>
The&#160;flash&#160;driver&#160;uses&#160;the&#160;HIS&#160;interface&#160;as&#160;described&#160;<a href="TechnicalReference_FBL_Vector_SLP3s.html#3">in&#160;[3].&#160;</a>The&#160;flash&#160;driver&#160;is&#160;downloaded&#160;<br/>to&#160;the&#160;ECU.&#160;It&#160;is copied&#160;and&#160;executed&#160;into&#160;RAM&#160;during&#160;runtime.&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>Note&#160;<br/></b>There is usually&#160;no&#160;need&#160;to&#160;compile,&#160;link,&#160;or&#160;modify&#160;the&#160;flash&#160;driver&#160;in any&#160;way.&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>Relocatable&#160;flash&#160;drivers should&#160;always be&#160;located&#160;at&#160;address&#160;0x00000000.&#160;<br/>Additional&#160;flash&#160;drivers can&#160;be&#160;added&#160;to&#160;the&#160;bootloader&#160;configuration&#160;by&#160;yourself.&#160;<br/>
<b>9.2&#160;</b><br/>
<b>Non-volatile&#160;Memory&#160;Driver&#160;</b><br/>
The&#160;&#160;bootloader&#160;&#160;needs&#160;&#160;to&#160;&#160;use&#160;&#160;a&#160;&#160;non-volatile&#160;&#160;memory&#160;&#160;driver&#160;&#160;like&#160;&#160;an&#160;&#160;EEPROM&#160;&#160;driver&#160;&#160;or&#160;<br/>EEPROM&#160;emulation&#160;to&#160;store&#160;bootloader&#160;process&#160;data.&#160;The&#160;standard&#160;&#160;bootloader&#160;does&#160;not&#160;<br/>include&#160;such&#160;a&#160;driver.&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>Caution&#160;<br/></b>The&#160;dummy&#160;EEPROM&#160;driver&#160;included&#160;in every&#160;bootloader&#160;delivery&#160;must&#160;not&#160;be&#160;used&#160;for&#160;<br/>
<b>&#160;&#160;</b>production ECUs&#160;because it&#160;does&#160;not&#160;store&#160;data&#160;reset&#160;safe.&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>Non-volatile&#160;&#160;memory&#160;&#160;accesses&#160;&#160;can&#160;&#160;be&#160;&#160;configured&#160;&#160;by&#160;&#160;NV-Wrapper&#160;&#160;(see&#160;&#160;<a href="TechnicalReference_FBL_Vector_SLP3s.html#3">[8])&#160;&#160;</a>and&#160;&#160;are&#160;<br/>encapsulated&#160;in&#160;fbl_apnv.c/h.&#160;<br/>Either&#160;module&#160;based&#160;EEPROM&#160;emulations&#160;or&#160;HIS&#160;interface&#160;(see<a href="TechnicalReference_FBL_Vector_SLP3s.html#3">&#160;[3])</a>&#160;EEPROM&#160;drivers&#160;can&#160;<br/>be&#160;used.&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>Note&#160;<br/></b>If&#160;you&#160;don’t&#160;want&#160;to&#160;use&#160;your&#160;own driver,&#160;various EEPROM&#160;drivers&#160;or&#160;EEPROM&#160;<br/>
&#160;&#160;emulations can&#160;be&#160;ordered&#160;with the&#160;bootloader.&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>&#160;<br/>
<b>&#160;</b><br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
69&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=70></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-70_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>9.3&#160;</b><br/>
<b>Memory&#160;driver requirements&#160;</b><br/>
Additional&#160;&#160;memory&#160;&#160;drivers&#160;&#160;have&#160;&#160;to&#160;&#160;fulfill&#160;&#160;a&#160;&#160;few&#160;&#160;requirements&#160;&#160;to&#160;&#160;fit&#160;&#160;into&#160;&#160;the&#160;&#160;bootloader&#160;<br/>environment.&#160;These&#160;requirements&#160;are&#160;valid&#160;to&#160;flash&#160;driver,&#160;EEPROM&#160;drivers&#160;and&#160;EEPROM&#160;<br/>emulations.&#160;<br/><b>&#160;&#160;</b>The&#160;drivers have&#160;to&#160;provide&#160;a&#160;synchronous interface.&#160;<br/>
<b>&#160;&#160;</b>Drivers mustn’t&#160;use&#160;interrupts.&#160;<br/>
<b>&#160;&#160;</b>The&#160;drivers have&#160;to&#160;call&#160;FblLookForWatchdog()&#160;at&#160;least&#160;once&#160;a&#160;millisecond.&#160;It&#160;is&#160;<br/>
required&#160;to&#160;call&#160;it&#160;more&#160;often.&#160;<br/>
A&#160;detailed&#160;description&#160;of&#160;memory&#160;driver&#160;requirements&#160;can&#160;be&#160;found&#160;<a href="TechnicalReference_FBL_Vector_SLP3s.html#3">in&#160;[11]&#160;AN-ISC-8-1188&#160;<br/>–&#160;Custom&#160;Flash&#160;Drivers.</a>&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
70&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=71></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-71_1.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-71_2.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-71_3.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>10&#160;&#160;Miscellaneous&#160;</b><br/>
<b>10.1&#160;&#160;&#160;[#oem_valid]&#160;-&#160;Application validation&#160;</b><br/>
For&#160;more&#160;general&#160;information&#160;about&#160;this&#160;see&#160;the&#160;UserManual_FlashBootloader&#160;in&#160;the&#160;chapter&#160;&#160;<b>Proposals&#160;for&#160;<br/>Handling&#160;the Validation&#160;Area.&#160;<br/>&#160;<br/></b>The&#160;&#160;bootloader&#160;&#160;has&#160;&#160;to&#160;&#160;decide&#160;&#160;if&#160;&#160;a&#160;&#160;valid&#160;&#160;application&#160;&#160;software&#160;&#160;is&#160;&#160;present&#160;&#160;or&#160;&#160;not.&#160;&#160;If&#160;&#160;the&#160;<br/>application&#160;is valid,&#160;the&#160;bootloader&#160;will start the&#160;application&#160;on&#160;the&#160;ECU’s startup.&#160;<br/>There&#160;are&#160;several&#160;variants&#160;to&#160;handle&#160;the&#160;application&#160;validation.&#160;Please&#160;see<a href="TechnicalReference_FBL_Vector_SLP3s.html#3">&#160;&#160;[9]&#160;</a>for&#160;a&#160;short&#160;<br/>description&#160;of&#160;the&#160;available&#160;variants.&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>Note&#160;<br/></b>Vector&#160;SLP3&#160;bootloaders&#160;use&#160;the&#160;following&#160;validation&#160;strategy&#160;by&#160;default:&#160;<br/>
&#160;&#160;&#160;&#160;The&#160;application’s&#160;overall&#160;validity&#160;is&#160;established&#160;in service CheckProgrammingDependencies.&#160;<br/>
&#160;&#160;During startup, the result of&#160;this&#160;check&#160;is&#160;evaluated.&#160;<br/>&#160;&#160;Either&#160;non-volatile memory&#160;or presence&#160;patterns&#160;can&#160;be used&#160;to&#160;store&#160;the&#160;validity&#160;<br/>
information.&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>Vector&#160;&#160;SLP3&#160;&#160;bootloaders&#160;&#160;use&#160;&#160;the&#160;&#160;functions&#160;&#160;ApplFblIsValidApp(),&#160;&#160;ApplFblValidateApp(),&#160;<br/>ApplFblInvalidateApp(),&#160;ApplFblInvalidateBlock()&#160;and&#160;ApplFblValidateBlock()&#160;to&#160;control&#160;the&#160;<br/>application&#160;valid&#160;status.&#160;An&#160;application&#160;wide&#160;compatibility&#160;check&#160;should&#160;be&#160;implemented&#160;in&#160;<br/>ApplFblCheckProgDependencies().&#160;<br/>A&#160;second&#160;validation&#160;strategy&#160;without&#160;application&#160;wide&#160;validation&#160;flag&#160;can&#160;be&#160;selected&#160;in&#160;a&#160;<br/>user configuration&#160;file&#160;in&#160;GENy&#160;(deactivation&#160;of&#160;“Application&#160;Validity&#160;Flag”):&#160;<br/>This&#160;&#160;configuration&#160;&#160;switch&#160;&#160;deactivates&#160;&#160;the&#160;&#160;application&#160;&#160;wide&#160;&#160;validation&#160;&#160;flag&#160;&#160;and&#160;&#160;uses&#160;&#160;the&#160;<br/>logical&#160;&#160;block&#160;&#160;validity&#160;&#160;flags&#160;&#160;combined&#160;&#160;with&#160;&#160;a&#160;&#160;compatibility&#160;&#160;check&#160;&#160;during&#160;&#160;the&#160;&#160;bootloader&#160;<br/>startup&#160;phase&#160;to&#160;establish&#160;the&#160;application&#160;validity.&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>Caution&#160;<br/></b>Please note&#160;that&#160;using&#160;memory&#160;with ECC&#160;functionality&#160;may&#160;be&#160;critical&#160;to determine&#160;the&#160;<br/>
<b>&#160;&#160;</b>application validity.&#160;If&#160;such a&#160;memory&#160;is&#160;used,&#160;the&#160;read&#160;function&#160;has&#160;to be&#160;able to&#160;<br/>
handle errors.&#160;<br/>Otherwise,&#160;the&#160;application and&#160;bootloader&#160;may&#160;get&#160;stuck&#160;in an&#160;endless&#160;reset&#160;loop&#160;<br/>because ECC&#160;errors&#160;trigger&#160;a&#160;reset&#160;or&#160;exception&#160;on&#160;every&#160;startup.&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
71&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=72></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-72_1.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-72_2.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>10.1.1&#160;&#160;Presence&#160;Patterns&#160;<br/></b>Instead&#160;&#160;of&#160;&#160;using&#160;&#160;flags&#160;&#160;in&#160;&#160;EEPROM,&#160;&#160;the&#160;&#160;validation&#160;&#160;status&#160;&#160;can&#160;&#160;be&#160;&#160;written&#160;&#160;into&#160;&#160;the&#160;&#160;flash&#160;<br/>memory&#160;of&#160;the&#160;respective&#160;logical block.&#160;Due&#160;to&#160;the&#160;fact&#160;that&#160;you&#160;cannot&#160;program&#160;a&#160;flash&#160;cell&#160;<br/>twice,&#160;two&#160;segments&#160;are&#160;used&#160;to&#160;mark&#160;the&#160;logical&#160;block&#160;as&#160;valid&#160;or&#160;invalid.&#160;The&#160;handling&#160;of&#160;<br/>presence&#160;patterns&#160;is optional and&#160;can&#160;be&#160;activated&#160;in&#160;GENy.&#160;<br/>The&#160;&#160;validation&#160;&#160;and&#160;&#160;invalidation&#160;&#160;is&#160;&#160;handled&#160;&#160;with&#160;&#160;two&#160;&#160;patterns&#160;&#160;at&#160;&#160;the&#160;&#160;end&#160;&#160;of&#160;&#160;each&#160;&#160;logical&#160;<br/>block:&#160;the&#160;mask&#160;value&#160;and&#160;the&#160;presence&#160;pattern.&#160;The&#160;mask&#160;and&#160;the&#160;pattern&#160;have&#160;a&#160;size&#160;of&#160;<br/>at&#160;least&#160;two&#160;bytes.&#160;The&#160;location&#160;of&#160;these&#160;values&#160;is&#160;reserved&#160;in&#160;the&#160;logical&#160;block&#160;to&#160;avoid&#160;that&#160;<br/>the&#160;application&#160;overwrites these&#160;locations.&#160;<br/>The&#160;&#160;reason&#160;&#160;for&#160;&#160;having&#160;&#160;two&#160;&#160;values,&#160;&#160;the&#160;&#160;pattern&#160;&#160;and&#160;&#160;the&#160;&#160;mask,&#160;&#160;is&#160;&#160;because&#160;&#160;most&#160;&#160;flash&#160;<br/>manufacturers&#160;do&#160;not&#160;allow&#160;writing&#160;to&#160;a&#160;flash&#160;cell&#160;two&#160;times&#160;without&#160;a&#160;preceding&#160;erase.&#160;The&#160;<br/>validation/invalidation&#160;concept&#160;is&#160;based&#160;on&#160;a&#160;conjunction&#160;of&#160;the&#160;erased-status&#160;of&#160;the&#160;mask&#160;<br/>and&#160;the&#160;presence&#160;pattern value.&#160;<br/>
Presence&#160;Pattern&#160;Value<br/>
Presence&#160;Pattern&#160;Mask<br/>
&#160;<br/>
Figure&#160;10-1&#160;&#160;Presence&#160;Pattern&#160;<br/>
<b>Invalidate</b>:&#160;&#160;The&#160;mask&#160;value&#160;is&#160;written&#160;to&#160;its&#160;inverse&#160;of&#160;the&#160;erased&#160;state&#160;(the&#160;erased&#160;state&#160;<br/>
is&#160;&#160;stored&#160;&#160;in&#160;&#160;the&#160;&#160;LogicalBlockTable).&#160;&#160;This&#160;&#160;makes&#160;&#160;the&#160;&#160;logical&#160;&#160;block&#160;&#160;invalid&#160;<br/>without&#160;re-writing&#160;to&#160;the&#160;presence&#160;pattern location.&#160;<br/>
<b>Validate</b>:&#160;<br/>
The&#160;presence&#160;pattern&#160;is&#160;written&#160;to&#160;its&#160;location.&#160;Since&#160;both,&#160;the&#160;Pattern&#160;values&#160;<br/>and&#160;mask&#160;has&#160;been&#160;erased,&#160;it&#160;is&#160;possible&#160;to&#160;re-write&#160;and&#160;the&#160;mask&#160;contains&#160;<br/>the&#160;required&#160;erased&#160;state.&#160;<br/>
<b>IsValid</b>:&#160;&#160;The&#160;logical&#160;block&#160;is&#160;treaded&#160;as&#160;present,&#160;if&#160;the&#160;presence&#160;pattern&#160;has&#160;been&#160;written&#160;<br/>
and&#160;the&#160;mask value&#160;contains&#160;its&#160;erased&#160;state.&#160;&#160;<br/>
&#160;<br/>
The&#160;&#160;erasure&#160;&#160;will&#160;&#160;happen&#160;&#160;between&#160;&#160;the&#160;&#160;call&#160;&#160;to&#160;&#160;ApplFblInvalidateBlock()&#160;&#160;and&#160;<br/>ApplFblValidateBlock().&#160;This ensures&#160;that&#160;the&#160;mask&#160;and&#160;value&#160;have&#160;been&#160;erased&#160;before.&#160;<br/>The&#160;&#160;whole&#160;&#160;procedure&#160;&#160;guarantees&#160;&#160;that&#160;&#160;in&#160;&#160;any&#160;&#160;case&#160;&#160;the&#160;&#160;logical&#160;&#160;block&#160;&#160;is&#160;&#160;valid&#160;&#160;or&#160;&#160;not&#160;<br/>depending&#160;on&#160;the&#160;actual&#160;state.&#160;Even&#160;if&#160;the&#160;erasure&#160;occurs&#160;from&#160;top&#160;to&#160;bottom&#160;or&#160;vice&#160;versa&#160;<br/>or the&#160;erasure&#160;is interrupted,&#160;the&#160;logical block&#160;is invalid.&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>Note&#160;<br/></b>Presence&#160;patterns&#160;either&#160;are&#160;used&#160;to&#160;store&#160;the&#160;application&#160;overall&#160;validity&#160;(if&#160;an&#160;<br/>
&#160;&#160;application valid flag&#160;is&#160;used)&#160;or&#160;the&#160;logical&#160;block&#160;validity.&#160;<br/>
If&#160;the&#160;application valid flag is used,&#160;the&#160;block&#160;validity&#160;information is&#160;stored&#160;in&#160;non-volatile&#160;<br/>memory.&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
72&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=73></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-73_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>10.1.1.1&#160;&#160;Storage&#160;of application valid flag&#160;<br/></b>The&#160;application&#160;valid&#160;flag&#160;is&#160;shared&#160;over&#160;all&#160;logical&#160;blocks.&#160;To&#160;provide&#160;flexibility&#160;regarding&#160;<br/>the&#160;sequence&#160;of&#160;logical&#160;blocks,&#160;the&#160;presence&#160;patterns&#160;are&#160;stored&#160;according&#160;to&#160;the&#160;following&#160;<br/>rules:&#160;<br/>
1.&#160;&#160;Every&#160;logical block&#160;contains&#160;one&#160;application&#160;validity&#160;pattern.&#160;One&#160;valid&#160;application&#160;<br/>
pattern will be&#160;interpreted&#160;as&#160;application&#160;valid&#160;pattern even&#160;if&#160;all&#160;other&#160;patterns&#160;are&#160;<br/>undefined&#160;or invalidated.&#160;<br/>
2.&#160;&#160;If&#160;one&#160;logical block&#160;is&#160;erased,&#160;the&#160;application&#160;validity&#160;patterns&#160;in&#160;all&#160;logical blocks&#160;are&#160;<br/>
invalidated.&#160;<br/>
3.&#160;&#160;After a&#160;successful compatibility&#160;check,&#160;the&#160;presence&#160;pattern in&#160;the&#160;last&#160;logical block&#160;<br/>
which&#160;has been&#160;flashed&#160;is validated.&#160;This ensures&#160;that&#160;only&#160;one&#160;block contains&#160;the&#160;<br/>application&#160;valid&#160;flag&#160;<br/>
4.&#160;&#160;&#160;During&#160;startup,&#160;all&#160;logical blocks&#160;are&#160;checked&#160;for an&#160;application&#160;valid&#160;flag.&#160;If&#160;the&#160;<br/>
application&#160;valid&#160;flag&#160;is found,&#160;the&#160;application&#160;is started&#160;by&#160;the&#160;bootloader.&#160;<br/>
<a href="TechnicalReference_FBL_Vector_SLP3s.html#73">Figure&#160;&#160;10-2&#160;&#160;</a>-&#160;&#160;<a href="TechnicalReference_FBL_Vector_SLP3s.html#73">Presence&#160;&#160;Pattern&#160;&#160;Examples&#160;&#160;</a>demonstrates&#160;&#160;four&#160;&#160;states&#160;&#160;of&#160;&#160;an&#160;&#160;ECU&#160;&#160;using&#160;<br/>presence&#160;patterns&#160;to&#160;store the&#160;application&#160;valid&#160;flag.&#160;<br/>
Logical&#160;block&#160;#1<br/>
Logical&#160;block&#160;#1<br/>
Logical&#160;block&#160;#1<br/>
Logical&#160;block&#160;#1<br/>
erased<br/>
valid<br/>
partly&#160;erased<br/>
valid<br/>
PP&#160;erased<br/>
PP&#160;erased<br/>
PP&#160;invalid<br/>
PP&#160;valid<br/>
Logical&#160;block&#160;#2<br/>
Logical&#160;block&#160;#2<br/>
Logical&#160;block&#160;#2<br/>
Logical&#160;block&#160;#2<br/>
erased<br/>
valid<br/>
valid<br/>
valid<br/>
PP&#160;erased<br/>
PP&#160;valid<br/>
PP&#160;invalid<br/>
PP&#160;invalid<br/>
State&#160;1<br/>
State 2<br/>
State&#160;3<br/>
State 4&#160;&#160;<br/>
Figure&#160;10-2&#160;&#160;Presence&#160;Pattern&#160;Examples&#160;<br/>
&#160;<br/>
&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
73&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=74></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-74_1.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-74_2.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-74_3.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>&#160;&#160;</b>State&#160;1:&#160;ECU&#160;completely&#160;erased.&#160;Both&#160;presence&#160;patterns&#160;are recognized&#160;as invalid&#160;<br/>
and&#160;the&#160;application&#160;is not&#160;started.&#160;<br/>
<b>&#160;&#160;</b>State&#160;2:&#160;Logical block&#160;#1&#160;and&#160;logical block #2&#160;have&#160;been&#160;flashed&#160;successfully.&#160;Both&#160;<br/>
blocks&#160;are compatible&#160;and&#160;the&#160;presence&#160;pattern is&#160;placed&#160;at&#160;the&#160;end&#160;of&#160;the&#160;logical&#160;<br/>block&#160;which&#160;has&#160;been&#160;flashed&#160;at&#160;last.&#160;<br/>
<b>&#160;&#160;</b>State&#160;3:&#160;Logical block&#160;#1&#160;shall&#160;be&#160;re-programmed,&#160;but&#160;erasing&#160;the&#160;first&#160;logical block&#160;<br/>
failed.&#160;Both&#160;patterns&#160;have&#160;been&#160;invalidated&#160;before&#160;erasing&#160;block&#160;#1,&#160;then&#160;erasing&#160;of&#160;<br/>block&#160;#1&#160;started&#160;and&#160;a&#160;reset&#160;occurred.&#160;After this reset,&#160;the&#160;application&#160;is not&#160;started.&#160;<br/>
<b>&#160;&#160;</b>State&#160;4:&#160;Logical block&#160;#1&#160;has been&#160;re-programmed&#160;and&#160;the&#160;compatibility&#160;check&#160;<br/>
succeeded.&#160;The&#160;presence&#160;pattern is&#160;placed&#160;into&#160;block&#160;#1,&#160;the&#160;application&#160;is started&#160;<br/>after reset.&#160;<br/>
&#160;<br/>
<b>10.1.2&#160;&#160;[#oem_time]&#160;-&#160;Validation OK&#160;–&#160;Application faulty&#160;</b><br/>
For&#160;more&#160;general&#160;information&#160;about&#160;this&#160;see&#160;the&#160;UserManual_FlashBootloader&#160;in&#160;the&#160;chapter&#160;&#160;<b>Validation&#160;OK&#160;<br/>–&#160;Application&#160;faulty.&#160;<br/>&#160;</b><br/>
<b>10.1.3&#160;&#160;Force&#160;Boot&#160;Mode&#160;<br/></b>This&#160;bootloader&#160;supports&#160;the&#160;“Force&#160;Boot&#160;Mode”&#160;feature.&#160;If&#160;enabled,&#160;the&#160;bootloader&#160;can&#160;be&#160;<br/>prevented&#160;from&#160;starting&#160;the&#160;application&#160;if&#160;a&#160;special message&#160;is sent&#160;to&#160;the&#160;bootloader&#160;within&#160;<br/>a&#160;specified&#160;time.&#160;<br/>The&#160;default&#160;wait&#160;time&#160;is&#160;configured&#160;to&#160;20ms,&#160;but&#160;can&#160;be&#160;changed&#160;by&#160;a&#160;user&#160;configuration&#160;<br/>file:&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>Example&#160;<br/></b>/*&#160;Wait&#160;30&#160;ms&#160;before&#160;jump&#160;into&#160;application&#160;*/&#160;<br/>
&#160;&#160;#define&#160;kFblStartMessageDelay&#160;30u&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>Please&#160;note&#160;that&#160;the&#160;time&#160;slot&#160;has&#160;to&#160;be&#160;big&#160;enough&#160;to&#160;receive&#160;at&#160;least&#160;one&#160;message.&#160;The&#160;<br/>allowed&#160;range&#160;is&#160;from&#160;0&#160;to&#160;255,&#160;but&#160;values&#160;smaller&#160;than&#160;5ms&#160;may&#160;be&#160;hard&#160;to&#160;hit&#160;by&#160;a&#160;start&#160;<br/>message&#160;sent&#160;by&#160;the&#160;tester.&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>Caution&#160;<br/></b>The&#160;“Force Boot&#160;Mode”&#160;feature&#160;should be&#160;used as&#160;a development&#160;feature&#160;because it&#160;<br/>
<b>&#160;&#160;</b>increases&#160;the&#160;startup&#160;time of&#160;the&#160;ECU&#160;and allows&#160;a transition&#160;to programming&#160;session&#160;<br/>
without&#160;using&#160;a&#160;preprogramming&#160;sequence.&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>&#160;<br/>
&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
74&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=75></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-75_1.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-75_2.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-75_3.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-75_4.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>10.2&#160;&#160;[#oem_sec]&#160;Seed /&#160;Key&#160;Mechanism&#160;</b><br/>
The&#160;Seed/Key&#160;mechanism&#160;is&#160;implemented&#160;in&#160;user&#160;callback&#160;files.&#160;The&#160;diagnostic&#160;layer&#160;uses&#160;<br/>the&#160;functions&#160;ApplFblSecuritySeed()&#160;and&#160;ApplFblSecurityKey()&#160;to&#160;create&#160;seed&#160;values&#160;and&#160;<br/>verify&#160;<br/>
the&#160;<br/>
keys.&#160;<br/>
The&#160;<br/>
actual&#160;<br/>
calculation&#160;<br/>
is&#160;<br/>
done&#160;<br/>
in&#160;<br/>
the&#160;<br/>
module&#160;<br/>
Sec_SeedKeyVendor.c/Sec_SeedKey_Cfg.h&#160;&#160;which&#160;&#160;can&#160;&#160;be&#160;&#160;seen&#160;&#160;as&#160;&#160;a&#160;&#160;template&#160;&#160;for&#160;&#160;a&#160;<br/>Seed/Key&#160;module.&#160;Length&#160;of&#160;Seed&#160;and&#160;Key&#160;and&#160;the&#160;used&#160;algorithm&#160;can&#160;be&#160;configured&#160;in&#160;<br/>there.&#160;<br/>The&#160;ApplFblSecuritySeed()&#160;function&#160;is&#160;called&#160;to&#160;obtain&#160;a&#160;(pseudo)&#160;random&#160;value&#160;to&#160;be&#160;sent&#160;<br/>to&#160;&#160;the&#160;&#160;tester.&#160;&#160;The&#160;&#160;function&#160;&#160;is&#160;&#160;called&#160;&#160;when&#160;&#160;a&#160;&#160;security&#160;&#160;access&#160;&#160;service&#160;&#160;request&#160;&#160;is&#160;&#160;received&#160;<br/>containing&#160;a&#160;request&#160;seed&#160;sub-function.&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>Caution&#160;<br/></b>The&#160;request&#160;seed&#160;service should return&#160;a&#160;random&#160;value.&#160;Please check&#160;if&#160;your&#160;ECU&#160;is&#160;<br/>
<b>&#160;&#160;</b>set&#160;up&#160;correctly&#160;so that&#160;a&#160;random&#160;value&#160;is&#160;returned.&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>Caution&#160;<br/></b>There is no&#160;safe&#160;key&#160;calculation algorithm&#160;included&#160;in this&#160;bootloader&#160;by&#160;default.&#160;Please&#160;<br/>
<b>&#160;&#160;</b>use&#160;the&#160;specified&#160;callbacks&#160;to&#160;implement&#160;your&#160;own,&#160;safe algorithm.&#160;<br/>
The&#160;example implementation is based&#160;on&#160;a&#160;simple XOR&#160;operation&#160;with the&#160;key&#160;<br/>constant&#160;configured&#160;in&#160;GENy.&#160;<br/>Please note&#160;that&#160;the example DLL&#160;delivered&#160;with the&#160;bootloader&#160;implements&#160;a&#160;non-<br/>configurable constant&#160;of&#160;0xFFFFFFFF.&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>The&#160;&#160;following&#160;&#160;settings&#160;&#160;can&#160;&#160;be&#160;&#160;done&#160;&#160;in&#160;&#160;the&#160;&#160;security&#160;&#160;access&#160;&#160;template.&#160;&#160;The&#160;&#160;settings&#160;&#160;are&#160;<br/>documented&#160;in&#160;detail&#160;by&#160;comments&#160;in&#160;the&#160;template&#160;files.&#160;<br/><b>&#160;&#160;</b>Size&#160;of&#160;seed&#160;and&#160;key:&#160;SEC_SEED_LENGTH,&#160;SEC_KEY_LENGTH&#160;<br/>
<b>&#160;&#160;</b>Format&#160;of&#160;seed&#160;and&#160;key&#160;(Byte&#160;arrays or&#160;word arrays).&#160;<br/>
<b>&#160;&#160;</b>Security&#160;access algorithm&#160;implementation:&#160;SecM_ComputeKeyVendor()&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>Note&#160;<br/></b>The&#160;Seed/Key&#160;calculation DLL&#160;used by&#160;vFlash&#160;has&#160;to&#160;be&#160;adapted&#160;as&#160;well&#160;if&#160;the&#160;<br/>
&#160;&#160;Seed/Key&#160;algorithm&#160;is&#160;changed.&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
75&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=76></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-76_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>10.3&#160;&#160;[#oem_seccomp]&#160;-&#160;Security&#160;module&#160;</b><br/>
The&#160;security&#160;module&#160;configuration&#160;is&#160;described&#160;in&#160;a&#160;separate&#160;document&#160;–&#160;see<a href="TechnicalReference_FBL_Vector_SLP3s.html#3">&#160;[10]&#160;</a>for&#160;more&#160;<br/>information.&#160;<br/>
<b>10.4&#160;&#160;Data&#160;Proc</b>e<b>ssing&#160;Support&#160;</b><br/>
In&#160;&#160;order&#160;&#160;to&#160;&#160;support&#160;&#160;encrypted&#160;&#160;and/or&#160;&#160;compressed&#160;&#160;files,&#160;&#160;the&#160;&#160;FBL&#160;&#160;provides&#160;&#160;three&#160;&#160;interface&#160;<br/>functions that&#160;process&#160;the&#160;received&#160;data&#160;before&#160;programming.&#160;<br/>ApplFblInitDataProcessing&#160;is&#160;called&#160;to&#160;initialize&#160;the&#160;data&#160;processing&#160;functionality&#160;with&#160;each&#160;<br/>RequestDownload&#160;service&#160;request.&#160;<br/>ApplFblDataProcessing&#160;is&#160;called&#160;to&#160;perform&#160;data&#160;processing&#160;for&#160;data&#160;that&#160;is&#160;received&#160;with&#160;<br/>each&#160;TransferData&#160;service&#160;request.&#160;<br/>ApplFblDeinitDataProcessing&#160;&#160;is&#160;&#160;called&#160;&#160;to&#160;&#160;conclude&#160;&#160;the&#160;&#160;data&#160;&#160;processing&#160;&#160;when&#160;&#160;a&#160;<br/>RequestTransferExit service&#160;request&#160;is received.&#160;<br/>The&#160;order&#160;of&#160;data&#160;processing&#160;operations&#160;must&#160;be&#160;considered&#160;when&#160;the&#160;download&#160;files&#160;are&#160;<br/>prepared.&#160;The&#160;standard&#160;sequence&#160;is&#160;depicted&#160;in&#160;the&#160;figure&#160;below.&#160;There&#160;may&#160;be&#160;deviations&#160;<br/>from&#160;this sequence&#160;for&#160;special use&#160;cases.&#160;<br/>In&#160;the&#160;first&#160;step,&#160;the&#160;signature&#160;or&#160;the&#160;CRC&#160;checksum&#160;is&#160;generated&#160;upon&#160;the&#160;raw&#160;download&#160;<br/>data&#160;in&#160;order&#160;to&#160;perform&#160;the&#160;counterpart&#160;operation&#160;on&#160;the&#160;ECU&#160;after&#160;the&#160;downloaded&#160;data&#160;<br/>have&#160;&#160;been&#160;&#160;programmed&#160;&#160;into&#160;&#160;NV-memory.&#160;&#160;If&#160;&#160;downloading&#160;&#160;of&#160;&#160;compressed&#160;&#160;data&#160;&#160;shall&#160;&#160;be&#160;<br/>supported,&#160;the&#160;compressed&#160;download&#160;file&#160;is&#160;computed&#160;next.&#160;The&#160;compression&#160;step&#160;should&#160;<br/>be&#160;performed&#160;before&#160;a&#160;potential encryption&#160;of&#160;the&#160;download&#160;data&#160;because&#160;the&#160;compression&#160;<br/>algorithm&#160;normally&#160;does&#160;not&#160;have&#160;much&#160;effect&#160;on&#160;encrypted&#160;data.&#160;Therefore,&#160;the&#160;last&#160;step&#160;<br/>is the&#160;encryption.&#160;During&#160;download,&#160;the&#160;reverse&#160;operations are&#160;performed&#160;on&#160;the&#160;ECU.&#160;<br/>
&#160;<br/>
<b>Tester</b><br/>
<b>ECU</b><br/>
<b>EC</b><br/>
Sta<br/>
St&#160;rt<br/>
<b>Sta</b><br/>
<b>St&#160;rt&#160;with&#160;raw&#160;dow</b><br/>
<b>do&#160;nloa</b><br/>
<b>nlo&#160;d&#160;</b><br/>
<b>dat</b><br/>
<b>da&#160;a</b><br/>
Sign<br/>
Sig&#160;ature&#160;/&#160;CRC&#160;verification<br/>
Generate&#160;Sign<br/>
Sig&#160;ature&#160;/&#160;CRC<br/>
on&#160;programmed&#160;data<br/>
Generate&#160;compressed&#160;file<br/>
Decopression<br/>
for&#160;download<br/>
<b>Downlo</b><br/>
<b>ow</b><br/>
<b>a</b><br/>
<b>nlo&#160;d</b><br/>
Enc<br/>
En&#160;rypt&#160;compressed&#160;file<br/>
Decrypt&#160;download&#160;data<br/>
&#160;<br/>
Figure&#160;10-3&#160;&#160;Data&#160;processing&#160;sequence&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
76&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=77></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-77_1.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-77_2.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>10.4.1&#160;&#160;tProcParam&#160;<br/></b>The&#160;data&#160;processing&#160;&#160;interface&#160;uses&#160;the&#160;tProcParam&#160;data&#160;structure&#160;in&#160;order&#160;to&#160;handle&#160;the&#160;<br/>input&#160;and&#160;output&#160;parameters.&#160;<br/>
<b>tProcParam&#160;</b><br/>
Element&#160;<br/>
Type&#160;<br/>
Description&#160;<br/>
dataBuffer&#160;<br/>
vuint8*&#160;<br/>
Pointer&#160;to input data&#160;buffer&#160;<br/>
dataLength&#160;<br/>
vuint16&#160;<br/>
Size&#160;of&#160;input data&#160;<br/>
dataOutBuffer&#160;<br/>
vuint8*&#160;<br/>
Pointer&#160;to&#160;output data&#160;buffer&#160;<br/>
dataOutLength&#160;<br/>
vuint16&#160;<br/>
Size&#160;of&#160;output data&#160;<br/>
dataOutMaxLength&#160;&#160;vuint16&#160;<br/>
Size&#160;of&#160;output data&#160;buffer&#160;<br/>
wdTriggerFct&#160;<br/>
vuint8&#160;(*wdTriggerFct)(void)&#160;&#160;Pointer&#160;to&#160;watchdog service function&#160;<br/>
mode&#160;<br/>
vuint8&#160;<br/>
Data&#160;processing&#160;mode;&#160;equals&#160;the DFI&#160;which&#160;is&#160;passed&#160;<br/>with&#160;RequestDownload&#160;<br/>
Table&#160;10-1&#160;&#160;&#160;Type&#160;Definition&#160;-&#160;tProcParam&#160;<br/>
<b>10.5&#160;&#160;[#oem_multi]&#160;-&#160;Multiple&#160;ECU&#160;Support&#160;</b><br/>
This&#160;&#160;bootloader&#160;&#160;supports&#160;&#160;a&#160;&#160;so-called&#160;&#160;multiple&#160;&#160;ECU&#160;&#160;support.&#160;&#160;If&#160;&#160;this&#160;&#160;option&#160;&#160;is&#160;&#160;activated,&#160;<br/>several&#160;CAN&#160;identifiers&#160;are&#160;prepared&#160;to&#160;be&#160;used&#160;by&#160;the&#160;bootloader.&#160;During&#160;the&#160;bootloader&#160;<br/>startup,&#160;&#160;the&#160;function&#160;ApplFblCanParamInit()&#160;&#160;can&#160;&#160;be&#160;used&#160;&#160;to&#160;&#160;select&#160;&#160;the&#160;&#160;required&#160;&#160;identifier.&#160;<br/>This&#160;&#160;is&#160;&#160;useful&#160;&#160;for&#160;&#160;configuration&#160;&#160;which&#160;&#160;include&#160;&#160;several&#160;&#160;ECUs&#160;&#160;of&#160;&#160;the&#160;&#160;same&#160;&#160;kind,&#160;&#160;e.g.&#160;&#160;door&#160;<br/>control ECUs,&#160;in&#160;one&#160;vehicle.&#160;<br/>Multiple&#160;ECUs&#160;can&#160;be&#160;activated&#160;in&#160;GENy&#160;by&#160;selecting&#160;more&#160;than&#160;one&#160;node&#160;in&#160;the&#160;channel&#160;<br/>setup&#160;dialog:&#160;<br/>
&#160;<br/>
Figure&#160;10-4&#160;&#160;Multiple&#160;ECU&#160;setup&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
77&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=78></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-78_1.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-78_2.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-78_3.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-78_4.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
The&#160;&#160;GENy&#160;&#160;module&#160;&#160;FblWrapperCom_Can&#160;&#160;allows&#160;&#160;manual&#160;&#160;adaptions&#160;&#160;of&#160;&#160;the&#160;&#160;settings&#160;&#160;which&#160;<br/>are&#160;&#160;read&#160;&#160;from&#160;&#160;the&#160;&#160;network&#160;&#160;database.&#160;&#160;To&#160;&#160;keep&#160;&#160;these&#160;&#160;manual&#160;&#160;adaptions&#160;&#160;in&#160;&#160;case&#160;&#160;a&#160;&#160;new&#160;<br/>database&#160;is&#160;selected,&#160;the&#160;configuration&#160;has&#160;to&#160;be&#160;updated&#160;manually&#160;in&#160;a&#160;second&#160;step&#160;using&#160;<br/>the&#160;“Restore default” button&#160;in&#160;the&#160;GENy&#160;module&#160;FblWrapperCom_Can.&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>Caution&#160;<br/></b>Manually&#160;adapted&#160;configuration settings&#160;will&#160;be&#160;overwritten&#160;in&#160;case&#160;the&#160;communication&#160;<br/>
<b>&#160;&#160;</b>setup&#160;is&#160;reset.&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>&#160;<br/>
<b>10.6&#160;&#160;Configuration&#160;without NV-Memory&#160;driver&#160;</b><br/>
The&#160;&#160;Vector&#160;&#160;SLP3&#160;&#160;bootloader&#160;&#160;can&#160;&#160;be&#160;&#160;used&#160;&#160;without&#160;&#160;an&#160;&#160;additional&#160;&#160;NV-memory&#160;&#160;driver.&#160;&#160;This&#160;<br/>can&#160;&#160;be&#160;&#160;useful&#160;&#160;if&#160;&#160;there&#160;&#160;is&#160;&#160;no&#160;&#160;process&#160;&#160;data&#160;&#160;handling&#160;&#160;like&#160;&#160;fingerprint&#160;&#160;handling&#160;&#160;or&#160;<br/>reprogramming&#160;counters required&#160;for a&#160;specific use&#160;case.&#160;<br/>The&#160;following&#160;steps&#160;have&#160;to&#160;be&#160;executed&#160;if&#160;no&#160;NV-memory&#160;driver should&#160;be&#160;used:&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>Practical&#160;Procedure&#160;<br/></b>Configuration steps&#160;to&#160;remove NV-memory&#160;driver:&#160;<br/>
&#160;&#160;&#160;Use block based&#160;validation&#160;with compatibility&#160;check&#160;on&#160;startup&#160;–&#160;see&#160;chapter<a href="TechnicalReference_FBL_Vector_SLP3s.html#71">&#160;10.1.</a>&#160;<br/>
&#160;Remove any&#160;NV-memory&#160;drivers&#160;from&#160;your&#160;project&#160;and&#160;you&#160;project’s&#160;make&#160;file.&#160;<br/>&#160;Change process&#160;handling&#160;functions&#160;and&#160;macros&#160;to empty&#160;macros which return&#160;valid&#160;<br/>
results&#160;(kFblOk).&#160;<br/>
&#160;Use RAM&#160;for&#160;reset&#160;response&#160;flag&#160;and&#160;reprogramming&#160;request&#160;flag.&#160;<br/>&#160;If&#160;you&#160;keep&#160;the&#160;Dummy&#160;EEPROM&#160;driver&#160;used by&#160;the&#160;bootloader&#160;demonstration&#160;<br/>
project,&#160;process data&#160;may&#160;be&#160;available until&#160;a power-on&#160;reset&#160;occurs.&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>Caution&#160;<br/></b>Please note&#160;that&#160;there&#160;is&#160;no&#160;possibility&#160;to track&#160;testers,&#160;programming&#160;dates&#160;or&#160;a&#160;<br/>
<b>&#160;&#160;</b>reprogramming&#160;count&#160;if&#160;no NV-driver&#160;is&#160;used in&#160;your&#160;bootloader.&#160;<br/>
The&#160;security&#160;access&#160;delay&#160;information&#160;also won’t&#160;get&#160;tracked&#160;in a&#160;reset-safe way.&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
78&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=79></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-79_1.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-79_2.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-79_3.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>10.7&#160;&#160;Pipelined Programming&#160;and Pipelined Verification&#160;</b><br/>
Optionally,&#160;&#160;Vector&#160;&#160;SLP3&#160;&#160;bootloaders&#160;&#160;can&#160;&#160;use&#160;&#160;the&#160;&#160;“Pipelined&#160;&#160;Programming”&#160;&#160;and/or&#160;<br/>“Pipelined&#160;&#160;Verification”&#160;&#160;feature&#160;&#160;to&#160;&#160;speed&#160;&#160;up&#160;&#160;the&#160;&#160;programming&#160;&#160;process.&#160;&#160;If&#160;&#160;one&#160;&#160;of&#160;&#160;these&#160;<br/>features&#160;&#160;is&#160;&#160;enabled,&#160;&#160;some&#160;&#160;tasks&#160;&#160;are&#160;&#160;executed&#160;&#160;in&#160;&#160;parallel&#160;&#160;to&#160;&#160;speed&#160;&#160;up&#160;&#160;the&#160;&#160;download&#160;<br/>process:&#160;<br/><b>&#160;&#160;</b>Pipelined&#160;Verification:&#160;Written&#160;data&#160;is verified&#160;while&#160;additional&#160;data&#160;is&#160;received.&#160;<br/>
<b>&#160;&#160;</b>Pipelined&#160;Programming:&#160;Received&#160;data&#160;is processed&#160;and&#160;written&#160;to&#160;flash&#160;while&#160;data&#160;is&#160;<br/>
received.&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>Caution&#160;<br/></b>If&#160;Pipelined Programming is activated,&#160;errors&#160;message&#160;from&#160;the&#160;bootloader&#160;may&#160;be&#160;<br/>
<b>&#160;&#160;</b>delayed.&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;<br/>Note&#160;<br/></b>The&#160;possible speedup&#160;is&#160;hardware&#160;dependent.&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
79&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=80></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-80_1.png"/><br/>
<img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-80_2.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>11&#160;&#160;vFlash&#160;Configuration&#160;</b><br/>
The&#160;&#160;address&#160;&#160;based&#160;&#160;vFlash&#160;&#160;template&#160;&#160;delivered&#160;&#160;with&#160;&#160;the&#160;&#160;bootloader&#160;&#160;offers&#160;&#160;some&#160;<br/>configuration&#160;&#160;options&#160;&#160;to&#160;&#160;synchronize&#160;&#160;the&#160;&#160;download&#160;&#160;sequence&#160;&#160;between&#160;&#160;bootloader&#160;&#160;and&#160;<br/>vFlash:&#160;<br/>
&#160;<br/>
Figure&#160;11-1&#160;&#160;vFlash&#160;Configuration&#160;<br/>
<b>Configuration&#160;Option&#160;</b><br/>
<b>Description&#160;</b><br/>
Tester&#160;Serial&#160;Number&#160;<br/>
ASCII&#160;string&#160;which is appended to&#160;the&#160;current&#160;date (3&#160;Bytes BCD,&#160;<br/>YYMMDD)&#160;and sent&#160;in&#160;the write&#160;fingerprint&#160;request.&#160;The&#160;length&#160;of&#160;this&#160;<br/>request&#160;is&#160;(3&#160;+&#160;length&#160;of&#160;TesterSerialNumber)&#160;Bytes.&#160;<br/>Default&#160;value&#160;is&#160;6 Bytes.&#160;If&#160;the&#160;length&#160;should be&#160;changed&#160;in the&#160;<br/>bootloader,&#160;please add&#160;the&#160;following&#160;define&#160;to a&#160;user&#160;config&#160;file:&#160;<br/>#define&#160;kDiagRqlWriteDataByIdentifierFingerPrintParameter&#160;0x09u&#160;<br/>
Security&#160;level&#160;<br/>
Selects&#160;the&#160;security&#160;level&#160;used&#160;for&#160;Seed/Key.&#160;Default&#160;is&#160;level&#160;11.&#160;<br/>The&#160;configuration&#160;can&#160;be&#160;changed&#160;by&#160;a&#160;user&#160;configuration&#160;file:&#160;<br/>#define&#160;kDiagSubRequestSeed&#160;0x11u&#160;<br/>#define&#160;kDiagSubSendKey&#160;0x12u&#160;<br/>
Communication&#160;Control&#160;<br/>
Corresponds&#160;to&#160;the&#160;GENy&#160;setting&#160;“Communication Control&#160;Type”.&#160;<br/>
Type&#160;<br/>Send&#160;<br/>
Corresponds&#160;to&#160;the&#160;GENy&#160;setting&#160;“Control&#160;DTC&#160;Option Record”&#160;<br/>
DTCControlOptionRecord&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
80&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=81></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-81_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>Configuration&#160;Option&#160;</b><br/>
<b>Description&#160;</b><br/>
Send&#160;<br/>
Corresponds&#160;to&#160;the&#160;GENy&#160;setting&#160;“Check&#160;Programming&#160;Preconditions&#160;<br/>
CheckProgramming-&#160;<br/>
Service.&#160;<br/>
Dependencies&#160;<br/>
Table&#160;11-1&#160;&#160;&#160;vFlash&#160;Configuration&#160;<br/>
&#160;<br/>
&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
81&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=82></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-82_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>12&#160;&#160;Glossary&#160;and&#160;Abbreviations&#160;</b><br/>
<b>12.1&#160;&#160;Glossary&#160;</b><br/>
<b>Term&#160;</b><br/>
<b>Description&#160;</b><br/>
NV-Memory&#160;<br/>
Non-volatile memory&#160;which can&#160;be&#160;used&#160;to&#160;store&#160;small&#160;amounts&#160;of&#160;data&#160;<br/>during&#160;the&#160;bootloader’s&#160;runtime.&#160;<br/>
&#160;<br/>
&#160;<br/>
<b>12.2&#160;&#160;Abbreviations&#160;</b><br/>
<b>Abbreviation&#160;</b><br/>
<b>Description&#160;</b><br/>
ALFI&#160;<br/>
Address/Length&#160;Format&#160;Identifier&#160;<br/>
BCD&#160;<br/>
Binary&#160;Coded&#160;Digit&#160;<br/>
CAN&#160;<br/>
Controller&#160;Area&#160;Network&#160;<br/>
Cfg5&#160;<br/>
Vector&#160;DaVinci&#160;Configurator&#160;5&#160;<br/>
DID&#160;<br/>
Data&#160;Identifier&#160;<br/>
DFI&#160;<br/>
Data&#160;Format&#160;Identifier&#160;<br/>
FBL&#160;<br/>
Flash&#160;Bootloader&#160;<br/>
ECU&#160;<br/>
Electronic&#160;Control&#160;Unit&#160;<br/>
HIS&#160;<br/>
Herstellerinitiative Software&#160;<br/>
ISO&#160;<br/>
International&#160;Organization&#160;for&#160;Standardization&#160;<br/>
LIN&#160;<br/>
Local&#160;Interconnect&#160;Network&#160;<br/>
UDS&#160;<br/>
Unified&#160;Diagnostic&#160;Services&#160;<br/>
&#160;<br/>
&#160;<br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
82&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name=83></a><img src="website_Vector_Flashbootloader_RH850_Generic/content/en/docs/Doc/TechnicalReferences/TechnicalReference_FBL_Vector_SLP3-83_1.png"/><br/>
Technical&#160;Reference&#160;Flash&#160;Bootloader OEM&#160;<br/>
<b>13&#160;&#160;Contact&#160;</b><br/>
Visit&#160;our website&#160;for&#160;more information&#160;on&#160;<br/>
&#160;<br/>
<b>&gt;&#160;&#160;</b>News&#160;<br/>
<b>&gt;&#160;&#160;</b>Products&#160;<br/>
<b>&gt;&#160;&#160;</b>Demo&#160;software&#160;<br/>
<b>&gt;&#160;&#160;</b>Support&#160;<br/>
<b>&gt;&#160;&#160;</b>Training&#160;data&#160;<br/>
<b>&gt;&#160;&#160;</b>Addresses&#160;<br/>
&#160;<br/>
<b>www.vector.com&#160;</b><br/>
©&#160;2017&#160;Vector&#160;Informatik&#160;GmbH&#160;<br/>
Version&#160;3.1&#160;<br/>
83&#160;<br/>
based&#160;on&#160;template&#160;version&#160;5.1.0&#160;<br/>
<hr/>
<a name="outline"></a><h1>Document Outline</h1>
<ul>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#8">1 Introduction</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#9">2 Download concept</a>
<ul>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#9">2.1 Overview</a>
<ul>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#9">2.1.1 Pre-Programming Step</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#10">2.1.2 Programming Step</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#11">2.1.3 Post-Programming Step</a></li>
</ul>
</li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#12">2.2 Detailed Description of Diagnostic Services</a>
<ul>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#12">2.2.1 Diagnostic Session Control</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#12">2.2.2 ECU Reset</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#13">2.2.3 Read Data By Identifier</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#13">2.2.4 Security Access</a>
<ul>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#14">2.2.4.1 Request Seed</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#14">2.2.4.2 Send Key</a></li>
</ul>
</li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#15">2.2.5 Communication Control</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#15">2.2.6 Write Data By Identifier</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#16">2.2.7 Routine Control</a>
<ul>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#16">2.2.7.1 Check Routine</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#16">2.2.7.2 Check Programming Preconditions</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#17">2.2.7.3 Erase Memory</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#17">2.2.7.4 Check Programming Dependencies</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#18">2.2.7.5 Force Boot Mode</a></li>
</ul>
</li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#18">2.2.8 Request Download</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#19">2.2.9 Transfer Data</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#19">2.2.10 Request Transfer Exit</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#19">2.2.11 Tester Present</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#20">2.2.12 Control DTC Setting</a></li>
</ul>
</li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#21">2.3 Negative Response Codes</a></li>
</ul>
</li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#22">3 Flash Bootloader Delivery</a>
<ul>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#22">3.1 Bootloader Components</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#22">3.2 Bootloader Integration</a></li>
</ul>
</li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#23">4 Bootloader Installation</a>
<ul>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#23">4.1 [#oem_files] - Bootloader package structure</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#24">4.2 Demonstration Bootloader</a></li>
</ul>
</li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#25">5 Generation Tool (GENy)</a>
<ul>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#25">5.1 Project Setup</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#29">5.2 CAN configuration</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#30">5.3 CAN ID configuration</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#33">5.4 Bootloader Configuration</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#38">5.5 Memory Configuration</a>
<ul>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#38">5.5.1 Flash Block Table</a>
<ul>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#39">5.5.1.1 Logical Block Table</a></li>
</ul>
</li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#39">5.5.2 Memory Device Table</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#40">5.5.3 NV-Wrapper Configuration</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#42">5.5.4 Running the Generator</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#43">6 User callback files and hardware specific adaptions</a>
<ul>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#43">6.1 Startup code</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#44">6.2 Hardware, Input/Output and miscellaneous Callbacks</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#52">6.3 Validation and non-volatile memory callbacks</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#59">6.4</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#60">6.5 Diagnostic Service Callbacks</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#61">6.6 Watchdog Callbacks</a></li>
</ul>
</li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#63">7 Build your Bootloader</a>
<ul>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#63">7.1 Bootloader specific linker requirements</a></li>
</ul>
</li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#65">8 Adapt your application</a>
<ul>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#65">8.1 Memory Layout</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#65">8.2 Application Start</a>
<ul>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#65">8.2.1 Controllers with a configurable interrupt base address</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#65">8.2.2 Controllers with interrupt jump tables</a></li>
</ul>
</li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#66">8.3 Shared files between FBL and application</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#66">8.4 Shared memory between FBL and application</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#67">8.5 Transition between Bootloader and Application</a>
<ul>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#67">8.5.1 [#oem_start] [#oem_trans] - Programming Session Request</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#68">8.5.2 ECU Reset and Default Session Request</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#69">9 Memory Drivers</a>
<ul>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#69">9.1 Flash Driver</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#69">9.2 Non-volatile Memory Driver</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#70">9.3 Memory driver requirements</a></li>
</ul>
</li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#71">10 Miscellaneous</a>
<ul>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#71">10.1 &#160;[#oem_valid] - Application validation</a>
<ul>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#72">10.1.1 Presence Patterns</a>
<ul>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#73">10.1.1.1 Storage of application valid flag</a></li>
</ul>
</li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#74">10.1.2 [#oem_time] - Validation OK – Application faulty</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#74">10.1.3 Force Boot Mode</a></li>
</ul>
</li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#75">10.2 [#oem_sec] Seed / Key Mechanism</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#76">10.3 [#oem_seccomp] - Security module</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#76">10.4 Data Processing Support</a>
<ul>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#77">10.4.1 tProcParam</a></li>
</ul>
</li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#77">10.5 [#oem_multi] - Multiple ECU Support</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#78">10.6 Configuration without NV-Memory driver</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#79">10.7 Pipelined Programming and Pipelined Verification</a></li>
</ul>
</li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#80">11 vFlash Configuration</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#82">12 Glossary and Abbreviations</a>
<ul>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#82">12.1 Glossary</a></li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#82">12.2 Abbreviations</a></li>
</ul>
</li>
<li><a href="TechnicalReference_FBL_Vector_SLP3s.html#83">13 Contact</a></li>
</ul>
<hr/>
</body>
</html>
